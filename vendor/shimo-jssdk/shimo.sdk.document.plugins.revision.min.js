!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t(require("react"),require("lodash"),require("prop-types"),require("react-dom"),require("axios"));else if("function"==typeof define&&define.amd)define(["react","lodash","prop-types","react-dom","axios"],t);else{var n="object"==typeof exports?t(require("react"),require("lodash"),require("prop-types"),require("react-dom"),require("axios")):t(e.shimo.sdk.common.React,e.shimo.sdk.common._,e.shimo.sdk.common.PropTypes,e.shimo.sdk.common.ReactDOM,e.shimo.sdk.common.Axios);for(var i in n)("object"==typeof exports?exports:e)[i]=n[i]}}(window,function(e,t,n,i,r){return(window.shimoWebpackJsonp=window.shimoWebpackJsonp||[]).push([[10],{1:function(t,n){t.exports=e},10:function(e,t){e.exports=i},1190:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setAPI=function(e,t){l={length:"/lizard-api/files/"+t+"/revisions/count",fetch:"/lizard-api/files/"+t+"/revisions",fetchTitle:"/lizard-api/files/"+t+"/doc_histories/{historyId}/title",postRename:"/lizard-api/files/"+t+"/revisions/{id}",revert:"/lizard-api/files/"+t+"/revert",generate:"/lizard-api/files/"+t+"/revisions",delete:"/lizard-api/files/"+t+"/revisions/{id}",fetchContent:"/lizard-api/files/"+t+"/doc_histories/{id}",user:"/lizard-api/users/action/batch"},l=(0,s.assign)(l,e)},t.fetchRevisionsLength=function(){return(0,o.request)({url:l.length})},t.fetchRevisions=function(){return(0,o.request)({url:l.fetch}).then(function(e){return(0,s.reverse)(e)})},t.fetchTitle=function(e){return(0,o.request)({url:l.fetchTitle.replace(/{historyId}/,e)}).then(function(e){return e.label?e.label:"string"==typeof e?e:""})},t.postRename=function(e,t){return(0,o.request)({method:"PATCH",url:l.postRename.replace(/{id}/,e),data:{label:t}})},t.revertRevision=function(e){return(0,o.request)({method:"POST",url:l.revert,data:{docHistoryId:e}})},t.fetchContent=function(e){return(0,o.request)({url:l.fetchContent.replace(/{id}/,e)}).then(d)},t.postRevision=function(e){return(0,o.request)({method:"POST",url:l.generate,data:{label:e}})},t.deleteRevision=function(e){return(0,o.request)({method:"DELETE",url:l.delete.replace(/{id}/,e)})};var i=n(0),r=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var t=a();if(t&&t.has(e))return t.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var o=i?Object.getOwnPropertyDescriptor(e,r):null;o&&(o.get||o.set)?Object.defineProperty(n,r,o):n[r]=e[r]}n.default=e,t&&t.set(e,n);return n}(n(12)),o=n(9),s=n(3);function a(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return a=function(){return e},e}var l={};function d(e){var t=JSON.parse(e.content).alines,n=[];t&&(n=function(e){return e.map(function(e){if(e instanceof r.TableOperator){var t=e.getAttributes()||{};return e.set({attributes:(0,i.__assign)((0,i.__assign)({},t),{history:t.history||"retain",full:!0})})}return e})}(n=r.default.unpack(JSON.stringify(t)).ops));return new r.Delta(n)}},2617:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i,r=(i=n(2618))&&i.__esModule?i:{default:i};(0,n(95).setScope)("document.plugins.Revision",r.default);var o=r.default;t.default=o,e.exports=t.default},2618:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"Revision",{enumerable:!0,get:function(){return c.default}}),t.default=void 0;var i=n(0),r=u(n(5));n(2619);var o=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var t=h();if(t&&t.has(e))return t.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var o=i?Object.getOwnPropertyDescriptor(e,r):null;o&&(o.get||o.set)?Object.defineProperty(n,r,o):n[r]=e[r]}n.default=e,t&&t.set(e,n);return n}(n(1)),s=n(10),a=n(9),l=n(38),d=n(2621),c=u(n(2622)),p=n(1190),v=u(n(2631));function h(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return h=function(){return e},e}function u(e){return e&&e.__esModule?e:{default:e}}var f=function(e){function t(n){var i=e.call(this,n)||this;return i.hide=i.hide.bind(i),i.config=n,i.guid=n.guid,i.highLight=n.highLight||!0,i.length=0,(0,p.setAPI)(n.service,n.guid),i.getLengthStart(),i.on(t.events.ENTER,function(){var e=i.editor.getModule("audio");e&&e.stopAll()}),i.on(t.events.LENGTHCHANGE,function(e){i.length=e}),i}return(0,i.__extends)(t,e),t.prototype.show=function(){this.root&&(this.root.style.display="block",this.preview())},t.prototype.hide=function(){this.root&&(this.root.style.display="none")},t.prototype.getCount=function(){return this.length},t.prototype.save=function(e){var t=this;(0,p.postRevision)((0,a.getDayTime)()).then(function(){a.toast.success(e||(0,r.default)("成功创建版本，可在「更多 」-「查看历史」-「 版本」中查看")),t.emit(v.default.SAVE,t.length+1),t.emit(v.default.LENGTHCHANGE,t.length+1)}).catch(function(e){var t=e.code,n=e.message;400===t?a.toast.success((0,r.default)("已成功创建版本，无需重复创建")):a.toast.error(""+(n||(0,r.default)("版本保存失败，请检查网络或稍后再试")))})},t.prototype.preview=function(e){void 0===e&&(e=0),this.revision.previewRevision(!0,e)},t.prototype.quit=function(){this.revision.previewRevision(!1)},t.prototype.getComponent=function(){var e=this;return o.createElement(c.default,{guid:this.guid,authorInfo:this.config.authorInfo,ref:function(t){e.revision=t},highLight:this.highLight,plugin:this,Events:v.default,editor:this.editor,tips:this.config.tips,watermark:this.config.watermark})},t.prototype.render=function(e){var n=this,i=this.getComponent();e?this.root=e:(this.root=this.editor.addContainer("ql-sidebar-revisions"),this.on(t.events.ENTER,function(){n.root.style.zIndex="888"}),this.on(t.events.QUIT,function(){n.root.style.zIndex=null}),i=o.createElement(a.Sidebar,{name:(0,r.default)("版本"),editor:this.editor,hide:this.hide},i)),(0,s.render)(i,this.root)},t.prototype.destroy=function(){this.root&&(0,s.unmountComponentAtNode)(this.root)},t.prototype.update=function(){this.revision.getRevisions()},t.prototype.getLengthStart=function(){var e=this;(0,p.fetchRevisionsLength)().then(function(t){e.length=t})},t.version=d.version,t.events=v.default,t}(l.Plugin);t.default=f},2619:function(e,t,n){var i=n(2620);"string"==typeof i&&(i=[[e.i,i,""]]);var r={hmr:!0,transform:void 0,insertInto:void 0};n(24)(i,r);i.locals&&(e.exports=i.locals)},2620:function(e,t,n){(e.exports=n(20)(!1)).push([e.i,".sm-doc-revisons {\n  width: 100%;\n  height: 100%;\n  position: relative; }\n  .sm-doc-revisons.active .revisons-sidebar {\n    width: 340px;\n    height: calc(100vh - 65px);\n    position: fixed;\n    top: 65px;\n    z-index: 888;\n    padding: 0 20px;\n    background: #f7f7f7; }\n    .sm-doc-revisons.active .revisons-sidebar .revision-items {\n      padding: 0; }\n  .sm-doc-revisons .revisons-sidebar {\n    width: 100%;\n    height: 100%; }\n    .sm-doc-revisons .revisons-sidebar * {\n      box-sizing: content-box !important; }\n    .sm-doc-revisons .revisons-sidebar .revisions-tips {\n      padding-top: 55px;\n      text-align: center;\n      color: #a5a5a5;\n      font-size: 12px;\n      line-height: 20px; }\n      .sm-doc-revisons .revisons-sidebar .revisions-tips > p {\n        margin: 0; }\n    .sm-doc-revisons .revisons-sidebar .revision-items {\n      max-height: calc(100% - 45px);\n      overflow: auto;\n      padding: 0 20px; }\n    .sm-doc-revisons .revisons-sidebar .pr-container {\n      position: relative;\n      min-height: 20px;\n      padding: 10px 15px 30px;\n      background: white;\n      box-shadow: 0 1px 1px 0 rgba(0, 0, 0, 0.05);\n      border-radius: 2px;\n      margin-bottom: 10px;\n      clear: both;\n      cursor: pointer;\n      border: 1px solid transparent;\n      font-size: 12px; }\n      .sm-doc-revisons .revisons-sidebar .pr-container:first-child {\n        margin-top: 10px; }\n      .sm-doc-revisons .revisons-sidebar .pr-container.selected {\n        background: #f7f7f7;\n        box-shadow: none;\n        border-color: #ddd; }\n      .sm-doc-revisons .revisons-sidebar .pr-container:hover {\n        box-shadow: 0 2px 3px 0 rgba(0, 0, 0, 0.1); }\n        .sm-doc-revisons .revisons-sidebar .pr-container:hover .pr-time {\n          display: none; }\n        .sm-doc-revisons .revisons-sidebar .pr-container:hover .pr-delete,\n        .sm-doc-revisons .revisons-sidebar .pr-container:hover .pr-edit {\n          display: block; }\n        .sm-doc-revisons .revisons-sidebar .pr-container:hover.selected {\n          box-shadow: none; }\n    .sm-doc-revisons .revisons-sidebar .pr-header {\n      line-height: 18px; }\n    .sm-doc-revisons .revisons-sidebar .pr-wrap {\n      color: #333;\n      font-weight: 500; }\n    .sm-doc-revisons .revisons-sidebar .pr-delete,\n    .sm-doc-revisons .revisons-sidebar .pr-edit {\n      display: none;\n      opacity: 0.5;\n      height: 12px;\n      float: right;\n      position: relative;\n      bottom: -2px; }\n      .sm-doc-revisons .revisons-sidebar .pr-delete:hover,\n      .sm-doc-revisons .revisons-sidebar .pr-edit:hover {\n        opacity: 1; }\n    .sm-doc-revisons .revisons-sidebar .pr-delete {\n      margin-left: 18px; }\n    .sm-doc-revisons .revisons-sidebar .preview-edit-icon,\n    .sm-doc-revisons .revisons-sidebar .preview-delete-icon {\n      margin-right: 3px;\n      position: relative;\n      top: 2px; }\n      .sm-doc-revisons .revisons-sidebar .preview-edit-icon svg,\n      .sm-doc-revisons .revisons-sidebar .preview-delete-icon svg {\n        width: 12px;\n        height: 12px; }\n    .sm-doc-revisons .revisons-sidebar .pr-ok {\n      position: absolute;\n      z-index: 200;\n      opacity: 0.5;\n      right: 14px;\n      bottom: 6px;\n      color: #73a2e3; }\n      .sm-doc-revisons .revisons-sidebar .pr-ok:hover {\n        opacity: 1; }\n    .sm-doc-revisons .revisons-sidebar .pr-label {\n      word-break: break-all;\n      padding-top: 2px;\n      padding-bottom: 2px; }\n      .sm-doc-revisons .revisons-sidebar .pr-label textarea {\n        display: block;\n        height: 18px;\n        width: 100%;\n        padding: 2px;\n        margin-top: -3px;\n        margin-bottom: -2px;\n        margin-left: -3px;\n        border: 1px solid #e5e5e5;\n        box-shadow: inset 0 1px 4px 0 #e5e5e5;\n        border-radius: 2px;\n        resize: none;\n        outline: none;\n        overflow: hidden;\n        word-break: break-all;\n        line-height: 18px; }\n    .sm-doc-revisons .revisons-sidebar .pr-time {\n      position: absolute;\n      right: 14px;\n      bottom: 10px;\n      color: #a5a5a5; }\n    .sm-doc-revisons .revisons-sidebar .pr-content {\n      position: absolute;\n      bottom: 10px;\n      left: 14px;\n      line-height: 20px;\n      color: #a5a5a5; }\n    .sm-doc-revisons .revisons-sidebar .pr-user {\n      float: left;\n      max-width: 110px;\n      margin-right: 5px;\n      overflow: hidden;\n      text-overflow: ellipsis;\n      white-space: nowrap;\n      font-weight: 500; }\n    .sm-doc-revisons .revisons-sidebar .revision-bottom {\n      width: 100%;\n      padding: 11px 0; }\n      .sm-doc-revisons .revisons-sidebar .revision-bottom label {\n        color: #333;\n        font-weight: normal;\n        font-size: 12px; }\n        .sm-doc-revisons .revisons-sidebar .revision-bottom label.checkbox:before {\n          content: ' ';\n          display: inline-block;\n          vertical-align: middle;\n          margin-right: 10px;\n          width: 12px;\n          height: 13px;\n          background-repeat: no-repeat;\n          background-size: 12px 13px; }\n        .sm-doc-revisons .revisons-sidebar .revision-bottom label.checkbox.checked:before {\n          background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAaCAYAAACtv5zzAAAENElEQVRIS5VW32ubVRh+zvk2oTNCF9v8km03Mlb8Aza9G13TZmlXeyHo0qZ1iheCsIEgiMxaZG1N6oaKoEzB/0FRxGvZ/H2ztibtLhw2abrVlM0lLck58r7nOydf0nixD8KX8+V8z/O8z3l/RNRqNQ3/+uvOHdy7t22Xj3zXGujrC+PokSPuXUEEP964ietffIVqtfrIoN1e6O3txauvTOO5Uychfv7lVz07dwVKKUjpwfOEece/dWUkqR2XfaSU9rEkZi+/DXHpzbf06moBhw714PFQCEIIgy32M+gO4LY1/SYE6Nm/Dx7g4cMaBgZOQEy8cF7XazX0R/o4AsJlig6CIFjreyASrUEr4tFaYatyFz09PRCp0QneFY1FIRldmCgCAVjA4H1/NNZZDaWBymbFOG0J4vEYhJQ+sCGhqw3cqlQKpJcd862ZGB/DjZs/oUzAWqFc7iRIxCElgdoIjJ+ORJMyAlXQdJD+d/o9mzmPM4OnUd3ZwWLuQ5TKmyiXy2y1GEk/zyiJpxK+NS31neCUaVopzhJFRFpjejKD5NAgC6nX61i69jGKa+v7CeKJeBsBWRSMgEHp02w6AgIfTp5x4PmrHzE4vesiGE6PcwTxuCEwNrUKgUjIFgJvNlsE09kMRpJDDjy3dA1r67ddkrQTKI1YIs6biYDSVammn3ItAkUEqomZ7FSb8sX8VRTX1uB5njvDFkHqHOdGNBZjgmPHjuLiG6/j8+tfYmX1T7bJeG/uM6R8OOmUL+SWUCyuQ3oSnvRcBKVSyRxykgi0QjQaxeFwL67MzSIUCmF3dxcU9q2VFSYhgpenJ9vA5z/IMzgpl1IyiV+mKJXKxuihkTEmiEQjDDKVeQmpEaOQSOYX87i1vIwLM9Puea1ex8JiHgWyhfuXxzXkScnVTFdpo9QioJSLRPrZAtoxlXkR6bMpR/Lb73/g2VMnee3Ai8ZztsY74BLEtArdhaDfEFA0lC0z2UmMpg2JvQx4DgVriw9O9pguI41IABt/b5i0txb1+xGQTc0mZRCRTGFs9KxTPr+Q4zwPKmfv/Q5AG01aByKwhxyJRAIREIHZSCSDg6edcmMJ+X7AHKykype8lxQHI+BDHk6d09RXqJtai7gdGDNZfSwaQ+XuFh+o9TwIbi0MVj5ZZAjS45psicWjfs4bYNtruPiEhOACJMV+SvrKGSTQ223kjiB74TW9ubmJJ8NhHHzsoBsYlE1mhJjZQDZYO+y9E9yewd7eHrYqW+yK+OTTz/TX33zLoYeeCJlqDMwBG74ZQq1PEDw4OxrNBu7v3OdEoQQR1WpVX37vfRQKa75igEZS51jnFug3Qn9qG4+7zG56fvz405h79x3w35ZGo4Hvvv8Byyur2N7+x41LmxnBWggCdoJTToTDh/HMwAmeEVzh9o9X96HeVmdO7f+pbt9tVv8Bbua0eaIHvIAAAAAASUVORK5CYII=); }\n        .sm-doc-revisons .revisons-sidebar .revision-bottom label.checkbox.unchecked:before {\n          background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAaCAYAAACtv5zzAAABdUlEQVRIS+2WTW+CQBCGZ/musYlYq5Ub//+3GLgYj96gWuuS1Mi328w0a6B+FAtNL24yByDMw/vOMrMsjmMBf7gYApIkgSAIIMsyOBwOrXCKooBhGOA4DliWBYxzLpbLJQjRrRDGGLiuC2w+n5MCJFvWA6iqCvgQ45aFH4hRliUkSUxOkALP8wRe9PuPlBxBbQCYCyG73cdXrtlsRt4MBjbdkPEbBZhcRhRxMuAIGA6fSEEXFqGC7fa9DhiNnkHTtLMWXVJT3RiyBqigKArYbN7qgPF4cqyBrMOtRZb2oIL1elUHTCYvNQD513AnSSVVwGr1eh3QNLlUiZBGgK6KfFHBHYA7CONu0ck/WO2m/2tRF930qgIJ6KxV+L4vkIjdVNf1TuZBnufUTemnXSwWYr/fU3LbtkHT9JOJdku7LoocOOeAkF6vByyKIhr6bU8T37cVWk1DH48teFwJwxDSNKVh0Wbh0DJNE6bTKR1fCNAm4U/vfgLdEL2Shj9ItQAAAABJRU5ErkJggg==); }\n  .sm-doc-revisons .revisons-preview.hide {\n    display: none; }\n  .sm-doc-revisons .revisons-preview {\n    position: fixed;\n    top: 0;\n    left: 0;\n    right: 0;\n    bottom: 0;\n    z-index: 888;\n    background-color: #f7f7f7;\n    font-size: 12px; }\n    .sm-doc-revisons .revisons-preview .preview-header {\n      height: 50px;\n      background: #676b6f;\n      box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.3);\n      margin-bottom: 15px; }\n    .sm-doc-revisons .revisons-preview .preview-title {\n      float: left;\n      overflow: hidden;\n      text-overflow: ellipsis;\n      white-space: nowrap;\n      margin-left: 25px;\n      max-width: 700px;\n      line-height: 50px;\n      color: white;\n      font-size: 14px;\n      font-weight: bold; }\n    .sm-doc-revisons .revisons-preview .preview-tip {\n      margin-left: 15px;\n      line-height: 50px;\n      color: #ccc;\n      max-width: 400px;\n      overflow: hidden;\n      text-overflow: ellipsis; }\n    .sm-doc-revisons .revisons-preview .preview-revert {\n      display: inline-block;\n      margin-left: 38px;\n      padding: 4px 20px 7px;\n      background-image: linear-gradient(-180deg, #fdfdfd, #f8f8f8);\n      box-shadow: 0 1px 1px 0 rgba(0, 0, 0, 0.11);\n      border-radius: 2px;\n      color: #666666;\n      cursor: pointer; }\n    .sm-doc-revisons .revisons-preview .preview-revert-icon {\n      margin-right: 7px;\n      position: relative;\n      top: 3px; }\n      .sm-doc-revisons .revisons-preview .preview-revert-icon svg {\n        width: 14px;\n        height: 14px; }\n        .sm-doc-revisons .revisons-preview .preview-revert-icon svg path {\n          fill: #666; }\n        .sm-doc-revisons .revisons-preview .preview-revert-icon svg path[fill='none'] {\n          stroke: #666; }\n    .sm-doc-revisons .revisons-preview .preview-close-icon {\n      margin-right: 8px;\n      position: relative;\n      top: 1px; }\n      .sm-doc-revisons .revisons-preview .preview-close-icon svg {\n        width: 12px;\n        height: 12px; }\n        .sm-doc-revisons .revisons-preview .preview-close-icon svg path {\n          fill: #fff; }\n    .sm-doc-revisons .revisons-preview .preview-quit {\n      float: right;\n      margin-right: 20px;\n      line-height: 50px;\n      color: white;\n      font-size: 14px;\n      cursor: pointer; }\n    .sm-doc-revisons .revisons-preview .preview-scroller {\n      height: calc(100% - 65px);\n      overflow: auto; }\n    .sm-doc-revisons .revisons-preview .preview-content-container {\n      min-width: 1280px; }\n    .sm-doc-revisons .revisons-preview .ql-title {\n      padding: 90px 100px 0; }\n      .sm-doc-revisons .revisons-preview .ql-title .preview-input-title {\n        display: block;\n        line-height: 50px;\n        padding-bottom: 10px;\n        border-bottom: 1px solid #e8ecf1;\n        color: #333;\n        font-size: 22.5pt;\n        font-weight: 700; }\n    .sm-doc-revisons .revisons-preview .ql-container .ql-editor ol li:before,\n    .sm-doc-revisons .revisons-preview .ql-container .ql-editor ul li:before {\n      pointer-events: none !important; }\n    .sm-doc-revisons .revisons-preview .ql-container .ql-editor .ql-history-line-addition {\n      background: #d5edd3 !important; }\n    .sm-doc-revisons .revisons-preview .ql-container .ql-editor .ql-table.ql-history-line-addition,\n    .sm-doc-revisons .revisons-preview .ql-container .ql-editor .ql-table.ql-history-line-deletion {\n      background: inherit !important; }\n    .sm-doc-revisons .revisons-preview .ql-container .ql-editor .ql-history-line-deletion * {\n      text-decoration: line-through;\n      color: #f4aaaa !important; }\n    .sm-doc-revisons .revisons-preview .ql-container .ql-editor hr.ql-history-line-deletion {\n      border-top-color: #f4aaaa; }\n    .sm-doc-revisons .revisons-preview .ql-container .ql-editor .ql-blot-gallery-block.ql-history-line-addition {\n      background: inherit !important; }\n      .sm-doc-revisons .revisons-preview .ql-container .ql-editor .ql-blot-gallery-block.ql-history-line-addition img.gallery-image {\n        border: 1px solid rgba(119, 196, 111, 0.7) !important; }\n    .sm-doc-revisons .revisons-preview .ql-container .ql-editor a {\n      cursor: default !important; }\n    .sm-doc-revisons .revisons-preview .ql-container .ql-editor a.ql-history-addition:hover {\n      color: inherit !important; }\n    .sm-doc-revisons .revisons-preview .ql-container .ql-editor a.ql-history-deletion:hover {\n      color: #f4aaaa !important; }\n    .sm-doc-revisons .revisons-preview .ql-container .ql-editor .ql-history-addition,\n    .sm-doc-revisons .revisons-preview .ql-container .ql-editor span.ql-history-addition {\n      background: #d5edd3 !important;\n      color: #494949 !important;\n      text-decoration: none !important; }\n      .sm-doc-revisons .revisons-preview .ql-container .ql-editor .ql-history-addition .ql-blot-gallery,\n      .sm-doc-revisons .revisons-preview .ql-container .ql-editor span.ql-history-addition .ql-blot-gallery {\n        padding: 0; }\n      .sm-doc-revisons .revisons-preview .ql-container .ql-editor .ql-history-addition span.img-wrapper,\n      .sm-doc-revisons .revisons-preview .ql-container .ql-editor span.ql-history-addition span.img-wrapper {\n        background-color: white !important; }\n      .sm-doc-revisons .revisons-preview .ql-container .ql-editor .ql-history-addition img.gallery-image,\n      .sm-doc-revisons .revisons-preview .ql-container .ql-editor span.ql-history-addition img.gallery-image {\n        border: 1px solid rgba(119, 196, 111, 0.7) !important;\n        box-shadow: initial !important; }\n    .sm-doc-revisons .revisons-preview .ql-container .ql-editor .ql-history-deletion,\n    .sm-doc-revisons .revisons-preview .ql-container .ql-editor .ql-history-line-deletion,\n    .sm-doc-revisons .revisons-preview .ql-container .ql-editor span.ql-history-deletion {\n      text-decoration: line-through !important;\n      color: #f4aaaa !important; }\n      .sm-doc-revisons .revisons-preview .ql-container .ql-editor .ql-history-deletion font,\n      .sm-doc-revisons .revisons-preview .ql-container .ql-editor .ql-history-line-deletion font,\n      .sm-doc-revisons .revisons-preview .ql-container .ql-editor span.ql-history-deletion font {\n        color: #f4aaaa !important; }\n      .sm-doc-revisons .revisons-preview .ql-container .ql-editor .ql-history-deletion .inner, .sm-doc-revisons .revisons-preview .ql-container .ql-editor .ql-history-deletion.mention:before,\n      .sm-doc-revisons .revisons-preview .ql-container .ql-editor .ql-history-deletion .attachment-file-name:after,\n      .sm-doc-revisons .revisons-preview .ql-container .ql-editor .ql-history-line-deletion .inner,\n      .sm-doc-revisons .revisons-preview .ql-container .ql-editor .ql-history-line-deletion.mention:before,\n      .sm-doc-revisons .revisons-preview .ql-container .ql-editor .ql-history-line-deletion .attachment-file-name:after,\n      .sm-doc-revisons .revisons-preview .ql-container .ql-editor span.ql-history-deletion .inner,\n      .sm-doc-revisons .revisons-preview .ql-container .ql-editor span.ql-history-deletion.mention:before,\n      .sm-doc-revisons .revisons-preview .ql-container .ql-editor span.ql-history-deletion .attachment-file-name:after {\n        color: #a5a5a5 !important; }\n      .sm-doc-revisons .revisons-preview .ql-container .ql-editor .ql-history-deletion img,\n      .sm-doc-revisons .revisons-preview .ql-container .ql-editor .ql-history-line-deletion img,\n      .sm-doc-revisons .revisons-preview .ql-container .ql-editor span.ql-history-deletion img {\n        opacity: 0.3;\n        -webkit-mask-image: -webkit-linear-gradient(45deg, black 6%, transparent 6%, transparent 9%, black 9%, black 15%, transparent 15%, transparent 18%, black 18%, black 24%, transparent 24%, transparent 27%, black 27%, black 33%, transparent 33%, transparent 36%, black 36%, black 42%, transparent 42%, transparent 45%, black 45%, black 51%, transparent 51%, transparent 54%, black 54%, black 60%, transparent 60%, transparent 63%, black 63%, black 69%, transparent 69%, transparent 72%, black 72%, black 78%, transparent 78%, transparent 81%, black 81%, black 87%, transparent 87%, transparent 90%, black 90%, black 96%, transparent 96%, black); }\n        .sm-doc-revisons .revisons-preview .ql-container .ql-editor .ql-history-deletion img:hover,\n        .sm-doc-revisons .revisons-preview .ql-container .ql-editor .ql-history-line-deletion img:hover,\n        .sm-doc-revisons .revisons-preview .ql-container .ql-editor span.ql-history-deletion img:hover {\n          opacity: 0.5 !important; }\n    .sm-doc-revisons .revisons-preview .ql-container .ql-editor .ql-table-raw {\n      width: 100%;\n      margin: 10px 0;\n      border-spacing: 0;\n      border-collapse: collapse;\n      table-layout: fixed;\n      font-size: 12px; }\n      .sm-doc-revisons .revisons-preview .ql-container .ql-editor .ql-table-raw td {\n        border: 1px solid #ccc;\n        height: 20px; }\n        .sm-doc-revisons .revisons-preview .ql-container .ql-editor .ql-table-raw td.history-table-rowindex {\n          width: 35px;\n          background: #eee;\n          text-align: center; }\n        .sm-doc-revisons .revisons-preview .ql-container .ql-editor .ql-table-raw td.history-table-ignore {\n          width: 30px;\n          text-align: center; }\n    .sm-doc-revisons .revisons-preview .ql-container .ql-editor .history-table-header {\n      background: #eee; }\n      .sm-doc-revisons .revisons-preview .ql-container .ql-editor .history-table-header td {\n        text-align: center; }\n    .sm-doc-revisons .revisons-preview .ql-container .ql-editor .history-table-addition {\n      background: rgba(119, 196, 110, 0.3); }\n      .sm-doc-revisons .revisons-preview .ql-container .ql-editor .history-table-addition .ql-history-addition {\n        background: transparent !important; }\n    .sm-doc-revisons .revisons-preview .ql-container .ql-editor tr.history-table-addition {\n      background: rgba(119, 196, 110, 0.3); }\n      .sm-doc-revisons .revisons-preview .ql-container .ql-editor tr.history-table-addition * {\n        background: transparent !important; }\n    .sm-doc-revisons .revisons-preview .ql-container .ql-editor table.history-table-addition * {\n      background: transparent !important; }\n    .sm-doc-revisons .revisons-preview .ql-container .ql-editor .history-table-deletion {\n      background: rgba(244, 169, 169, 0.3); }\n      .sm-doc-revisons .revisons-preview .ql-container .ql-editor .history-table-deletion,\n      .sm-doc-revisons .revisons-preview .ql-container .ql-editor .history-table-deletion * {\n        text-decoration: line-through;\n        color: #f4a9a9; }\n    .sm-doc-revisons .revisons-preview .ql-container .ql-editor tr.history-table-deletion {\n      background: rgba(244, 169, 169, 0.3); }\n      .sm-doc-revisons .revisons-preview .ql-container .ql-editor tr.history-table-deletion * {\n        background: transparent !important; }\n    .sm-doc-revisons .revisons-preview .ql-container .ql-editor table.history-table-deletion * {\n      background: transparent !important; }\n    .sm-doc-revisons .revisons-preview .ql-container .ql-editor .ql-hidden {\n      display: none; }\n    .sm-doc-revisons .revisons-preview .ql-container .ql-editor .ql-gallery-editableimage .resizebars,\n    .sm-doc-revisons .revisons-preview .ql-container .ql-editor .ql-gallery-editableimage .ql-gallery-toolbar {\n      display: none !important; }\n    .sm-doc-revisons .revisons-preview .ql-container .ql-editor .ql-location-separator,\n    .sm-doc-revisons .revisons-preview .ql-container .ql-editor .ql-location-edit {\n      display: none; }\n\n@media screen and (max-width: 1496px) {\n  .sm-doc-revisons .revisons-preview .ql-container {\n    margin-right: 340px; }\n  .sm-doc-revisons .revisons-sidebar {\n    right: 0; } }\n",""])},2621:function(e){e.exports={name:"@shimo/sdk-document-plugin-revision",version:"1.0.44",description:"",main:"dist/index.js",typings:"dist/types",files:["dist"],scripts:{prebuild:"rimraf dist",dev:"webpack --config ./webpack.config.js --env.dev",build:"webpack --config ./webpack.config.js --env.prod",postbuild:"../../scripts/filter-dist-types.sh",prepublish:"npm run build"},keywords:[],author:"wangboning <wangboning@shimo.im>",license:"UNLICENSED",dependencies:{"@shimo/richdoc":"3.1.12","@shimo/sdk-document-editor":"^1.1.3","@shimo/sdk-document-plugin-collaborator":"^1.0.38","@shimo/sdk-document-plugin-watermark":"^1.1.2","@shimo/sdk-document-utils":"^1.1.2",classnames:"2.2.5"},peerDependencies:{"@shimo/simple-i18n":"1.0.3",lodash:"^4.17.10",react:"^16.3.2","react-dom":"^16.3.2",tslib:"1.10.0"},publishConfig:{registry:"http://registry.npm.shimo.run"}}},2622:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(0),r=g(n(5)),o=n(12),s=g(n(38)),a=g(n(1041)),l=g(n(2623)),d=n(9),c=n(3),p=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var t=m();if(t&&t.has(e))return t.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var o=i?Object.getOwnPropertyDescriptor(e,r):null;o&&(o.get||o.set)?Object.defineProperty(n,r,o):n[r]=e[r]}n.default=e,t&&t.set(e,n);return n}(n(1)),v=g(n(2625)),h=g(n(2629)),u=g(n(2630)),f=n(1190);function m(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return m=function(){return e},e}function g(e){return e&&e.__esModule?e:{default:e}}var w,b,y=function(e){function t(t){var n=e.call(this,t)||this;return n.containerClass="revisons-preview",n.handleRename=function(e,t){(0,f.postRename)(e.id,e.label).then(function(){var i=n.state.revisions;i[t]=e,n.setState({revisions:i}),t===n.state.selected&&(n.container.querySelector(".preview-label").innerHTML=n.formatLabelName(e.label))}).catch(function(e){e.message&&d.toast.error(e.message)})},n.handleDelete=function(e,t){var i=e.id,r=n.state.titles,o=n.state.previews;(0,f.deleteRevision)(e.id).then(function(){r[i]&&(r=(0,c.omit)(r,i)),o[i]&&(o=(0,c.omit)(o,i));var a=(0,c.without)(n.state.revisions,e);n.setState({revisions:a,titles:r,previews:o},function(){0!==a.length?n.presetPreview(0===t?t:t-1):n.previewRevision(!1)}),n.props.plugin.emit(n.props.Events.LENGTHCHANGE,a.length);n.props.plugin.emit(s.default.events.TRACK_NEW_DOC_OPS,"版本删除成功")}).catch(function(e){e.message&&d.toast.error(""+e.message);n.props.plugin.emit(s.default.events.TRACK_NEW_DOC_OPS,"版本删除失败")})},n.presetPreview=function(e){var t=n.state.revisions[e],i=t.id,r=t.docHistoryId;if(n.state.previews[i])n.setPreview(e);else{n.props.guid;Promise.all([(0,f.fetchContent)(r),(0,f.fetchTitle)(r)]).then(function(t){var r=t[0],o=t[1],s=n.state,a=s.previews,l=s.titles;a[i]=r,l[i]=o,n.setState({previews:a,titles:l},function(){n.setPreview(e)})})}},n.handleSelected=function(e,t){n.setState({selected:t,hide:!1}),n.presetPreview(t)},n.toggleHighlight=function(){n.setState(function(e){return{highLight:!e.highLight}},function(){n.setPreview(n.state.selected)})},n.generateRevsion=function(){n.props.plugin.on(function(){n.getRevisions()})},n.previewRevision=function(e,t){void 0===t&&(t=-1),n.setState({hide:!e,selected:t})},n.togglePreview=function(){n.state.hide?(n.props.plugin.emit(n.props.Events.QUIT),n.container.classList.add("hide"),n.props.editor.container.style.zIndex=null):0===n.state.revisions.length?n.container.classList.add("hide"):(n.container.classList.remove("hide"),n.props.plugin.emit(n.props.Events.ENTER),n.props.editor.container.style.zIndex=0)},n.handleCancel=function(){n.setState({visible:!n.state.visible})},n.handleOk=function(){var e=n.state.revisions[n.state.selected];n.props.plugin.emit(s.default.events.TRACK_NEW_DOC_OPS,"点击版本还原"),(0,f.revertRevision)(e.docHistoryId).then(function(){n.setState({hide:!0,visible:!n.state.visible}),d.toast.success((0,r.default)(w||(w=(0,i.__makeTemplateObject)(["已还原到 "," 的内容"],["已还原到 "," 的内容"])),e.label)),n.props.plugin.emit(n.props.Events.REVERT);n.props.plugin.emit(s.default.events.TRACK_NEW_DOC_OPS,"版本还原成功")}).catch(function(){d.toast.error((0,r.default)("版本还原失败，请稍后再试"));n.props.plugin.emit(s.default.events.TRACK_NEW_DOC_OPS_ERROR,"版本还原失败")})},n.state={revisions:[],selected:-1,hide:!0,previews:{},titles:{},visible:!1,highLight:n.props.highLight||!0},n}return(0,i.__extends)(t,e),t.prototype.componentDidMount=function(){var e=this;if(this.getRevisions(),this.props.plugin.on(this.props.Events.SAVE,function(){e.getRevisions()}),this.container){var t=document.createElement("div");t.classList.add("preview-scroller");var n=document.createElement("div");n.classList.add("preview-content-container");var r=document.createElement("div");if(n.appendChild(r),t.appendChild(n),this.container.appendChild(t),this.editor=new s.default({modules:{toolbar:!1,clipboard:{copyable:(0,c.get)(this.props.editor,"options.modules.clipboard.copyable")}},scrollingContainer:t,readOnly:!0}),this.editor.render(r),r.classList.add("ql-snow"),this.editor.disable(),this.editor.addContainer("ql-title",this.editor.container.children[0]).innerHTML='<span class="preview-input-title"></span>',this.props.authorInfo){var o=new a.default((0,i.__assign)({editor:this.editor,avatarTrack:!1,cursorTrack:!1},this.props.authorInfo));if(o.render(),o.show(),this.props.watermark){var d=this.props.authorInfo.user;new l.default({userName:d.name,userId:d.id,container:"."+this.containerClass+" .ql-container",width:204,height:150}).render()}}this.container.classList.add("hide");var p=this.container.querySelector(".preview-quit"),v=this.container.querySelector(".preview-revert");p instanceof HTMLElement&&p.addEventListener("click",function(){e.previewRevision(!1)}),v instanceof HTMLElement&&v.addEventListener("click",function(){e.handleCancel()})}},t.prototype.getRevisions=function(){var e=this;(0,f.fetchRevisions)().then(function(t){t.length!==e.state.revisions.length&&e.props.plugin.emit(e.props.Events.LENGTHCHANGE,t.length),e.setState({revisions:t})})},t.prototype.setPreview=function(e){var t=this.state.revisions[e];if(t){var n=t.id,i=t.label,r=this.state.previews[n],o=this.state.titles[n];this.editor.setContent(this.getHighLightDelta(r)),this.container.querySelector(".preview-content-container").scrollTop=0,this.container.querySelector(".preview-label").innerHTML=this.formatLabelName(i),this.container.querySelector(".preview-title").innerHTML=o,this.container.querySelector(".preview-input-title").innerHTML=o}},t.prototype.getHighLightDelta=function(e){var t=this;if(!this.state.highLight){var n=[];e.ops.forEach(function(e){if(e instanceof o.TableOperator){var i=e.data,r=i.cells,s=i.rows,a=i.cols;if(r){var l={};r.forEach(function(e){var n=r.get(e),i=t.getHighLightDelta(n.data);l[e]=n.set({data:i})}),e=e.set({data:{cells:l,rows:s,cols:a}})}}var d=e.getAttributes();"deletion"!==d.history&&(delete d.history,delete d.historyLine,e=e.set({attributes:d}),n.push(e))}),e=new o.Delta(n)}return e},t.prototype.formatLabelName=function(e){return e.length<=20?e:e.substr(0,20)+"..."},t.prototype.getRevisionsLength=function(){return this.state.revisions.length},t.prototype.renderItem=function(){var e=this;return this.state.revisions.map(function(t,n){return p.createElement(v.default,{key:t.id,index:n,item:t,handleSelected:e.handleSelected,selected:e.state.selected===n,handleRename:e.handleRename,handleDelete:e.handleDelete,highLight:e.state.highLight})})},t.prototype.render=function(){var e=this,t=this.props.tips,n=this.state.hide,o=this.renderItem(),s="";if(0!==o.length){var a=this.state.selected,l=this.state.revisions[a];l&&(s=l.label)}return this.container&&this.togglePreview(),p.createElement("div",{className:"sm-doc-revisons "+(!n&&o.length?"active":"")},p.createElement("div",{className:this.containerClass,ref:function(t){return e.container=t}},p.createElement("div",{className:"preview-header"},p.createElement("div",{className:"preview-title"}),p.createElement("span",{className:"preview-tip"},(0,r.default)("预览")," ",p.createElement("span",{className:"preview-label"})," ",(0,r.default)("版本")),p.createElement("div",{className:"preview-revert"},p.createElement("span",{className:"preview-revert-icon"},p.createElement(u.default,null)),(0,r.default)("还原到该版本")),p.createElement("div",{className:"preview-quit"},p.createElement("span",{className:"preview-close-icon"},p.createElement(h.default,null)),(0,r.default)("退出版本预览")))),p.createElement("div",{className:"revisons-sidebar"},0===o.length?p.createElement("div",{className:"revisions-tips"},t?t.map(function(e){return p.createElement("p",{key:e},e)}):(0,r.default)("没有版本")):p.createElement("div",{className:"revision-items"},o),o.length>0&&!n&&p.createElement("div",{className:"revision-bottom"},p.createElement("label",{className:this.state.highLight?"checkbox checked":"checkbox unchecked",onClick:this.toggleHighlight},(0,r.default)("高亮显示修改内容")))),p.createElement(d.Modal,{title:(0,r.default)("还原文档"),okText:(0,r.default)("确定"),cancelText:(0,r.default)("取消"),onOk:this.handleOk,onCancel:this.handleCancel,visible:this.state.visible},(0,r.default)(b||(b=(0,i.__makeTemplateObject)(["确认将文档还原到历史版本 "," 以前的内容吗？"],["确认将文档还原到历史版本 "," 以前的内容吗？"])),s)))},t}(p.Component);t.default=y,e.exports=t.default},2623:function(e,t,n){"use strict";var i;Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=((i=n(2624))&&i.__esModule?i:{default:i}).default;t.default=r,e.exports=t.default},2624:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i,r=n(0),o=n(9),s=(i=n(25))&&i.__esModule?i:{default:i},a=n(3);var l={fontSize:15,fontFamily:' "-apple-system","BlinkMacSystemFont","PingFang SC","Helvetica","Tahoma","Arial","Microsoft YaHei","微软雅黑","黑体","Heiti","sans-serif","SimSun","宋体","serif"',fontWeight:"200",width:204,height:150,angle:-15,color:"#F0F0F1",protective:!0,hiddenColor:"rgb(254, 254, 254)"},d=function(){function e(e){this.watermarkId="watermark-"+(0,o.genGuid)(4),this.hiddenWatermarkId="_"+(0,o.genGuid)(),this.isFirstRender=!0,this.options=(0,r.__assign)((0,r.__assign)({},l),e),this.renderSlowly=(0,a.debounce)(this.render.bind(this),200)}return e.prototype.render=function(e){if(this.options.userName){var t=this.createElements();if(t){var n=t.watermarkContainer,i=t.hiddenWatermarkContainer,r=document.querySelector(this.options.container);if(r){var o=r.firstChild;if(o){var s=document.querySelector("#"+this.watermarkId);s?e&&(r.removeChild(s),r.insertBefore(s,o)):r.insertBefore(n,o);var a=document.querySelector("#"+this.hiddenWatermarkId);a?e&&(r.removeChild(a),r.insertBefore(a,o)):r.insertBefore(i,o),this.isFirstRender&&this.options.protective&&(this.startProtect(),this.isFirstRender=!1)}}}}},e.prototype.destroy=function(){this.options.protective&&this.protectiveMo&&this.protectiveMo.disconnect();var e=document.querySelector("#"+this.watermarkId),t=document.querySelector("#"+this.hiddenWatermarkId);e&&e.parentElement&&e.parentElement.removeChild(e),t&&t.parentElement&&t.parentElement.removeChild(t)},e.prototype.startProtect=function(){var e=this,t=document.querySelector(this.options.container);if(t){var n=function(t){if(t&&t.id===e.hiddenWatermarkId+"-child"){var n=document.querySelector("#"+e.hiddenWatermarkId);return n&&n.parentElement.removeChild(n),!0}return!1};if(MutationObserver){var i=[this.watermarkId,this.hiddenWatermarkId,this.hiddenWatermarkId+"-child"],r=new MutationObserver(function(r){Array.prototype.forEach.call(r,function(r){if("childList"===r.type)Array.prototype.some.call(r.removedNodes,function(e){return i.indexOf(e.id)>-1&&(n(e),!0)})&&e.render(),Array.prototype.some.call(r.addedNodes,function(e){return!!(e&&e.parentElement&&t.isEqualNode(e.parentElement)&&-1===i.indexOf(e.id))})&&e.renderSlowly(!0);else if("attributes"===r.type){var o=r.target;i.indexOf(o.id)>-1&&(n(o)||o.parentElement.removeChild(o),e.render())}})}),o={attributes:!0,childList:!0,subtree:!0,attributeFilter:["style"]};r.observe(t,o),r.observe(document.head,o),this.protectiveMo=r}}},e.prototype.createElements=function(){var e=this.prepareBackImage();if(e){var t=e.backImg,n=e.hiddenBackImg,i=e.width,r=e.height,o=this.options.wrapHeight?this.options.wrapHeight+"px":"100%",s=this.options.wrapWidth?this.options.wrapHeight+"px":"100%",a=this.options.wrapHeight?this.options.wrapHeight-.5*r+"px":"calc(100% - "+.5*r+"px)",l=["position: absolute !important;","top: 0 !important;","left: 0 !important;","width: "+s+" !important;","height: "+o+" !important;","background-repeat: repeat !important;","background-size: "+i+"px "+r+"px !important;","background-position: 0 0, 5px 20px !important;","pointer-events: none !important;"].join(" "),d=document.createElement("div");d.id=this.watermarkId,d.setAttribute("style",l+" background-image: "+c(t)+" !important;");var p=document.createElement("div");p.id=this.hiddenWatermarkId;var v=document.createElement("div");v.id=this.hiddenWatermarkId+"-child";var h=[l,"top: "+.5*r+"px !important;","height: "+a+" !important;","background-image: "+c(n)+" !important;"].join(" ");return v.setAttribute("style",h),p.appendChild(v),{watermarkContainer:d,hiddenWatermarkContainer:p}}},e.prototype.prepareBackImage=function(){var e=[],t=[],n=this.options.width||204,i=this.options.height||150,o=document.querySelector(this.options.container);if(o){var a={width:n,height:i,fontSize:this.options.fontSize,fontFamily:this.options.fontFamily,fontWeight:this.options.fontWeight,angle:this.options.angle},l=this.createImage((0,r.__assign)({text:this.options.userName,color:this.options.color},a)),d=l.url,c=l.shapeWidth,v=o.clientWidth;if(s.default.any){var h=Math.max(c/2,60);c+h<n&&(n=c+h),2*n>v&&2*c<v&&(n=Math.floor(v/2));for(var u=4;u>1;u--)if(v/u<n&&v/(u-1)>=n){n=Math.floor(v/(u-1));break}a.width=n,e=[this.createImage((0,r.__assign)({text:this.options.userName,color:this.options.color},a)).url,this.createImage((0,r.__assign)({text:String(this.options.userId),color:this.options.color},a)).url],t=[this.createImage((0,r.__assign)({text:String(this.options.userName),color:this.options.hiddenColor},a)).url,this.createImage((0,r.__assign)({text:String(this.options.userId),color:this.options.hiddenColor},a)).url]}else e=[d,this.createImage((0,r.__assign)({text:String(this.options.userId),color:this.options.color},a)).url],t=[this.createImage((0,r.__assign)({text:String(this.options.userName),color:this.options.hiddenColor},a)).url,this.createImage((0,r.__assign)({text:String(this.options.userId),color:this.options.hiddenColor},a)).url];return{backImg:e.map(p),hiddenBackImg:t.map(p),width:a.width,height:a.height}}},e.prototype.createImage=function(e){var t=e.color,n=e.fontSize,i=e.fontFamily,r=e.fontWeight,o=e.angle,s=e.offset,a=void 0===s?{x:0,y:0}:s,l=e.text,d=e.width,c=e.height,p=Math.round(window.devicePixelRatio),v=document.createElement("canvas");d*=p,c*=p,v.width=d,v.height=c,v.style.width=d/p+"px",v.style.height=c/p+"px";var h=v.getContext("2d");if(h){var u=Math.abs(o),f=Math.cos(u*Math.PI/180),m=Math.sin(u*Math.PI/180);h.font=r+" "+n*p+"px "+i,h.fillStyle=t;var g=h.measureText("永永永永永永永永").width;if(h.measureText(l).width>g)for(var w=l,b=l.slice(l.length-3),y=1;y<l.length-3;y++)if(w=l.slice(0,y)+" ... "+b,h.measureText(w).width>g){l=l.slice(0,y-1)+" ... "+b;break}var x=h.measureText(l).width,q=x*m+n*f,k=n*m+x*f,E=.5*(d-k)+n*m+(a.x||0)*p,M=.5*(c-q)+q+(a.y||0)*p;return h.translate(E,M),h.rotate(o/u*u*Math.PI/180),h.fillText(l,0,0),{url:v.toDataURL(),shapeWidth:k/p}}return{url:"",shapeWidth:100}},e}();function c(e){return e.map(function(e){return"url("+e+")"}).toString()}function p(e){if(!URL.createObjectURL)return e;e=e.replace(/^data:image\/png;base64,/,"");for(var t=atob(e),n=[],i=0;i<t.length;i+=512){for(var r=t.slice(i,i+512),o=new Array(r.length),s=0;s<r.length;s++)o[s]=r.charCodeAt(s);var a=new Uint8Array(o);n.push(a)}var l=new Blob(n,{type:"image/png"});return URL.createObjectURL(l)}t.default=d,e.exports=t.default},2625:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(0),r=n(9),o=v(n(5)),s=v(n(26)),a=v(n(2626)),l=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var t=p();if(t&&t.has(e))return t.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var o=i?Object.getOwnPropertyDescriptor(e,r):null;o&&(o.get||o.set)?Object.defineProperty(n,r,o):n[r]=e[r]}n.default=e,t&&t.set(e,n);return n}(n(1)),d=v(n(2627)),c=v(n(2628));function p(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return p=function(){return e},e}function v(e){return e&&e.__esModule?e:{default:e}}var h,u=function(e){function t(t){var n=e.call(this,t)||this;return n.onBlur=function(e){e.stopPropagation(),setTimeout(function(){n.confirmEdit()},300)},n.onKeyDown=function(e){13===e.keyCode?n.confirmEdit():(n.labelInput.value=n.labelInput.value.trim().substr(0,80),n.updateInputHeight())},n.confirmEdit=function(){n.updateRevision(n.labelInput.value),n.setState({editing:!1})},n.handleClick=function(e){e.stopPropagation()},n.startEdit=function(e){e.stopPropagation(),n.setState({editing:!0},function(){n.labelInput.focus(),n.labelInput.select(),n.updateInputHeight()})},n.handleDelete=function(e){e.stopPropagation(),n.setState({visible:!0})},n.handleOk=function(){n.props.handleDelete(n.props.item,n.props.index),n.setState({visible:!1})},n.handleCancel=function(){n.setState({visible:!1})},n.handleSelected=function(e){e.stopPropagation(),e.preventDefault(),n.props.handleSelected(n.props.item,n.props.index)},n.state={editing:!1,visible:!1},n}return(0,i.__extends)(t,e),t.prototype.updateInputHeight=function(){this.labelInput.style.height="18px",this.labelInput.scrollHeight>=this.labelInput.offsetHeight&&(this.labelInput.style.height=this.labelInput.scrollHeight-5+"px")},t.prototype.updateRevision=function(e){if(e=e.trim()){var t=this.props.item;if(e!==t.label){var n=(0,a.default)({},t,{label:e});this.props.handleRename(n,this.props.index)}}},t.prototype.renderEditing=function(){var e=this;return l.createElement("div",{className:"pr-wrap"},l.createElement("div",{className:"pr-label"},l.createElement("textarea",{defaultValue:this.props.item.label,ref:function(t){return e.labelInput=t},spellCheck:!1,onBlur:this.onBlur,onKeyDown:this.onKeyDown,onClick:this.handleClick})),l.createElement("span",{className:"pr-ok",onClick:this.handleClick},(0,o.default)("确定")))},t.prototype.renderReading=function(){var e=this.props.item,t=e.createdAt,n=e.label;return l.createElement("div",{className:"pr-wrap"},l.createElement("div",{className:"pr-label"},n," ",(0,o.default)("版本")),l.createElement("span",{className:"pr-time"},(0,r.formatTime)(t)),l.createElement("div",{className:"pr-delete",onClick:this.handleDelete},l.createElement("span",{className:"preview-delete-icon"},l.createElement(d.default,null)),(0,o.default)("删除")),l.createElement("div",{className:"pr-edit",onClick:this.startEdit},l.createElement("span",{className:"preview-edit-icon"},l.createElement(c.default,null)),(0,o.default)("重命名")))},t.prototype.render=function(){var e=this.props.item,t=e.User,n=e.label,a=(0,s.default)("pr-container",{selected:this.props.selected});return l.createElement("div",{className:a,onClick:this.handleSelected},l.createElement("div",{className:"pr-header"},this.state.editing?this.renderEditing():this.renderReading()),l.createElement("div",{className:"pr-content"},l.createElement("span",{className:"pr-user"},t.name),(0,o.default)("保存")),l.createElement(r.Modal,{title:(0,o.default)("删除版本"),okText:(0,o.default)("确定"),cancelText:(0,o.default)("取消"),onOk:this.handleOk,onCancel:this.handleCancel,visible:this.state.visible},(0,o.default)(h||(h=(0,i.__makeTemplateObject)(["确认删除历史版本","吗？"],["确认删除历史版本","吗？"])),n),l.createElement("br",null),(0,o.default)("该删除不会影响文档内容")))},t}(l.Component);t.default=u,e.exports=t.default},2626:function(e,t,n){"use strict";var i=n(483),r=n(183),o=n(917),s=n(246),a=n(315),l=n(247),d=Object.prototype.hasOwnProperty,c=o(function(e,t){if(a(t)||s(t))r(t,l(t),e);else for(var n in t)d.call(t,n)&&i(e,n,t[n])});e.exports=c},2627:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i,r=(i=n(1))&&i.__esModule?i:{default:i};var o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},s=function(e){var t,n;function i(){return e.apply(this,arguments)||this}return n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n,i.prototype.render=function(){var e=(window.performance||window.Date).now()+"-"+Math.floor(1e11*Math.random()),t=(window.performance||window.Date).now()+"-"+Math.floor(1e11*Math.random()),n=(window.performance||window.Date).now()+"-"+Math.floor(1e11*Math.random()),i=(window.performance||window.Date).now()+"-"+Math.floor(1e11*Math.random()),s=(window.performance||window.Date).now()+"-"+Math.floor(1e11*Math.random()),a=(window.performance||window.Date).now()+"-"+Math.floor(1e11*Math.random()),l=(window.performance||window.Date).now()+"-"+Math.floor(1e11*Math.random()),d=(window.performance||window.Date).now()+"-"+Math.floor(1e11*Math.random()),c=(window.performance||window.Date).now()+"-"+Math.floor(1e11*Math.random());return r.default.createElement("svg",o({width:"20",height:"24",viewBox:"0 0 20 24",xmlns:"http://www.w3.org/2000/svg"},this.props),r.default.createElement("defs",null,r.default.createElement("linearGradient",{x1:"50%",y1:"0%",x2:"50%",y2:"100%",id:e},r.default.createElement("stop",{stopColor:"#A1A1A1",offset:"0%"}),r.default.createElement("stop",{stopColor:"#B4B4B4",offset:"100%"}))),r.default.createElement("g",{id:t,fill:"none",fillRule:"evenodd"},r.default.createElement("g",{id:n,transform:"translate(-5106 -874)",fill:"url(#"+e+")"},r.default.createElement("g",{id:i,transform:"translate(4396 329)"},r.default.createElement("g",{id:s,transform:"translate(0 210)"},r.default.createElement("g",{id:a,transform:"translate(0 223)"},r.default.createElement("g",{transform:"translate(707 106)",id:l},r.default.createElement("g",{id:d,transform:"translate(0 5)"},r.default.createElement("path",{d:"M10.273 2.818V1h5.454v1.818h6.281c.548 0 .992.45.992 1v1.727H3V3.818c0-.552.455-1 .992-1h6.28zM4.818 7.364h16.364v16.269c0 .554-.455 1.003-1 1.003H5.818a.998.998 0 0 1-.999-1.003V7.363zM8.455 11v9.095c0 .5.407.905.909.905.505 0 .909-.405.909-.905V11H8.455zm3.636 0v9.095c0 .5.407.905.909.905.506 0 .91-.405.91-.905V11h-1.82zm3.636 0v9.095c0 .5.407.905.91.905.505 0 .908-.405.908-.905V11h-1.818z",id:c})))))))))},i}(r.default.Component);t.default=s,e.exports=t.default},2628:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i,r=(i=n(1))&&i.__esModule?i:{default:i};var o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},s=function(e){var t,n;function i(){return e.apply(this,arguments)||this}return n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n,i.prototype.render=function(){var e=(window.performance||window.Date).now()+"-"+Math.floor(1e11*Math.random()),t=(window.performance||window.Date).now()+"-"+Math.floor(1e11*Math.random()),n=(window.performance||window.Date).now()+"-"+Math.floor(1e11*Math.random()),i=(window.performance||window.Date).now()+"-"+Math.floor(1e11*Math.random()),s=(window.performance||window.Date).now()+"-"+Math.floor(1e11*Math.random()),a=(window.performance||window.Date).now()+"-"+Math.floor(1e11*Math.random()),l=(window.performance||window.Date).now()+"-"+Math.floor(1e11*Math.random()),d=(window.performance||window.Date).now()+"-"+Math.floor(1e11*Math.random()),c=(window.performance||window.Date).now()+"-"+Math.floor(1e11*Math.random());return r.default.createElement("svg",o({width:"24",height:"21",viewBox:"0 0 24 21",xmlns:"http://www.w3.org/2000/svg"},this.props),r.default.createElement("defs",null,r.default.createElement("linearGradient",{x1:"50%",y1:"0%",x2:"50%",y2:"100%",id:e},r.default.createElement("stop",{stopColor:"#A1A1A1",offset:"0%"}),r.default.createElement("stop",{stopColor:"#B4B4B4",offset:"100%"}))),r.default.createElement("g",{id:t,fill:"none",fillRule:"evenodd"},r.default.createElement("g",{id:n,transform:"translate(-4970 -876)",fill:"url(#"+e+")",fillRule:"nonzero"},r.default.createElement("g",{id:i,transform:"translate(4396 329)"},r.default.createElement("g",{id:s,transform:"translate(0 210)"},r.default.createElement("g",{id:a,transform:"translate(0 223)"},r.default.createElement("g",{transform:"translate(573 106)",id:l},r.default.createElement("g",{id:d,transform:"translate(0 5)"},r.default.createElement("path",{d:"M1 24h4.279L18 10.868 14.125 7 1 20.189V24zM21.707 5.435l-2.072-2.09c-.46-.46-1.395-.46-1.854 0L15 6.152 18.812 10l2.783-2.806c.459-.46.57-1.297.112-1.76zM10.743 22L9 24h16v-2H10.743z",id:c})))))))))},i}(r.default.Component);t.default=s,e.exports=t.default},2629:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i,r=(i=n(1))&&i.__esModule?i:{default:i};var o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},s=function(e){var t,n;function i(){return e.apply(this,arguments)||this}return n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n,i.prototype.render=function(){return r.default.createElement("svg",o({"data-name":"Layer 1",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 15.6 15.6"},this.props),r.default.createElement("path",{d:"M9.2 7.8l6.4-6.4L14.2 0 7.8 6.4 1.4 0 0 1.4l6.4 6.4L0 14.2l1.4 1.4 6.4-6.4 6.4 6.4 1.4-1.4z",fill:"#a5a5a5"}))},i}(r.default.Component);t.default=s,e.exports=t.default},2630:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i,r=(i=n(1))&&i.__esModule?i:{default:i};var o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},s=function(e){var t,n;function i(){return e.apply(this,arguments)||this}return n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n,i.prototype.render=function(){return r.default.createElement("svg",o({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 26 24"},this.props),r.default.createElement("path",{d:"M5.6 20.6l1.3-1.5c3.9 3.9 10.2 3.9 14.1 0 3.9-3.9 3.9-10.3 0-14.2C17.1 1 10.9 1 7 4.9l-.1.1C5.2 6.6 4.2 8.8 4 11.1H2C2.5 4.5 8.3-.4 14.9.1s11.5 6.3 11 12.9c-.5 6.6-6.2 11.5-12.8 11-2.8-.2-5.5-1.4-7.5-3.4z",fill:"#73a2e3"}),r.default.createElement("path",{fill:"#73a2e3",d:"M3.5 16L7 10H0z"}),r.default.createElement("path",{d:"M16.6 14.5L14 11",fill:"none",stroke:"#73a2e3",strokeWidth:"2",strokeLinecap:"round"}),r.default.createElement("path",{d:"M12.9 6h2v5c0 .6-.4 1-1 1s-1-.4-1-1V6z",fill:"#73a2e3"}))},i}(r.default.Component);t.default=s,e.exports=t.default},2631:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i={SAVE:"revision/save",REVERT:"revision/revert",QUIT:"revision/quit",ENTER:"revision/enter",LENGTHCHANGE:"revision/length-change"};t.default=i,e.exports=t.default},3:function(e,n){e.exports=t},58:function(e,t){e.exports=r},6:function(e,t){e.exports=n}},[[2617,0,1]]])});
!function(t,e){if("object"==typeof exports&&"object"==typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var n=e();for(var o in n)("object"==typeof exports?exports:t)[o]=n[o]}}("undefined"!=typeof self?self:this,function(){return function(t){var e={};function n(o){if(e[o])return e[o].exports;var r=e[o]={i:o,l:!1,exports:{}};return t[o].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=t,n.c=e,n.d=function(t,e,o){n.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:o})},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="https://assets.smcdn.cn/sheet/",n(n.s=1013)}([function(t,e){t.exports=React},function(t,e){t.exports=shimo.sdk.sheet},function(module,exports,__webpack_require__){"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},__assign=function(){return(__assign=Object.assign||function(t){for(var e,n=1,o=arguments.length;n<o;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)},__awaiter=function(t,e,n,o){return new(n||(n=Promise))(function(r,i){function s(t){try{c(o.next(t))}catch(t){i(t)}}function a(t){try{c(o.throw(t))}catch(t){i(t)}}function c(t){t.done?r(t.value):new n(function(e){e(t.value)}).then(s,a)}c((o=o.apply(t,e||[])).next())})},__generator=function(t,e){var n,o,r,i,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,o=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(r=(r=s.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){s=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){s.label=i[1];break}if(6===i[0]&&s.label<r[1]){s.label=r[1],r=i;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(i);break}r[2]&&s.ops.pop(),s.trys.pop();continue}i=e.call(t,s)}catch(t){i=[6,t],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}},_this=void 0;Object.defineProperty(exports,"__esModule",{value:!0});var locale_1=__webpack_require__(66),interweave=function(t,e){return t.map(function(n,o){return o===t.length-1?n:""+n+e[o]}).join("")},currentLocale="zh-CN",fallbackLocale="zh-CN",localeCache={},fetchLocaleSync,fetchLocale=function(t){throw new Error("'fetchLocale' is not provided, see: 's18n.configure()'")},getLocale=function(){return currentLocale},configure=function(t){if(t.fetchLocale){if("function"!=typeof t.fetchLocale)throw new Error("fetchLocale should be an async function resolving with locale resource");fetchLocale=t.fetchLocale}else{if(!t.fetchLocaleSync)throw new Error("Requiring at least one parameter: fetchLocale or fetchLocaleSync");fetchLocaleSync=t.fetchLocaleSync}},addLocaleResource=function(t,e){if(!locale_1.isValidLocaleResource(e))throw new Error("fetched locale resource is invalid");localeCache[t]=__assign({},localeCache[t]||{},e)},updateLocaleResource=function(t,e){return __awaiter(_this,void 0,void 0,function(){var n;return __generator(this,function(o){switch(o.label){case 0:if(!e&&localeCache[t])return[3,2];if(!fetchLocale)throw new Error("'fetchLocale' is not provided, see: 's18n.configure()'");return[4,fetchLocale(t)];case 1:n=o.sent(),addLocaleResource(t,n),o.label=2;case 2:return[2]}})})},setLocaleSync=function(t){if("string"!=typeof t)throw new Error("'locale' is required");if(!fetchLocaleSync)throw new Error("'fetchLocaleSync' is not provided, see: 's18n.configure()'");var e=fetchLocaleSync(t);addLocaleResource(t,e),currentLocale=t},setLocaleAsync=function(t,e){return __awaiter(_this,void 0,void 0,function(){return __generator(this,function(n){switch(n.label){case 0:if("string"!=typeof t)throw new Error("'locale' is required");return[4,updateLocaleResource(t)];case 1:return n.sent(),currentLocale=t,"string"==typeof e&&(updateLocaleResource(e),fallbackLocale=e),[2]}})})},getTextResult=function(t,e){return e&&e[t]},PLACEHOLDER_RE=/%(s|\d)/g,getInterpolateResult=function getInterpolateResult(parts,values,resource){try{if(!resource)return;var key=locale_1.rawTextToKey({type:"interpolated",textParts:parts}),translation=resource[key];if(!translation)return;var valueMap_1={},i_1=0;key.replace(PLACEHOLDER_RE,function(t){return valueMap_1[t]=values[i_1],i_1+=1,t});var interpolate=function(t,e){return t.replace(PLACEHOLDER_RE,function(n){return null!==e[n]?String(e[n]):(console.warn("[s18n] interpolation failed:",{str:t,valueMap:e}),n)})};if("string"==typeof translation)return interpolate(translation,valueMap_1);if("object"===(void 0===translation?"undefined":_typeof(translation))){for(var conditions=Object.keys(translation),index=0;index<conditions.length;index++){var conditionTemplate=conditions[index],conditionInterpolated=interpolate(conditionTemplate,valueMap_1),passed=eval(conditionInterpolated);if(passed)return interpolate(translation[conditionTemplate],valueMap_1)}return}return void console.warn("[s18n] Unexpected value: "+JSON.stringify(translation))}catch(t){var args={parts:parts,values:values,resource:resource};return console.error("[s18n] error when translating: ",args),void console.error(t)}},s18n=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(1===t.length){var n=t[0],o=getTextResult(n,localeCache[currentLocale]);if("string"==typeof o)return o;var r=getTextResult(n,localeCache[fallbackLocale]);return"string"==typeof r?r:n}var i=t[0],s=t.slice(1);return getInterpolateResult(i,s,localeCache[currentLocale])||getInterpolateResult(i,s,localeCache[fallbackLocale])||interweave(i,s)};s18n.configure=configure,s18n.addLocaleResource=addLocaleResource,s18n.setLocaleAsync=setLocaleAsync,s18n.setLocaleSync=setLocaleSync,s18n.getLocale=getLocale,module.exports=s18n,exports.default=s18n},function(t,e){var n=Array.isArray;t.exports=n},,function(t,e,n){(function(t,o){var r=n(88),i={function:!0,object:!0},s=i[typeof e]&&e&&!e.nodeType?e:void 0,a=i[typeof t]&&t&&!t.nodeType?t:void 0,c=r(s&&a&&"object"==typeof o&&o),u=r(i[typeof self]&&self),l=r(i[typeof window]&&window),h=r(i[typeof this]&&this),m=c||l!==(h&&h.window)&&l||u||h||Function("return this")();t.exports=m}).call(e,n(30)(t),n(20))},function(t,e){t.exports=function(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}},function(t,e){t.exports=ReactDOM},function(t,e,n){var o=n(87);t.exports=function(t,e){var n=t[e];return o(n)?n:void 0}},function(t,e){t.exports=function(t){return!!t&&"object"==typeof t}},function(t,e,n){var o=n(39),r=n(77),i=n(58),s=n(11),a=n(23),c=n(28);t.exports=function(t){var e=c(t);if(!e&&!s(t))return r(t);var n=i(t),u=!!n,l=n||[],h=l.length;for(var m in t)!o(t,m)||u&&("length"==m||a(m,h))||e&&"constructor"==m||l.push(m);return l}},function(t,e,n){var o=n(79),r=n(14),i=n(12);t.exports=function(t){return null!=t&&i(o(t))&&!r(t)}},function(t,e){var n=9007199254740991;t.exports=function(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=n}},function(t,e,n){"use strict";e.e=function(t){var e=document.createEvent("Event");e.initEvent("click",!0,!0),t.dispatchEvent(e)},e.c=function(t){return/^http:\/\//.test(t)},n.d(e,"b",function(){return o}),n.d(e,"a",function(){return r}),n.d(e,"d",function(){return i});var o="ActiveXObject"in window,r=window.navigator.userAgent.indexOf("Edge")>-1,i=window.navigator.userAgent.indexOf("Windows")>-1},function(t,e,n){var o=n(6),r="[object Function]",i="[object GeneratorFunction]",s=Object.prototype.toString;t.exports=function(t){var e=o(t)?s.call(t):"";return e==r||e==i}},function(t,e,n){var o=n(9),r="[object Symbol]",i=Object.prototype.toString;t.exports=function(t){return"symbol"==typeof t||o(t)&&i.call(t)==r}},function(t,e,n){var o=n(100),r=n(101),i=n(102),s=n(103),a=n(104);function c(t){var e=-1,n=t?t.length:0;for(this.clear();++e<n;){var o=t[e];this.set(o[0],o[1])}}c.prototype.clear=o,c.prototype.delete=r,c.prototype.get=i,c.prototype.has=s,c.prototype.set=a,t.exports=c},function(t,e,n){var o=n(29);t.exports=function(t,e){for(var n=t.length;n--;)if(o(t[n][0],e))return n;return-1}},function(t,e,n){var o=n(8)(Object,"create");t.exports=o},function(t,e,n){var o=n(118);t.exports=function(t,e){var n=t.__data__;return o(e)?n["string"==typeof e?"string":"hash"]:n.map}},function(t,e){var n;n=function(){return this}();try{n=n||Function("return this")()||(0,eval)("this")}catch(t){"object"==typeof window&&(n=window)}t.exports=n},,function(t,e,n){var o;
/*!
  Copyright (c) 2017 Jed Watson.
  Licensed under the MIT License (MIT), see
  http://jedwatson.github.io/classnames
*/
/*!
  Copyright (c) 2017 Jed Watson.
  Licensed under the MIT License (MIT), see
  http://jedwatson.github.io/classnames
*/
!function(){"use strict";var n={}.hasOwnProperty;function r(){for(var t=[],e=0;e<arguments.length;e++){var o=arguments[e];if(o){var i=typeof o;if("string"===i||"number"===i)t.push(o);else if(Array.isArray(o)&&o.length){var s=r.apply(null,o);s&&t.push(s)}else if("object"===i)for(var a in o)n.call(o,a)&&o[a]&&t.push(a)}}return t.join(" ")}void 0!==t&&t.exports?(r.default=r,t.exports=r):void 0===(o=function(){return r}.apply(e,[]))||(t.exports=o)}()},function(t,e){var n=9007199254740991,o=/^(?:0|[1-9]\d*)$/;t.exports=function(t,e){return!!(e=null==e?n:e)&&("number"==typeof t||o.test(t))&&t>-1&&t%1==0&&t<e}},function(t,e,n){var o=n(15),r=1/0;t.exports=function(t){if("string"==typeof t||o(t))return t;var e=t+"";return"0"==e&&1/t==-r?"-0":e}},,,,function(t,e){var n=Object.prototype;t.exports=function(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||n)}},function(t,e){t.exports=function(t,e){return t===e||t!=t&&e!=e}},function(t,e){t.exports=function(t){return t.webpackPolyfill||(t.deprecate=function(){},t.paths=[],t.children||(t.children=[]),Object.defineProperty(t,"loaded",{enumerable:!0,get:function(){return t.l}}),Object.defineProperty(t,"id",{enumerable:!0,get:function(){return t.i}}),t.webpackPolyfill=1),t}},function(t,e,n){var o=n(3),r=n(15),i=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,s=/^\w*$/;t.exports=function(t,e){if(o(t))return!1;var n=typeof t;return!("number"!=n&&"symbol"!=n&&"boolean"!=n&&null!=t&&!r(t))||s.test(t)||!i.test(t)||null!=e&&t in Object(e)}},function(t,e,n){var o=n(110),r=n(117),i=n(119),s=n(120),a=n(121);function c(t){var e=-1,n=t?t.length:0;for(this.clear();++e<n;){var o=t[e];this.set(o[0],o[1])}}c.prototype.clear=o,c.prototype.delete=r,c.prototype.get=i,c.prototype.has=s,c.prototype.set=a,t.exports=c},function(t,e,n){var o=n(61),r="[object Arguments]",i=Object.prototype,s=i.hasOwnProperty,a=i.toString,c=i.propertyIsEnumerable;t.exports=function(t){return o(t)&&s.call(t,"callee")&&(!c.call(t,"callee")||a.call(t)==r)}},function(t,e,n){var o=n(3),r=n(9),i="[object String]",s=Object.prototype.toString;t.exports=function(t){return"string"==typeof t||!o(t)&&r(t)&&s.call(t)==i}},,function(t,e){t.exports=function(t){var e=!1;if(null!=t&&"function"!=typeof t.toString)try{e=!!(t+"")}catch(t){}return e}},function(t,e,n){var o=n(89),r=n(44),i=n(90),s=n(80),a=n(91),c=n(41),u=Object.prototype.toString,l=c(o),h=c(r),m=c(i),d=c(s),f=c(a);function p(t){return u.call(t)}(o&&"[object DataView]"!=p(new o(new ArrayBuffer(1)))||r&&"[object Map]"!=p(new r)||i&&"[object Promise]"!=p(i.resolve())||s&&"[object Set]"!=p(new s)||a&&"[object WeakMap]"!=p(new a))&&(p=function(t){var e=u.call(t),n="[object Object]"==e?t.constructor:void 0,o=n?c(n):void 0;if(o)switch(o){case l:return"[object DataView]";case h:return"[object Map]";case m:return"[object Promise]";case d:return"[object Set]";case f:return"[object WeakMap]"}return e}),t.exports=p},function(t,e,n){"use strict";var o=n(154),r=n(155),i=n(156),s=n(157),a=n(158),c=n(159),u=n(160);n.d(e,"h",function(){return o.a}),n.d(e,"a",function(){return r.a}),n.d(e,"g",function(){return i.a}),n.d(e,"e",function(){return s.a}),n.d(e,"d",function(){return a.a}),n.d(e,"b",function(){return c.a}),n.d(e,"k",function(){return u.a});var l=n(161);n.d(e,"j",function(){return l.d}),n.d(e,"i",function(){return l.c}),n.d(e,"f",function(){return l.b}),n.d(e,"l",function(){return l.e}),n.d(e,"c",function(){return l.a})},function(t,e,n){var o=n(57),r=Object.prototype.hasOwnProperty;t.exports=function(t,e){return r.call(t,e)||"object"==typeof t&&e in t&&null===o(t)}},,function(t,e){var n=Function.prototype.toString;t.exports=function(t){if(null!=t){try{return n.call(t)}catch(t){}try{return t+""}catch(t){}}return""}},,function(t,e,n){var o=n(16),r=n(105),i=n(106),s=n(107),a=n(108),c=n(109);function u(t){this.__data__=new o(t)}u.prototype.clear=r,u.prototype.delete=i,u.prototype.get=s,u.prototype.has=a,u.prototype.set=c,t.exports=u},function(t,e,n){var o=n(8)(n(5),"Map");t.exports=o},function(t,e,n){var o=n(5).Symbol;t.exports=o},function(t,e){t.exports=function(t){var e=-1,n=Array(t.size);return t.forEach(function(t,o){n[++e]=[o,t]}),n}},function(t,e){t.exports=function(t){return function(e){return null==e?void 0:e[t]}}},function(t,e,n){var o=n(14),r=n(6),i=n(15),s=NaN,a=/^\s+|\s+$/g,c=/^[-+]0x[0-9a-f]+$/i,u=/^0b[01]+$/i,l=/^0o[0-7]+$/i,h=parseInt;t.exports=function(t){if("number"==typeof t)return t;if(i(t))return s;if(r(t)){var e=o(t.valueOf)?t.valueOf():t;t=r(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=t.replace(a,"");var n=u.test(t);return n||l.test(t)?h(t.slice(2),n?2:8):c.test(t)?s:+t}},function(t,e,n){var o=n(170),r=n(176),i=n(147),s=n(3),a=n(183);t.exports=function(t){return"function"==typeof t?t:null==t?i:"object"==typeof t?s(t)?r(t[0],t[1]):o(t):a(t)}},function(t,e,n){var o=n(76),r=n(97),i=1,s=2;t.exports=function(t,e,n,a,c,u){var l=c&s,h=t.length,m=e.length;if(h!=m&&!(l&&m>h))return!1;var d=u.get(t);if(d)return d==e;var f=-1,p=!0,_=c&i?new o:void 0;for(u.set(t,e);++f<h;){var v=t[f],g=e[f];if(a)var y=l?a(g,v,f,e,t,u):a(v,g,f,t,e,u);if(void 0!==y){if(y)continue;p=!1;break}if(_){if(!r(e,function(t,e){if(!_.has(e)&&(v===t||n(v,t,a,c,u)))return _.add(e)})){p=!1;break}}else if(v!==g&&!n(v,g,a,c,u)){p=!1;break}}return u.delete(t),p}},function(t,e,n){var o=n(29),r=Object.prototype.hasOwnProperty;t.exports=function(t,e,n){var i=t[e];r.call(t,e)&&o(i,n)&&(void 0!==n||e in t)||(t[e]=n)}},function(t,e,n){var o=n(122),r=n(6),i=n(9);t.exports=function t(e,n,s,a,c){return e===n||(null==e||null==n||!r(e)&&!i(n)?e!=e&&n!=n:o(e,n,t,s,a,c))}},,,,function(t,e){t.exports=function(t){var e=-1,n=Array(t.size);return t.forEach(function(t){n[++e]=t}),n}},function(t,e){var n=Object.getPrototypeOf;t.exports=function(t){return n(Object(t))}},function(t,e,n){var o=n(78),r=n(33),i=n(3),s=n(12),a=n(34);t.exports=function(t){var e=t?t.length:void 0;return s(e)&&(i(t)||a(t)||r(t))?o(e,String):null}},function(t,e){t.exports=function(t,e){for(var n=-1,o=t.length,r=Array(o);++n<o;)r[n]=e(t[n],n,t);return r}},,function(t,e,n){var o=n(11),r=n(9);t.exports=function(t){return r(t)&&o(t)}},,function(t,e,n){var o=n(51);t.exports=function(t,e,n,r){n||(n={});for(var i=-1,s=e.length;++i<s;){var a=e[i],c=r?r(n[a],t[a],a,n,t):t[a];o(n,a,c)}return n}},,,function(t,e,n){"use strict";var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};Object.defineProperty(e,"__esModule",{value:!0});var r=n(67);e.DEFAULT_LOCALES=["af","ar","az","be","bg","bn","bs","ca","cs","cy","da","de","de-AT","de-CH","de-DE","el","el-CY","en","en-AU","en-CA","en-GB","en-IE","en-IN","en-NZ","en-US","en-ZA","en-CY,eo","es","es-419","es-AR","es-CL","es-CO","es-CR","es-EC","es-ES","es-MX","es-NI","es-PA","es-PE","es-US","es-VE","et","eu","fa","fi","fr","fr-CA","fr-CH","fr-FR","gl","he","hi","hi-IN","hr","hu","id","is","it","it-CH","ja","ka","km","kn","ko","lb","lo","lt","lv","mk","ml","mn","mr-IN","ms","nb","ne","nl","nn","oc","or","pa","pl","pt","pt-BR","rm","ro","ru","sk","sl","sq","sr","sw","ta","te","th","tl","tr","tt","ug","ur","uz","vi","wo","zh-CN","zh-HK","zh-TW","zh-YUE"],e.isValidLocaleResource=function(t){return!!t&&(!Array.isArray(t)&&("object"===(void 0===t?"undefined":o(t))&&Object.keys(t).every(function(e){var n=t[e];return null==n||"string"==typeof n||"object"===(void 0===n?"undefined":o(n))})))},e.rawTextToKey=function(t){switch(t.type){case"string":return t.text;case"interpolated":var e=t.textParts.length;return 1===e?t.textParts[0]:2===e?t.textParts[0]+"%s"+t.textParts[1]:t.textParts.map(function(e,n){return n===t.textParts.length-1?e:e+"%"+(n+1)}).join("");default:return r.assertNever(t)}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.assertNever=function(t){throw new Error("unexpected type: "+JSON.stringify(t))}},,,function(t,e,n){var o=n(5).Uint8Array;t.exports=o},function(t,e,n){var o=n(133),r=n(83),i="Expected a function",s=Math.max;t.exports=function(t,e){if("function"!=typeof t)throw new TypeError(i);return e=s(void 0===e?t.length-1:r(e),0),function(){for(var n=arguments,r=-1,i=s(n.length-e,0),a=Array(i);++r<i;)a[r]=n[e+r];switch(e){case 0:return t.call(this,a);case 1:return t.call(this,n[0],a);case 2:return t.call(this,n[0],n[1],a)}var c=Array(e+1);for(r=-1;++r<e;)c[r]=n[r];return c[e]=a,o(t,this,c)}}},function(t,e,n){"use strict";var o=n(0),r=n.n(o),i=n(7),s=n.n(i),a=n(73),c=n(13),u=this&&this.__extends||function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),l=function(t){function e(e){var n=t.call(this,e)||this;return n.toggleOpen=function(){n.setState({open:!n.state.open,style:null})},n.close=function(){n.setState({open:!1,style:null})},n.checkClick=function(t){var e=s.a.findDOMNode(n),o=t.target;!e.contains(o)&&n.state.open&&n.close()},n.adjustStyle=function(){var t=s.a.findDOMNode(n);if(!c.b&&!c.a||!t.querySelector(".menu--submenu")){var e=t.lastElementChild.getBoundingClientRect(),o=e.top,r=e.bottom,i={},a=window.innerHeight-50;r>a&&(i.maxHeight=a-o,i.overflowY="auto"),n.setState({style:i})}},n.state={open:!1,style:null},n}return u(e,t),e.prototype.componentDidMount=function(){this.bindClick()},e.prototype.componentDidUpdate=function(t,e){this.state.open&&!e.open?(this.props.onOpen&&this.props.onOpen(),this.adjustStyle()):!this.state.open&&e.open&&this.props.onClose&&this.props.onClose()},e.prototype.componentWillUnmount=function(){this.unbindClick()},e.prototype.render=function(){var t=this,e="menu "+(this.props.customClass?this.props.customClass:"")+" "+(this.state.open?"menu__open":"")+" "+(this.props.disabled?"disabled":"");return r.a.createElement(a.a.Provider,{value:{closeMenu:this.close}},r.a.createElement("div",{className:e},r.a.cloneElement(this.props.head,{onClick:function(e){var n=t.props.head.props.onClick;n&&n(e),t.toggleOpen()}}),this.state.open&&r.a.createElement("div",{className:"menu--body"},r.a.createElement("div",{className:"menu--content",style:this.state.style},this.renderChildren()))))},e.prototype.bindClick=function(){document.addEventListener("click",this.checkClick,!1)},e.prototype.unbindClick=function(){document.removeEventListener("click",this.checkClick,!1)},e.prototype.renderChildren=function(){var t=this.props.children;if("function"==typeof t){if(t.cache)return t.cache;var e=t();return t.cache=e,e}return t},e}(r.a.Component);e.a=l},function(t,e,n){"use strict";n.d(e,"a",function(){return r});var o=n(0),r=n.n(o).a.createContext({closeMenu:function(){}})},function(t,e,n){"use strict";e.a=function(t){return{background:'url("'+t+'") center no-repeat'}}},,function(t,e,n){var o=n(32),r=n(123),i=n(124);function s(t){var e=-1,n=t?t.length:0;for(this.__data__=new o;++e<n;)this.add(t[e])}s.prototype.add=s.prototype.push=r,s.prototype.has=i,t.exports=s},function(t,e){var n=Object.keys;t.exports=function(t){return n(Object(t))}},function(t,e){t.exports=function(t,e){for(var n=-1,o=Array(t);++n<t;)o[n]=e(n);return o}},function(t,e,n){var o=n(47)("length");t.exports=o},function(t,e,n){var o=n(8)(n(5),"Set");t.exports=o},function(t,e,n){var o=n(82),r=n(31),i=n(24);t.exports=function(t,e){for(var n=0,s=(e=r(e,t)?[e]:o(e)).length;null!=t&&n<s;)t=t[i(e[n++])];return n&&n==s?t:void 0}},function(t,e,n){var o=n(3),r=n(178);t.exports=function(t){return o(t)?t:r(t)}},function(t,e,n){var o=n(94);t.exports=function(t){var e=o(t),n=e%1;return e==e?n?e-n:e:0}},function(t,e){t.exports=Zepto},,,function(t,e,n){var o=n(14),r=n(36),i=n(6),s=n(41),a=/^\[object .+?Constructor\]$/,c=Object.prototype,u=Function.prototype.toString,l=c.hasOwnProperty,h=RegExp("^"+u.call(l).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");t.exports=function(t){return!!i(t)&&(o(t)||r(t)?h:a).test(s(t))}},function(t,e){t.exports=function(t){return t&&t.Object===Object?t:null}},function(t,e,n){var o=n(8)(n(5),"DataView");t.exports=o},function(t,e,n){var o=n(8)(n(5),"Promise");t.exports=o},function(t,e,n){var o=n(8)(n(5),"WeakMap");t.exports=o},function(t,e,n){var o=n(6);t.exports=function(t){return t==t&&!o(t)}},function(t,e){t.exports=function(t,e){return function(n){return null!=n&&n[t]===e&&(void 0!==e||t in Object(n))}}},function(t,e,n){var o=n(48),r=1/0,i=1.7976931348623157e308;t.exports=function(t){return t?(t=o(t))===r||t===-r?(t<0?-1:1)*i:t==t?t:0:0===t?t:0}},,,function(t,e){t.exports=function(t,e){for(var n=-1,o=t.length;++n<o;)if(e(t[n],n,t))return!0;return!1}},function(t,e,n){var o=n(218),r=n(219)(o);t.exports=r},,function(t,e){t.exports=function(){this.__data__=[]}},function(t,e,n){var o=n(17),r=Array.prototype.splice;t.exports=function(t){var e=this.__data__,n=o(e,t);return!(n<0||(n==e.length-1?e.pop():r.call(e,n,1),0))}},function(t,e,n){var o=n(17);t.exports=function(t){var e=this.__data__,n=o(e,t);return n<0?void 0:e[n][1]}},function(t,e,n){var o=n(17);t.exports=function(t){return o(this.__data__,t)>-1}},function(t,e,n){var o=n(17);t.exports=function(t,e){var n=this.__data__,r=o(n,t);return r<0?n.push([t,e]):n[r][1]=e,this}},function(t,e,n){var o=n(16);t.exports=function(){this.__data__=new o}},function(t,e){t.exports=function(t){return this.__data__.delete(t)}},function(t,e){t.exports=function(t){return this.__data__.get(t)}},function(t,e){t.exports=function(t){return this.__data__.has(t)}},function(t,e,n){var o=n(16),r=n(32),i=200;t.exports=function(t,e){var n=this.__data__;return n instanceof o&&n.__data__.length==i&&(n=this.__data__=new r(n.__data__)),n.set(t,e),this}},function(t,e,n){var o=n(111),r=n(16),i=n(44);t.exports=function(){this.__data__={hash:new o,map:new(i||r),string:new o}}},function(t,e,n){var o=n(112),r=n(113),i=n(114),s=n(115),a=n(116);function c(t){var e=-1,n=t?t.length:0;for(this.clear();++e<n;){var o=t[e];this.set(o[0],o[1])}}c.prototype.clear=o,c.prototype.delete=r,c.prototype.get=i,c.prototype.has=s,c.prototype.set=a,t.exports=c},function(t,e,n){var o=n(18);t.exports=function(){this.__data__=o?o(null):{}}},function(t,e){t.exports=function(t){return this.has(t)&&delete this.__data__[t]}},function(t,e,n){var o=n(18),r="__lodash_hash_undefined__",i=Object.prototype.hasOwnProperty;t.exports=function(t){var e=this.__data__;if(o){var n=e[t];return n===r?void 0:n}return i.call(e,t)?e[t]:void 0}},function(t,e,n){var o=n(18),r=Object.prototype.hasOwnProperty;t.exports=function(t){var e=this.__data__;return o?void 0!==e[t]:r.call(e,t)}},function(t,e,n){var o=n(18),r="__lodash_hash_undefined__";t.exports=function(t,e){return this.__data__[t]=o&&void 0===e?r:e,this}},function(t,e,n){var o=n(19);t.exports=function(t){return o(this,t).delete(t)}},function(t,e){t.exports=function(t){var e=typeof t;return"string"==e||"number"==e||"symbol"==e||"boolean"==e?"__proto__"!==t:null===t}},function(t,e,n){var o=n(19);t.exports=function(t){return o(this,t).get(t)}},function(t,e,n){var o=n(19);t.exports=function(t){return o(this,t).has(t)}},function(t,e,n){var o=n(19);t.exports=function(t,e){return o(this,t).set(t,e),this}},function(t,e,n){var o=n(43),r=n(50),i=n(125),s=n(126),a=n(37),c=n(3),u=n(36),l=n(127),h=2,m="[object Arguments]",d="[object Array]",f="[object Object]",p=Object.prototype.hasOwnProperty;t.exports=function(t,e,n,_,v,g){var y=c(t),C=c(e),w=d,b=d;y||(w=(w=a(t))==m?f:w),C||(b=(b=a(e))==m?f:b);var x=w==f&&!u(t),S=b==f&&!u(e),O=w==b;if(O&&!x)return g||(g=new o),y||l(t)?r(t,e,n,_,v,g):i(t,e,w,n,_,v,g);if(!(v&h)){var R=x&&p.call(t,"__wrapped__"),E=S&&p.call(e,"__wrapped__");if(R||E){var L=R?t.value():t,M=E?e.value():e;return g||(g=new o),n(L,M,_,v,g)}}return!!O&&(g||(g=new o),s(t,e,n,_,v,g))}},function(t,e){var n="__lodash_hash_undefined__";t.exports=function(t){return this.__data__.set(t,n),this}},function(t,e){t.exports=function(t){return this.__data__.has(t)}},function(t,e,n){var o=n(45),r=n(70),i=n(50),s=n(46),a=n(56),c=1,u=2,l="[object Boolean]",h="[object Date]",m="[object Error]",d="[object Map]",f="[object Number]",p="[object RegExp]",_="[object Set]",v="[object String]",g="[object Symbol]",y="[object ArrayBuffer]",C="[object DataView]",w=o?o.prototype:void 0,b=w?w.valueOf:void 0;t.exports=function(t,e,n,o,w,x,S){switch(n){case C:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case y:return!(t.byteLength!=e.byteLength||!o(new r(t),new r(e)));case l:case h:return+t==+e;case m:return t.name==e.name&&t.message==e.message;case f:return t!=+t?e!=+e:t==+e;case p:case v:return t==e+"";case d:var O=s;case _:var R=x&u;if(O||(O=a),t.size!=e.size&&!R)return!1;var E=S.get(t);return E?E==e:(x|=c,S.set(t,e),i(O(t),O(e),o,w,x,S));case g:if(b)return b.call(t)==b.call(e)}return!1}},function(t,e,n){var o=n(39),r=n(10),i=2;t.exports=function(t,e,n,s,a,c){var u=a&i,l=r(t),h=l.length;if(h!=r(e).length&&!u)return!1;for(var m=h;m--;){var d=l[m];if(!(u?d in e:o(e,d)))return!1}var f=c.get(t);if(f)return f==e;var p=!0;c.set(t,e);for(var _=u;++m<h;){var v=t[d=l[m]],g=e[d];if(s)var y=u?s(g,v,d,e,t,c):s(v,g,d,t,e,c);if(!(void 0===y?v===g||n(v,g,s,a,c):y)){p=!1;break}_||(_="constructor"==d)}if(p&&!_){var C=t.constructor,w=e.constructor;C!=w&&"constructor"in t&&"constructor"in e&&!("function"==typeof C&&C instanceof C&&"function"==typeof w&&w instanceof w)&&(p=!1)}return c.delete(t),p}},function(t,e,n){var o=n(12),r=n(9),i={};i["[object Float32Array]"]=i["[object Float64Array]"]=i["[object Int8Array]"]=i["[object Int16Array]"]=i["[object Int32Array]"]=i["[object Uint8Array]"]=i["[object Uint8ClampedArray]"]=i["[object Uint16Array]"]=i["[object Uint32Array]"]=!0,i["[object Arguments]"]=i["[object Array]"]=i["[object ArrayBuffer]"]=i["[object Boolean]"]=i["[object DataView]"]=i["[object Date]"]=i["[object Error]"]=i["[object Function]"]=i["[object Map]"]=i["[object Number]"]=i["[object Object]"]=i["[object RegExp]"]=i["[object Set]"]=i["[object String]"]=i["[object WeakMap]"]=!1;var s=Object.prototype.toString;t.exports=function(t){return r(t)&&o(t.length)&&!!i[s.call(t)]}},,,,function(t,e){t.exports=function(t,e,n,o){var r=-1,i=t.length;for(o&&i&&(n=t[++r]);++r<i;)n=e(n,t[r],r,t);return n}},,function(t,e){t.exports=function(t,e,n){switch(n.length){case 0:return t.call(e);case 1:return t.call(e,n[0]);case 2:return t.call(e,n[0],n[1]);case 3:return t.call(e,n[0],n[1],n[2])}return t.apply(e,n)}},,,,,,,,,,,function(t,e,n){var o=n(165);t.exports=function(t){return null==t?"":o(t)}},function(t,e,n){var o=n(6),r=n(186),i=n(48),s="Expected a function",a=Math.max,c=Math.min;t.exports=function(t,e,n){var u,l,h,m,d,f=0,p=0,_=!1,v=!1,g=!0;if("function"!=typeof t)throw new TypeError(s);function y(e){var n=u,o=l;return u=l=void 0,p=e,m=t.apply(o,n)}function C(t){var n=t-f;return!f||n>=e||n<0||v&&t-p>=h}function w(){var t=r();if(C(t))return b(t);d=setTimeout(w,function(t){var n=e-(t-f);return v?c(n,h-(t-p)):n}(t))}function b(t){return clearTimeout(d),d=void 0,g&&u?y(t):(u=l=void 0,m)}function x(){var t=r(),n=C(t);if(u=arguments,l=this,f=t,n){if(void 0===d)return function(t){return p=t,d=setTimeout(w,e),_?y(t):m}(f);if(v)return clearTimeout(d),d=setTimeout(w,e),y(f)}return void 0===d&&(d=setTimeout(w,e)),m}return e=i(e)||0,o(n)&&(_=!!n.leading,h=(v="maxWait"in n)?a(i(n.maxWait)||0,e):h,g="trailing"in n?!!n.trailing:g),x.cancel=function(){void 0!==d&&clearTimeout(d),f=p=0,u=l=d=void 0},x.flush=function(){return void 0===d?m:b(r())},x}},function(t,e,n){var o=n(187)();t.exports=o},function(t,e){t.exports=function(t){return t}},function(t,e,n){var o=n(51),r=n(63),i=n(167),s=n(11),a=n(28),c=n(10),u=Object.prototype,l=u.hasOwnProperty,h=!u.propertyIsEnumerable.call({valueOf:1},"valueOf"),m=i(function(t,e){if(h||a(e)||s(e))r(e,c(e),t);else for(var n in e)l.call(e,n)&&o(t,n,e[n])});t.exports=m},function(t,e,n){var o=n(29),r=n(11),i=n(23),s=n(6);t.exports=function(t,e,n){if(!s(n))return!1;var a=typeof e;return!!("number"==a?r(n)&&i(e,n.length):"string"==a&&e in n)&&o(n[e],t)}},,,,,function(t,e,n){"use strict";var o=n(0),r=n.n(o),i=n(72),s=this&&this.__extends||function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),a=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.onOpen=function(t){e.props.onOpen&&e.props.onOpen(),t&&(t.markAsOld(),e.forceUpdate())},e}return s(e,t),e.prototype.render=function(){var t=function(t){return t?(t instanceof Array?t:[t]).find(function(t){return t.visible}):void 0}(this.props.feature),e=t&&t.tooltip;return r.a.createElement(i.a,{head:r.a.createElement("span",{className:"tabMenuHead"},this.props.tabName(),e),customClass:"tabMenu",disabled:this.props.disabled,onOpen:this.onOpen.bind(this,t)},this.props.children)},e}(r.a.Component);e.a=a},function(t,e,n){"use strict";e.a=function(t){return r.a.createElement(i.a,{head:r.a.cloneElement(t.head,{className:"dropMenuHead indicator "+(t.head.props.className||"")}),disabled:t.disabled,customClass:t.customClass,onClose:t.onClose,onOpen:t.onOpen},t.children)};var o=n(0),r=n.n(o),i=n(72)},function(t,e,n){"use strict";var o=n(0),r=n.n(o),i=n(13),s=this&&this.__extends||function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),a=function(t){function e(e){var n=t.call(this,e)||this;return n.showSubMenu=function(){n.setState({showSubMenu:!0})},n.hideSubMenu=function(t){n.notReallyLeaveMe(t)||n.setState({showSubMenu:!1,style:null})},n.adjustStyle=function(){var t=window.innerHeight,e=window.innerWidth,o=n.refs.itemDom,r=n.refs.contentDom.getBoundingClientRect(),i=r.right,s=r.height,a=o.getBoundingClientRect(),c=a.bottom,u=a.left,l=a.right,h=a.top,m=n.getRefPosition(),d=m.left,f=m.top,p={position:"fixed",transform:"translateX(0)",left:l-1-d,top:h-f},_=c-78,v=t-c-30;s>v&&(s<_||v/t<.25?(p.maxHeight=_,p.top=c-Math.min(s,_)-f,s>_&&(p.overflowY="auto")):(p.maxHeight=v,p.overflowY="auto")),e-i<50&&(p.left=u-d,p.transform="translateX(-100%)"),n.setState({style:p})},n.state={showSubMenu:!1,style:null},n}return s(e,t),e.prototype.componentDidUpdate=function(t,e){this.state.showSubMenu&&!e.showSubMenu&&this.adjustStyle()},e.prototype.render=function(){return r.a.createElement("div",{ref:"containerDom",className:"menu--submenu",onMouseLeave:this.hideSubMenu},r.a.createElement("div",{ref:"itemDom",className:"menuItem "+(this.props.disabled?"disabled":""),onMouseEnter:this.showSubMenu},void 0!==this.props.icon&&r.a.createElement("span",{className:"menuItem--icon "+(this.props.icon?"icon--"+this.props.icon:"")}),r.a.createElement("span",{className:"menuItem--text"},this.props.text),r.a.createElement("span",{className:"menuItem--placer"}),r.a.createElement("span",{className:"menuItem--arrow"})),this.state.showSubMenu&&r.a.createElement("div",{ref:"contentDom",className:"menu--content menu--content__submenu",style:this.state.style},this.props.children))},e.prototype.getRefPosition=function(){if(i.b)return{left:0,top:0};for(var t=this.refs.containerDom;t.parentElement;){var e=getComputedStyle(t);if("static"!==e.position&&"none"!==e.transform)break;t=t.parentElement}var n=t.getBoundingClientRect(),o=n.left;return{top:n.top,left:o}},e.prototype.notReallyLeaveMe=function(t){var e=t.pageX,n=t.pageY,o=this.refs.itemDom.getBoundingClientRect(),r=o.left,i=o.top,s=o.right,a=o.bottom;return e>r&&e<s&&n>i&&n<a},e}(r.a.Component);e.a=a},function(t,e,n){"use strict";var o=n(0),r=n.n(o),i=n(73),s=n(74),a=n(13),c=this&&this.__extends||function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),u=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return c(e,t),e.prototype.render=function(){var t=this,e="fake"===this.props.disabled?"fakeDisabled":this.props.disabled?"disabled":"",n=this.props.customClass||"";return r.a.createElement(i.a.Consumer,null,function(o){return r.a.createElement("div",{className:"menuItem tooltip--docker "+e+" "+n+" "+t.props.className,onClick:function(){return t.onClick(o)}},void 0!==t.props.checked&&r.a.createElement("span",{className:"menuItem--check "+(t.props.checked?"menuItem--check__checked":"")}),void 0!==t.props.icon&&t.getIcon(t.props.icon),t.props.text&&r.a.createElement("span",{className:"menuItem--text"},t.props.text),t.props.text&&r.a.createElement("span",{className:"menuItem--placer"}),t.props.children)})},e.prototype.onClick=function(t){!this.props.disabled&&this.props.onTap&&this.props.onTap(),setTimeout(function(){return t.closeMenu()})},e.prototype.getIcon=function(t){return Object(a.c)(t)?r.a.createElement("span",{className:"menuItem--icon",style:Object(s.a)(t)}):r.a.createElement("span",{className:"menuItem--icon "+(t?"icon--"+t:"")})},e}(r.a.Component);e.a=u},function(t,e,n){"use strict";e.a=function(){return r.a.createElement("div",{className:"menu--divider"})};var o=n(0),r=n.n(o)},function(t,e,n){"use strict";var o=n(0),r=n.n(o),i=n(13),s=n(74),a=this&&this.__extends||function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),c=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.onTap=function(){e.props.onTap&&e.props.onTap()},e}return a(e,t),e.prototype.render=function(){var t="toolBar--iconBtn "+(this.props.disabled?"disabled":"")+" "+(this.props.selected?"selected":"")+" indicator";return this.props.children?r.a.createElement("span",{className:t+" tooltip--docker",onClick:this.onTap},this.getIcon(this.props.icon)):this.props.tooltip?r.a.createElement("span",{className:t,"data-tooltip":this.props.tooltip,onClick:this.onTap},this.getIcon(this.props.icon)):r.a.createElement("span",{className:t,onClick:this.onTap},this.getIcon(this.props.icon))},e.prototype.getIcon=function(t){return Object(i.c)(t)?r.a.createElement("span",{style:Object(s.a)(t)},this.props.children):r.a.createElement("span",{className:"toolBar--icon icon--"+t},this.props.children)},e}(r.a.Component);e.a=c},function(t,e,n){"use strict";e.a=function(t){return t.option?r.a.createElement("span",{className:"tooltip tooltip__"+(t.direction||"down")},r.a.createElement("span",null,t.option),t.detail&&r.a.createElement("br",null),t.detail&&r.a.createElement("span",null,t.detail)):null};var o=n(0),r=n.n(o)},function(t,e,n){"use strict";e.d=function(t){return r.a.createElement("span",{className:u(t,"toolBar--tool")},t.children)},n.d(e,"c",function(){return l}),e.a=function(t){return r.a.createElement("span",{className:u(t,"toolBar--iconDropTool indicator "+(t.selected?"fakeIndicator":""))},t.children)},e.b=function(t){return r.a.createElement("span",{className:u(t,"toolBar--tool toolBar--tool__oneline")},t.children)},e.e=function(t){return r.a.createElement("span",{className:u(t,"toolBar--tool toolBar--tool__twolines")},t.children)};var o=n(0),r=n.n(o),i=n(13),s=n(22),a=n.n(s),c=this&&this.__extends||function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();function u(t,e){var n,o=t.disabled,r=t.customClass;return a()(((n={})[e]=!0,n[r||""]=r,n.disabled=o,n))}var l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.delegateClick=function(t){var n=e.refs.textTool,o=n.lastElementChild;if(t.target===n||t.target===o){var r=n.querySelector(".toolBar--icon");setTimeout(function(){return Object(i.e)(r)})}},e}return c(e,t),e.prototype.render=function(){return r.a.createElement("span",{ref:"textTool",className:u(this.props,"toolBar--tool toolBar--textTool"),onClick:this.delegateClick},this.props.children)},e}(r.a.Component)},,,function(t,e,n){var o=n(173)(n(10));t.exports=o},function(t,e,n){var o=n(45),r=n(15),i=1/0,s=o?o.prototype:void 0,a=s?s.toString:void 0;t.exports=function(t){if("string"==typeof t)return t;if(r(t))return a?a.call(t):"";var e=t+"";return"0"==e&&1/t==-i?"-0":e}},function(t,e){t.exports=function(t,e){for(var n=-1,o=t.length;++n<o&&!1!==e(t[n],n,t););return t}},function(t,e,n){var o=n(149),r=n(71);t.exports=function(t){return r(function(e,n){var r=-1,i=n.length,s=i>1?n[i-1]:void 0,a=i>2?n[2]:void 0;for(s=t.length>3&&"function"==typeof s?(i--,s):void 0,a&&o(n[0],n[1],a)&&(s=i<3?void 0:s,i=1),e=Object(e);++r<i;){var c=n[r];c&&t(e,c,r,s)}return e})}},,,function(t,e,n){var o=n(171),r=n(172),i=n(93);t.exports=function(t){var e=r(t);return 1==e.length&&e[0][2]?i(e[0][0],e[0][1]):function(n){return n===t||o(n,t,e)}}},function(t,e,n){var o=n(43),r=n(52),i=1,s=2;t.exports=function(t,e,n,a){var c=n.length,u=c,l=!a;if(null==t)return!u;for(t=Object(t);c--;){var h=n[c];if(l&&h[2]?h[1]!==t[h[0]]:!(h[0]in t))return!1}for(;++c<u;){var m=(h=n[c])[0],d=t[m],f=h[1];if(l&&h[2]){if(void 0===d&&!(m in t))return!1}else{var p=new o;if(a)var _=a(d,f,m,t,e,p);if(!(void 0===_?r(f,d,a,i|s,p):_))return!1}}return!0}},function(t,e,n){var o=n(92),r=n(164);t.exports=function(t){for(var e=r(t),n=e.length;n--;)e[n][2]=o(e[n][1]);return e}},function(t,e,n){var o=n(174),r=n(37),i=n(46),s=n(175),a="[object Map]",c="[object Set]";t.exports=function(t){return function(e){var n=r(e);return n==a?i(e):n==c?s(e):o(e,t(e))}}},function(t,e,n){var o=n(59);t.exports=function(t,e){return o(e,function(e){return[e,t[e]]})}},function(t,e){t.exports=function(t){var e=-1,n=Array(t.size);return t.forEach(function(t){n[++e]=[t,t]}),n}},function(t,e,n){var o=n(52),r=n(177),i=n(180),s=n(31),a=n(92),c=n(93),u=n(24),l=1,h=2;t.exports=function(t,e){return s(t)&&a(e)?c(u(t),e):function(n){var s=r(n,t);return void 0===s&&s===e?i(n,t):o(e,s,void 0,l|h)}}},function(t,e,n){var o=n(81);t.exports=function(t,e,n){var r=null==t?void 0:o(t,e);return void 0===r?n:r}},function(t,e,n){var o=n(179),r=n(144),i=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]/g,s=/\\(\\)?/g,a=o(function(t){var e=[];return r(t).replace(i,function(t,n,o,r){e.push(o?r.replace(s,"$1"):n||t)}),e});t.exports=a},function(t,e,n){var o=n(32),r="Expected a function";function i(t,e){if("function"!=typeof t||e&&"function"!=typeof e)throw new TypeError(r);var n=function(){var o=arguments,r=e?e.apply(this,o):o[0],i=n.cache;if(i.has(r))return i.get(r);var s=t.apply(this,o);return n.cache=i.set(r,s),s};return n.cache=new(i.Cache||o),n}i.Cache=o,t.exports=i},function(t,e,n){var o=n(181),r=n(182);t.exports=function(t,e){return null!=t&&r(t,e,o)}},function(t,e){t.exports=function(t,e){return e in Object(t)}},function(t,e,n){var o=n(82),r=n(33),i=n(3),s=n(23),a=n(31),c=n(12),u=n(34),l=n(24);t.exports=function(t,e,n){for(var h,m=-1,d=(e=a(e,t)?[e]:o(e)).length;++m<d;){var f=l(e[m]);if(!(h=null!=t&&n(t,f)))break;t=t[f]}return h||!!(d=t?t.length:0)&&c(d)&&s(f,d)&&(i(t)||u(t)||r(t))}},function(t,e,n){var o=n(47),r=n(184),i=n(31),s=n(24);t.exports=function(t){return i(t)?o(s(t)):r(t)}},function(t,e,n){var o=n(81);t.exports=function(t){return function(e){return o(e,t)}}},function(t,e){t.exports=function(t,e){for(var n=-1,o=e.length,r=t.length;++n<o;)t[r+n]=e[n];return t}},function(t,e){var n=Date.now;t.exports=n},function(t,e){t.exports=function(t){return function(e,n,o){for(var r=-1,i=Object(e),s=o(e),a=s.length;a--;){var c=s[t?a:++r];if(!1===n(i[c],c,i))break}return e}}},,,,,,,,,,,,,,,,,,,,,function(t,e,n){"use strict";var o=Object.prototype.hasOwnProperty,r="~";function i(){}function s(t,e,n,o,i){if("function"!=typeof n)throw new TypeError("The listener must be a function");var s=new function(t,e,n){this.fn=t,this.context=e,this.once=n||!1}(n,o||t,i),a=r?r+e:e;return t._events[a]?t._events[a].fn?t._events[a]=[t._events[a],s]:t._events[a].push(s):(t._events[a]=s,t._eventsCount++),t}function a(t,e){0==--t._eventsCount?t._events=new i:delete t._events[e]}function c(){this._events=new i,this._eventsCount=0}Object.create&&(i.prototype=Object.create(null),(new i).__proto__||(r=!1)),c.prototype.eventNames=function(){var t,e,n=[];if(0===this._eventsCount)return n;for(e in t=this._events)o.call(t,e)&&n.push(r?e.slice(1):e);return Object.getOwnPropertySymbols?n.concat(Object.getOwnPropertySymbols(t)):n},c.prototype.listeners=function(t){var e=r?r+t:t,n=this._events[e];if(!n)return[];if(n.fn)return[n.fn];for(var o=0,i=n.length,s=new Array(i);o<i;o++)s[o]=n[o].fn;return s},c.prototype.listenerCount=function(t){var e=r?r+t:t,n=this._events[e];return n?n.fn?1:n.length:0},c.prototype.emit=function(t,e,n,o,i,s){var a=r?r+t:t;if(!this._events[a])return!1;var c,u,l=this._events[a],h=arguments.length;if(l.fn){switch(l.once&&this.removeListener(t,l.fn,void 0,!0),h){case 1:return l.fn.call(l.context),!0;case 2:return l.fn.call(l.context,e),!0;case 3:return l.fn.call(l.context,e,n),!0;case 4:return l.fn.call(l.context,e,n,o),!0;case 5:return l.fn.call(l.context,e,n,o,i),!0;case 6:return l.fn.call(l.context,e,n,o,i,s),!0}for(u=1,c=new Array(h-1);u<h;u++)c[u-1]=arguments[u];l.fn.apply(l.context,c)}else{var m,d=l.length;for(u=0;u<d;u++)switch(l[u].once&&this.removeListener(t,l[u].fn,void 0,!0),h){case 1:l[u].fn.call(l[u].context);break;case 2:l[u].fn.call(l[u].context,e);break;case 3:l[u].fn.call(l[u].context,e,n);break;case 4:l[u].fn.call(l[u].context,e,n,o);break;default:if(!c)for(m=1,c=new Array(h-1);m<h;m++)c[m-1]=arguments[m];l[u].fn.apply(l[u].context,c)}}return!0},c.prototype.on=function(t,e,n){return s(this,t,e,n,!1)},c.prototype.once=function(t,e,n){return s(this,t,e,n,!0)},c.prototype.removeListener=function(t,e,n,o){var i=r?r+t:t;if(!this._events[i])return this;if(!e)return a(this,i),this;var s=this._events[i];if(s.fn)s.fn!==e||o&&!s.once||n&&s.context!==n||a(this,i);else{for(var c=0,u=[],l=s.length;c<l;c++)(s[c].fn!==e||o&&!s[c].once||n&&s[c].context!==n)&&u.push(s[c]);u.length?this._events[i]=1===u.length?u[0]:u:a(this,i)}return this},c.prototype.removeAllListeners=function(t){var e;return t?(e=r?r+t:t,this._events[e]&&a(this,e)):(this._events=new i,this._eventsCount=0),this},c.prototype.off=c.prototype.removeListener,c.prototype.addListener=c.prototype.on,c.prefixed=r,c.EventEmitter=c,t.exports=c},function(t,e,n){"use strict";e.a={edit:"edit",insert:"insert",format:"format",data:"data",view:"view",help:"help"}},function(t,e,n){Object.defineProperty(e,"__esModule",{value:!0}),e.genGuid=function(t){var e=17,n=[];for(;e-=1;)n.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789"[parseInt(62*Math.random())]);var o=n.join("");if(t)return t+"-"+o;return o},e.nodeText=function(t){return t.innerText||t.textContent||t.nodeValue||""},e.getCookie=function(t){var e=("; "+document.cookie).split("; "+t+"=");if(2===e.length)return e.pop().split(";").shift()},e.isNumeric=r,e.getFractionLen=function(t){var e=String(t),n=0;!isNaN(Number(t))&&e.indexOf(".")>-1&&(n=e.split(".")[1].length);return n},e.isBigNumber=function(t){if(r(t)&&t.toString().trim().split(".")[0].length>15)return!0;return!1},e.isValidNumber=function(t){if(r(t)&&t.toString().length<=16)return!0;return!1},e.strToNum=function(t){if(r(t)&&t.toString().length<=16)return Number(t,10);return t},e.translateNumber=function(t){var e,n,r,i,s,a,c,u,l,h,m,d,f,p;if(i=(0,o.default)("零"),e=["",(0,o.default)("一"),(0,o.default)("二"),(0,o.default)("三"),(0,o.default)("四"),(0,o.default)("五"),(0,o.default)("六"),(0,o.default)("七"),(0,o.default)("八"),(0,o.default)("九")],r=["",(0,o.default)("十"),(0,o.default)("百"),(0,o.default)("千")],n=["",(0,o.default)("万"),(0,o.default)("亿"),(0,o.default)("兆")],""===t)return"";if(""===(t=t.replace(/^0+/g,"")))return i;for(f="",c=!0,h=!1,u=l=0,d=t.length;d>=0?l<d:l>d;u=d>=0?++l:--l)m=t.length-1-u,s=parseInt(t[u]),a=(m-(p=m%r.length))/r.length,0!==s&&(h&&(f+=i),(1!==s||1!==p||!c||0===a&&h)&&(f+=e[s]),f+=r[p]),c=c&&0===s,0!==p||c||(f+=n[a]),h=0===s&&(0!==p||c),0===p&&(c=!0);return f};var o=function(t){return t&&t.__esModule?t:{default:t}}(n(2));function r(t){var e=t&&t.toString();return!/^0+\d+$/.test(e)&&e-parseFloat(e)+1>=0}},,,,,,,function(t,e,n){var o=n(166),r=n(98),i=n(49),s=n(3);t.exports=function(t,e){return(s(t)?o:r)(t,i(e,3))}},function(t,e,n){var o=n(146),r=n(10);t.exports=function(t,e){return t&&o(t,e,r)}},function(t,e,n){var o=n(11);t.exports=function(t,e){return function(n,r){if(null==n)return n;if(!o(n))return t(n,r);for(var i=n.length,s=e?i:-1,a=Object(n);(e?s--:++s<i)&&!1!==r(a[s],s,a););return n}}},,,,,,,,,function(t,e,n){var o=n(247);t.exports=function(t,e,n){if(e!=e)return o(t,n);for(var r=n-1,i=t.length;++r<i;)if(t[r]===e)return r;return-1}},function(t,e,n){var o=n(185),r=n(372);t.exports=function t(e,n,i,s,a){var c=-1,u=e.length;for(i||(i=r),a||(a=[]);++c<u;){var l=e[c];n>0&&i(l)?n>1?t(l,n-1,i,s,a):o(a,l):s||(a[a.length]=l)}return a}},,,,,,,,,,,,,,,,,,function(t,e){t.exports=function(t,e,n){for(var o=t.length,r=e+(n?0:-1);n?r--:++r<o;){var i=t[r];if(i!=i)return r}return-1}},,,,,,,,,,,,,,,,,,,,,,,function(t,e,n){var o=n(296),r=n(58),i=n(23),s=n(28),a=Object.prototype.hasOwnProperty;t.exports=function(t){for(var e=-1,n=s(t),c=o(t),u=c.length,l=r(t),h=!!l,m=l||[],d=m.length;++e<u;){var f=c[e];h&&("length"==f||i(f,d))||"constructor"==f&&(n||!a.call(t,f))||m.push(f)}return m}},,,,,,,,,,,,,,,,,,,,,,,,,,function(t,e,n){var o=n(297),r=n(298),i=Object.prototype,s=o?o.enumerate:void 0,a=i.propertyIsEnumerable;function c(t){t=null==t?t:Object(t);var e=[];for(var n in t)e.push(n);return e}s&&!a.call({valueOf:1},"valueOf")&&(c=function(t){return r(s(t))}),t.exports=c},function(t,e,n){var o=n(5).Reflect;t.exports=o},function(t,e){t.exports=function(t){for(var e,n=[];!(e=t.next()).done;)n.push(e.value);return n}},,,function(t,e,n){var o=n(145),r=n(6),i="Expected a function";t.exports=function(t,e,n){var s=!0,a=!0;if("function"!=typeof t)throw new TypeError(i);return r(n)&&(s="leading"in n?!!n.leading:s,a="trailing"in n?!!n.trailing:a),o(t,e,{leading:s,maxWait:e,trailing:a})}},,,,,,,,,,,,,,,,function(t,e){t.exports=function(){}},,,,,,,,,,,,,function(t,e){t.exports=function(t){var e=t?t.length:0;return e?t[e-1]:void 0}},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(t,e){t.exports=function(t){return function(e){return t(e)}}},function(t,e,n){var o=n(33),r=n(3);t.exports=function(t){return r(t)||o(t)}},function(t,e,n){var o=n(59),r=n(229),i=n(374),s=n(71),a=n(24),c=s(function(t,e){return null==t?{}:i(t,o(r(e,1),a))});t.exports=c},function(t,e,n){var o=n(131);t.exports=function(t,e){return t=Object(t),o(e,function(e,n){return n in t&&(e[n]=t[n]),e},{})}},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(t,e,n){(function(t){Object.defineProperty(e,"__esModule",{value:!0});var o=h(["","分钟前"],["","分钟前"]),r=h(["今天 ",""],["今天 ",""]),i=h(["昨天 ",""],["昨天 ",""]);e.autoRefresh=function(e){var n=(0,a.default)(e)?t(e):e;m.push(n)},e.format=f,e.sortByDate=function(t){var e=0,n=[[]];return(0,c.default)(t,function t(o){return function(t){switch(e){case 0:return _(t);case 1:return _(t,864e5);case 2:return _(t,6048e5);case 3:return _(t,2592e6);default:return!0}}(o.lastUsedAt)?n[e].push(o):(n[++e]=[],t(o))}),n},e.sortByDay=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"lastUsedAt",n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],o={},r=[];for(var i in(0,c.default)(t,function(t){var n=new Date(t[e]),r=n.getFullYear()+"/"+p(n.getMonth()+1)+"/"+p(n.getDate());o.hasOwnProperty(r)||(o[r]=[]),o[r].push(t)}),o)o.hasOwnProperty(i)&&r.push({timestamp:i,timeLabel:f(i,!1,!1,!0,"／"),files:o[i]});var s=n?"desc":"asc";return(0,u.default)(r,["timestamp"],[s])};var s=l(n(2)),a=l(n(34)),c=l(n(217)),u=l(n(591));function l(t){return t&&t.__esModule?t:{default:t}}function h(t,e){return Object.freeze(Object.defineProperties(t,{raw:{value:Object.freeze(e)}}))}var m=[];function d(e){e.find("[data-time]").each(function(e){var n=t(e);return n.html(f(n.attr("data-time"),"1"===n.attr("full")))})}function f(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"/",u=new Date,l=+u/1e3,h=new Date(t),m=l-+new Date(t)/1e3;if(n){if(m<60)return(0,s.default)("刚刚");if(m<3600)return(0,s.default)(o,parseInt(m/60,10))}var d=new Date(u.getFullYear()+"/"+(u.getMonth()+1)+"/"+u.getDate()+" 00:00:00")-new Date(t)+864e5,f=p(h.getHours())+":"+p(h.getMinutes());if(d>0&&d<=864e5)return a?(0,s.default)("今天"):(0,s.default)(r,f);if(d>864e5&&d<=1728e5)return a?(0,s.default)("昨天"):(0,s.default)(i,f);var _=""+(h.getMonth()+1)+c+h.getDate()+" "+f;return a&&(_=""+(h.getMonth()+1)+c+h.getDate()),(e||h.getFullYear()!==u.getFullYear())&&(_=""+h.getFullYear()+c+_),_}function p(t){return t<10?"0"+t:t}function _(t,e){var n=null;n=e?new Date(new Date(t).valueOf()+e):new Date(t);var o=new Date;return n.setHours(0,0,0,0)>=o.setHours(0,0,0,0)}window.setInterval(function(){for(var t=0;t<m.length;t++){d(m[t])}},15e3)}).call(e,n(84))},function(t,e,n){"use strict";var o=Object.prototype.hasOwnProperty,r=Array.isArray,i=function(){for(var t=[],e=0;e<256;++e)t.push("%"+((e<16?"0":"")+e.toString(16)).toUpperCase());return t}(),s=function(t,e){for(var n=e&&e.plainObjects?Object.create(null):{},o=0;o<t.length;++o)void 0!==t[o]&&(n[o]=t[o]);return n};t.exports={arrayToObject:s,assign:function(t,e){return Object.keys(e).reduce(function(t,n){return t[n]=e[n],t},t)},combine:function(t,e){return[].concat(t,e)},compact:function(t){for(var e=[{obj:{o:t},prop:"o"}],n=[],o=0;o<e.length;++o)for(var i=e[o],s=i.obj[i.prop],a=Object.keys(s),c=0;c<a.length;++c){var u=a[c],l=s[u];"object"==typeof l&&null!==l&&-1===n.indexOf(l)&&(e.push({obj:s,prop:u}),n.push(l))}return function(t){for(;t.length>1;){var e=t.pop(),n=e.obj[e.prop];if(r(n)){for(var o=[],i=0;i<n.length;++i)void 0!==n[i]&&o.push(n[i]);e.obj[e.prop]=o}}}(e),t},decode:function(t,e,n){var o=t.replace(/\+/g," ");if("iso-8859-1"===n)return o.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(o)}catch(t){return o}},encode:function(t,e,n){if(0===t.length)return t;var o=t;if("symbol"==typeof t?o=Symbol.prototype.toString.call(t):"string"!=typeof t&&(o=String(t)),"iso-8859-1"===n)return escape(o).replace(/%u[0-9a-f]{4}/gi,function(t){return"%26%23"+parseInt(t.slice(2),16)+"%3B"});for(var r="",s=0;s<o.length;++s){var a=o.charCodeAt(s);45===a||46===a||95===a||126===a||a>=48&&a<=57||a>=65&&a<=90||a>=97&&a<=122?r+=o.charAt(s):a<128?r+=i[a]:a<2048?r+=i[192|a>>6]+i[128|63&a]:a<55296||a>=57344?r+=i[224|a>>12]+i[128|a>>6&63]+i[128|63&a]:(s+=1,a=65536+((1023&a)<<10|1023&o.charCodeAt(s)),r+=i[240|a>>18]+i[128|a>>12&63]+i[128|a>>6&63]+i[128|63&a])}return r},isBuffer:function(t){return!(!t||"object"!=typeof t||!(t.constructor&&t.constructor.isBuffer&&t.constructor.isBuffer(t)))},isRegExp:function(t){return"[object RegExp]"===Object.prototype.toString.call(t)},maybeMap:function(t,e){if(r(t)){for(var n=[],o=0;o<t.length;o+=1)n.push(e(t[o]));return n}return e(t)},merge:function t(e,n,i){if(!n)return e;if("object"!=typeof n){if(r(e))e.push(n);else{if(!e||"object"!=typeof e)return[e,n];(i&&(i.plainObjects||i.allowPrototypes)||!o.call(Object.prototype,n))&&(e[n]=!0)}return e}if(!e||"object"!=typeof e)return[e].concat(n);var a=e;return r(e)&&!r(n)&&(a=s(e,i)),r(e)&&r(n)?(n.forEach(function(n,r){if(o.call(e,r)){var s=e[r];s&&"object"==typeof s&&n&&"object"==typeof n?e[r]=t(s,n,i):e.push(n)}else e[r]=n}),e):Object.keys(n).reduce(function(e,r){var s=n[r];return o.call(e,r)?e[r]=t(e[r],s,i):e[r]=s,e},a)}}},function(t,e,n){var o=n(59);t.exports=function(t,e){return o(e,function(e){return t[e]})}},,,,function(t,e,n){var o=n(228);t.exports=function(t,e){return!!t.length&&o(t,e,0)>-1}},function(t,e){t.exports=function(t,e,n){for(var o=-1,r=t.length;++o<r;)if(n(e,t[o]))return!0;return!1}},function(t,e){t.exports=function(t,e){return t.has(e)}},,,,,,,,,function(t,e,n){var o=n(448),r=n(449),i=n(49),s=n(3);t.exports=function(t,e){return(s(t)?o:r)(t,i(e,3))}},function(t,e){t.exports=function(t,e){for(var n=-1,o=t.length,r=0,i=[];++n<o;){var s=t[n];e(s,n,t)&&(i[r++]=s)}return i}},function(t,e,n){var o=n(98);t.exports=function(t,e){var n=[];return o(t,function(t,o,r){e(t,o,r)&&n.push(t)}),n}},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(t,e,n){var o=n(98),r=n(11);t.exports=function(t,e){var n=-1,i=r(t)?Array(t.length):[];return o(t,function(t,o,r){i[++n]=e(t,o,r)}),i}},,,function(t,e,n){"use strict";var o=String.prototype.replace,r=/%20/g,i=n(431),s={RFC1738:"RFC1738",RFC3986:"RFC3986"};t.exports=i.assign({default:s.RFC3986,formatters:{RFC1738:function(t){return o.call(t,r,"+")},RFC3986:function(t){return String(t)}}},s)},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(t,e,n){"use strict";var o=n(598),r=n(599),i=n(488);t.exports={formats:i,parse:r,stringify:o}},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(t,e,n){var o=n(76),r=n(436),i=n(437),s=n(438),a=n(562),c=n(56),u=200;t.exports=function(t,e,n){var l=-1,h=r,m=t.length,d=!0,f=[],p=f;if(n)d=!1,h=i;else if(m>=u){var _=e?null:a(t);if(_)return c(_);d=!1,h=s,p=new o}else p=e?[]:f;t:for(;++l<m;){var v=t[l],g=e?e(v):v;if(v=n||0!==v?v:0,d&&g==g){for(var y=p.length;y--;)if(p[y]===g)continue t;e&&p.push(g),f.push(v)}else h(p,g,n)||(p!==f&&p.push(g),f.push(v))}return f}},function(t,e,n){var o=n(80),r=n(317),i=n(56),s=o&&1/i(new o([,-0]))[1]==1/0?function(t){return new o(t)}:r;t.exports=s},,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(t,e,n){var o=n(592),r=n(3);t.exports=function(t,e,n,i){return null==t?[]:(r(e)||(e=null==e?[]:[e]),r(n=i?void 0:n)||(n=null==n?[]:[n]),o(t,e,n))}},function(t,e,n){var o=n(59),r=n(49),i=n(485),s=n(593),a=n(371),c=n(594),u=n(147);t.exports=function(t,e,n){var l=-1;e=o(e.length?e:[u],a(r));var h=i(t,function(t,n,r){return{criteria:o(e,function(e){return e(t)}),index:++l,value:t}});return s(h,function(t,e){return c(t,e,n)})}},function(t,e){t.exports=function(t,e){var n=t.length;for(t.sort(e);n--;)t[n]=t[n].value;return t}},function(t,e,n){var o=n(595);t.exports=function(t,e,n){for(var r=-1,i=t.criteria,s=e.criteria,a=i.length,c=n.length;++r<a;){var u=o(i[r],s[r]);if(u)return r>=c?u:u*("desc"==n[r]?-1:1)}return t.index-e.index}},function(t,e,n){var o=n(15);t.exports=function(t,e){if(t!==e){var n=void 0!==t,r=null===t,i=t==t,s=o(t),a=void 0!==e,c=null===e,u=e==e,l=o(e);if(!c&&!l&&!s&&t>e||s&&a&&u&&!c&&!l||r&&a&&u||!n&&u||!i)return 1;if(!r&&!s&&!l&&t<e||l&&n&&i&&!r&&!s||c&&n&&i||!a&&i||!u)return-1}return 0}},,,function(t,e,n){"use strict";var o=n(431),r=n(488),i=Object.prototype.hasOwnProperty,s={brackets:function(t){return t+"[]"},comma:"comma",indices:function(t,e){return t+"["+e+"]"},repeat:function(t){return t}},a=Array.isArray,c=Array.prototype.push,u=function(t,e){c.apply(t,a(e)?e:[e])},l=Date.prototype.toISOString,h=r.default,m={addQueryPrefix:!1,allowDots:!1,charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encoder:o.encode,encodeValuesOnly:!1,format:h,formatter:r.formatters[h],indices:!1,serializeDate:function(t){return l.call(t)},skipNulls:!1,strictNullHandling:!1},d=function t(e,n,r,i,s,c,l,h,d,f,p,_,v){var g=e;if("function"==typeof l?g=l(n,g):g instanceof Date?g=f(g):"comma"===r&&a(g)&&(g=o.maybeMap(g,function(t){return t instanceof Date?f(t):t}).join(",")),null===g){if(i)return c&&!_?c(n,m.encoder,v,"key"):n;g=""}if(function(t){return"string"==typeof t||"number"==typeof t||"boolean"==typeof t||"symbol"==typeof t||"bigint"==typeof t}(g)||o.isBuffer(g))return c?[p(_?n:c(n,m.encoder,v,"key"))+"="+p(c(g,m.encoder,v,"value"))]:[p(n)+"="+p(String(g))];var y,C=[];if(void 0===g)return C;if(a(l))y=l;else{var w=Object.keys(g);y=h?w.sort(h):w}for(var b=0;b<y.length;++b){var x=y[b],S=g[x];if(!s||null!==S){var O=a(g)?"function"==typeof r?r(n,x):n:n+(d?"."+x:"["+x+"]");u(C,t(S,O,r,i,s,c,l,h,d,f,p,_,v))}}return C};t.exports=function(t,e){var n,o=t,c=function(t){if(!t)return m;if(null!==t.encoder&&void 0!==t.encoder&&"function"!=typeof t.encoder)throw new TypeError("Encoder has to be a function.");var e=t.charset||m.charset;if(void 0!==t.charset&&"utf-8"!==t.charset&&"iso-8859-1"!==t.charset)throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var n=r.default;if(void 0!==t.format){if(!i.call(r.formatters,t.format))throw new TypeError("Unknown format option provided.");n=t.format}var o=r.formatters[n],s=m.filter;return("function"==typeof t.filter||a(t.filter))&&(s=t.filter),{addQueryPrefix:"boolean"==typeof t.addQueryPrefix?t.addQueryPrefix:m.addQueryPrefix,allowDots:void 0===t.allowDots?m.allowDots:!!t.allowDots,charset:e,charsetSentinel:"boolean"==typeof t.charsetSentinel?t.charsetSentinel:m.charsetSentinel,delimiter:void 0===t.delimiter?m.delimiter:t.delimiter,encode:"boolean"==typeof t.encode?t.encode:m.encode,encoder:"function"==typeof t.encoder?t.encoder:m.encoder,encodeValuesOnly:"boolean"==typeof t.encodeValuesOnly?t.encodeValuesOnly:m.encodeValuesOnly,filter:s,formatter:o,serializeDate:"function"==typeof t.serializeDate?t.serializeDate:m.serializeDate,skipNulls:"boolean"==typeof t.skipNulls?t.skipNulls:m.skipNulls,sort:"function"==typeof t.sort?t.sort:null,strictNullHandling:"boolean"==typeof t.strictNullHandling?t.strictNullHandling:m.strictNullHandling}}(e);"function"==typeof c.filter?o=(0,c.filter)("",o):a(c.filter)&&(n=c.filter);var l,h=[];if("object"!=typeof o||null===o)return"";l=e&&e.arrayFormat in s?e.arrayFormat:e&&"indices"in e?e.indices?"indices":"repeat":"indices";var f=s[l];n||(n=Object.keys(o)),c.sort&&n.sort(c.sort);for(var p=0;p<n.length;++p){var _=n[p];c.skipNulls&&null===o[_]||u(h,d(o[_],_,f,c.strictNullHandling,c.skipNulls,c.encode?c.encoder:null,c.filter,c.sort,c.allowDots,c.serializeDate,c.formatter,c.encodeValuesOnly,c.charset))}var v=h.join(c.delimiter),g=!0===c.addQueryPrefix?"?":"";return c.charsetSentinel&&("iso-8859-1"===c.charset?g+="utf8=%26%2310003%3B&":g+="utf8=%E2%9C%93&"),v.length>0?g+v:""}},function(t,e,n){"use strict";var o=n(431),r=Object.prototype.hasOwnProperty,i=Array.isArray,s={allowDots:!1,allowPrototypes:!1,arrayLimit:20,charset:"utf-8",charsetSentinel:!1,comma:!1,decoder:o.decode,delimiter:"&",depth:5,ignoreQueryPrefix:!1,interpretNumericEntities:!1,parameterLimit:1e3,parseArrays:!0,plainObjects:!1,strictNullHandling:!1},a=function(t){return t.replace(/&#(\d+);/g,function(t,e){return String.fromCharCode(parseInt(e,10))})},c=function(t,e){return t&&"string"==typeof t&&e.comma&&t.indexOf(",")>-1?t.split(","):t},u=function(t,e,n,o){if(t){var i=n.allowDots?t.replace(/\.([^.[]+)/g,"[$1]"):t,s=/(\[[^[\]]*])/g,a=n.depth>0&&/(\[[^[\]]*])/.exec(i),u=a?i.slice(0,a.index):i,l=[];if(u){if(!n.plainObjects&&r.call(Object.prototype,u)&&!n.allowPrototypes)return;l.push(u)}for(var h=0;n.depth>0&&null!==(a=s.exec(i))&&h<n.depth;){if(h+=1,!n.plainObjects&&r.call(Object.prototype,a[1].slice(1,-1))&&!n.allowPrototypes)return;l.push(a[1])}return a&&l.push("["+i.slice(a.index)+"]"),function(t,e,n,o){for(var r=o?e:c(e,n),i=t.length-1;i>=0;--i){var s,a=t[i];if("[]"===a&&n.parseArrays)s=[].concat(r);else{s=n.plainObjects?Object.create(null):{};var u="["===a.charAt(0)&&"]"===a.charAt(a.length-1)?a.slice(1,-1):a,l=parseInt(u,10);n.parseArrays||""!==u?!isNaN(l)&&a!==u&&String(l)===u&&l>=0&&n.parseArrays&&l<=n.arrayLimit?(s=[])[l]=r:s[u]=r:s={0:r}}r=s}return r}(l,e,n,o)}};t.exports=function(t,e){var n=function(t){if(!t)return s;if(null!==t.decoder&&void 0!==t.decoder&&"function"!=typeof t.decoder)throw new TypeError("Decoder has to be a function.");if(void 0!==t.charset&&"utf-8"!==t.charset&&"iso-8859-1"!==t.charset)throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var e=void 0===t.charset?s.charset:t.charset;return{allowDots:void 0===t.allowDots?s.allowDots:!!t.allowDots,allowPrototypes:"boolean"==typeof t.allowPrototypes?t.allowPrototypes:s.allowPrototypes,arrayLimit:"number"==typeof t.arrayLimit?t.arrayLimit:s.arrayLimit,charset:e,charsetSentinel:"boolean"==typeof t.charsetSentinel?t.charsetSentinel:s.charsetSentinel,comma:"boolean"==typeof t.comma?t.comma:s.comma,decoder:"function"==typeof t.decoder?t.decoder:s.decoder,delimiter:"string"==typeof t.delimiter||o.isRegExp(t.delimiter)?t.delimiter:s.delimiter,depth:"number"==typeof t.depth||!1===t.depth?+t.depth:s.depth,ignoreQueryPrefix:!0===t.ignoreQueryPrefix,interpretNumericEntities:"boolean"==typeof t.interpretNumericEntities?t.interpretNumericEntities:s.interpretNumericEntities,parameterLimit:"number"==typeof t.parameterLimit?t.parameterLimit:s.parameterLimit,parseArrays:!1!==t.parseArrays,plainObjects:"boolean"==typeof t.plainObjects?t.plainObjects:s.plainObjects,strictNullHandling:"boolean"==typeof t.strictNullHandling?t.strictNullHandling:s.strictNullHandling}}(e);if(""===t||null===t||void 0===t)return n.plainObjects?Object.create(null):{};for(var l="string"==typeof t?function(t,e){var n,u={},l=e.ignoreQueryPrefix?t.replace(/^\?/,""):t,h=e.parameterLimit===1/0?void 0:e.parameterLimit,m=l.split(e.delimiter,h),d=-1,f=e.charset;if(e.charsetSentinel)for(n=0;n<m.length;++n)0===m[n].indexOf("utf8=")&&("utf8=%E2%9C%93"===m[n]?f="utf-8":"utf8=%26%2310003%3B"===m[n]&&(f="iso-8859-1"),d=n,n=m.length);for(n=0;n<m.length;++n)if(n!==d){var p,_,v=m[n],g=v.indexOf("]="),y=-1===g?v.indexOf("="):g+1;-1===y?(p=e.decoder(v,s.decoder,f,"key"),_=e.strictNullHandling?null:""):(p=e.decoder(v.slice(0,y),s.decoder,f,"key"),_=o.maybeMap(c(v.slice(y+1),e),function(t){return e.decoder(t,s.decoder,f,"value")})),_&&e.interpretNumericEntities&&"iso-8859-1"===f&&(_=a(_)),v.indexOf("[]=")>-1&&(_=i(_)?[_]:_),r.call(u,p)?u[p]=o.combine(u[p],_):u[p]=_}return u}(t,n):t,h=n.plainObjects?Object.create(null):{},m=Object.keys(l),d=0;d<m.length;++d){var f=m[d],p=u(f,l[f],n,"string"==typeof t);h=o.merge(h,p,n)}return o.compact(h)}},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(t,e,n){"use strict";var o;n.d(e,"a",function(){return o}),function(t){t.LayoutChange="layoutChange",t.Loaded="loadComments",t.Toggle="toggleComment",t.Start="startComment",t.Update="updateComment"}(o||(o={}))},function(t,e,n){"use strict";var o=n(217),r=n.n(o),i=n(447),s=n.n(i),a=n(1015),c=n.n(a),u={commentList:[],setComment:function(t,e){var n=this,o=t&&t.sheets||[];this.commentList=e,r()(o,function(t){n.render(t)})},getComments:function(){return this.commentList},add:function(t){s()(this.commentList,function(e){return e.selection_guid===t.selection_guid}).length||this.commentList.push(t)},update:function(t){this.commentList=t},render:function(t,e){var n=this,o=t&&t.comments._commentList;if(o.length)if(e){this.add(e);var i=s()(o,function(t){return-1!==t.guid().indexOf(e.selection_guid)});(i=i&&i[0])&&i.renderBorder&&!i.renderBorder()&&(i.renderBorder(!0),t.repaint())}else{var a=!1;r()(o,function(t){t.renderBorder&&!t.renderBorder()&&n.shouldRenderBorder(t.guid())&&(a=!0,t.renderBorder(!0))}),a&&t.repaint()}},shouldRenderBorder:function(t){return!(!t||!this.commentList.length)&&c()(this.commentList,function(e){return-1!==t.indexOf(e.selection_guid)})}};e.a=u},function(t,e,n){"use strict";e.a=function(t,e,n,o){var r=e.row,s=e.col,a=e.guid,c=t.guid(),u={};if(a)u.comment=a,u[a]=a;else{var h=t.comments.get(r,s);h&&h.guid().forEach(function(t){u[t]=""}),u.comment=""}var m=[c,[[r,s,{attrs:u}]]];return l(t,[r,s,null,i({},u)],n,o),{fnName:"cellAttrs2Changeset",params:m}},e.c=l,e.b=function(){var t=window.location,e=window.history,n=window.cow.currentFile.guid,o=t.href;t.href.indexOf("?")>-1?(o=(o=o.replace(t.hash,"")).replace(new RegExp("https?"+t.host),""),e.replaceState({guid:n},"",o)):e.replaceState({guid:n},"",t.pathname)};var o=n(723),r=n(1),i=(n.n(r),this&&this.__assign||function(){return(i=Object.assign||function(t){for(var e,n=1,o=arguments.length;n<o;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)}),s=10,a=r.sheets,c=a.Events,u=a.constants.ERR_CODE;function l(t,e,n,r){var i=e[0],a=e[1],l=e[3],h={};Object.keys(l).forEach(function(t){/comment-?/.test(t)&&(h[t]=l[t])});var m=Object.keys(h).length;if(m){m>s&&n.emit(c.Track,u.TRACK_CELL_TO_MANY_COMMENT,{sheetId:t.guid(),ua:navigator.userAgent,commentGuidCount:m,row:i,col:a,type:r});var d=t.comments,f=d.get(i,a);if(Object.keys(h).every(function(t){return!l[t]}))f&&f.isEditing&&!f.isEditing()&&d.remove(i,a);else if(f){var p=Object.keys(h).reduce(function(t,e){var n=t.indexOf(l[e]);return h[e]?-1===n&&t.push(l[e]):-1!==n&&t.splice(n,1),t},f.guid());f.guid(p)}else{p=Object.keys(h).reduce(function(t,e){var n=l[e];return-1===t.indexOf(n)&&n&&t.push(n),t},[]);d.add(i,a,"",p,o.a.shouldRenderBorder(p))}}}},function(t,e,n){"use strict";function o(t){var e=t.sheet,n=[];if(e.gcSheet&&(e=e.gcSheet),(e=e).comments)for(var o=function(t){return t.comments.sort(function(t,e){return t._rowIndex!==e._rowIndex?t._rowIndex-e._rowIndex:t._colIndex-e._colIndex})}({comments:e.comments.all()}),r=0;r<o.length;++r){var i=o[r];n.push({_rowIndex:i._rowIndex,_colIndex:i._colIndex,selectionGuid:i.guid()})}return n}function r(t){var e=t.commentList,n=t.guid;return e.filter(function(t){return-1!==n.indexOf(t.selection_guid)}).sort(i)}function i(t,e){return t.created_at<e.created_at?-1:t.created_at>e.created_at?1:0}Object.defineProperty(e,"__esModule",{value:!0}),e.editorComments=function(t){for(var e={},n=t.editor.spread.gcSpread,r=0;r<n.sheets.length;++r){var i=n.sheets[r];if(i.comments){var s=i.guid();e[s]=o({sheet:i})}}return e},e.sheetComments=o,e.cellBySelectionGuid=function(t){var e=t.sheet,n=t.selectionGuid;e.gcSheet&&(e=e.gcSheet);if(!(e=e).comments)return;for(var o=e.comments.all(),r=0;r<o.length;++r){var i=o[r];if(-1!==i.guid().indexOf(n))return{row:i._rowIndex,col:i._colIndex}}},e.commentsByRowAndCol=function(t){var e=t.commentList,n=t.sheet,o=t.row,i=t.col;n.gcSheet&&(n=n.gcSheet);var s=(n=n).comments.get(o,i);if(!s)return;return r({commentList:e,guid:s.guid()})},e.showComment=function(t){var e=t.sheet,n=t.row,o=t.col,r=t.rowOffset;e.gcSheet&&(e=e.gcSheet);(e=e).setActiveCell(n,o),e.showCell(n,o,1,1,r)},e.commentsBySelectionGuid=r},function(t,e){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAPAAAADwCAMAAAAJixmgAAABjFBMVEUAAABSV1dDSE1gYGdBRktBRktBR0tBR0xCRktBRktCRktBRktCRkxCRkxCSEtCRk5CR0tCR0xFTlJBRktBR0tCR0tCR0xBSExDR0xDR0xCS09JSVBCRktCR0tCR0tNT1lCR0xCR0tCRkxBR0tCR0xBR0tCRktCSE1ER05CSU1GRk1FTEz////////////////Y2tv////w8PC5u71VWV3///////////9cYWX////9/f3///9BRkv///9XW2Do6enCxMXKy8yrra9CR0z4+PjZ2tu6vL6Ul5pFSk/9/f37+/v5+fpITVLz8/OztbdKT1NlaW1bYGS/wcN9gIPh4uPq6+uipadPVFhUWV1MUVZ3e37c3d6eoaPw8PDU1ddrb3NRVlvFx8iNkJN0eHxhZWqlp6mbnaCQk5aEh4pxdXlucnZobHDQ0dL09fXs7e29v8BYXGDl5ufNz9C2uLrX2NmvsbOXmp2KjZBfY2fe3+DIysuAhIeytLbj5OXS09Soqq2Hio56fYG4urvx8fJMAsAiAAAAPHRSTlMACjgF9vvj1qjw7N20glQ6cGUTy7Cfknt1Tx0R4dnEGNG+ubeXiWlZS0IoJUdS5p/GD/Ty2M/Myci9eC60+N3iAAARhklEQVR42uTb2VcaSRQG8ALBXaMmxtGomSyTZXLmZZ6/q2i7gICAgAJuuO9r1LglZvnHZ0C6C+gGurtqJEx+j0k8J9+pqlt1q1r2YJ4733a0vW588XtLfXOTy+12NTXXt/z+ovF1W8db53P2P+Jwdj591eBCWa6GV087nQ5W4xzve560oBxFQb6WJz3vazV1V/vTx25UEo5vRFDI/fhpexerLXXOtscw5RMR7W97Uexxm7OO1QhHe2MzzBqljMWNBHSaG9trYHbX9TY2wYJ9ujc1sQ69psben3ucH3U3wZogqXwTCRhl7n7Efk5/Pe9oQCnJhWUYOaY8wRQMNXT8jDXM+Xd8y4tSTolmEtCLUr5rlOBqdLKfS+8gYkSHkwEY+podwE/QmSXu6iKN0gZ72U/D0TkAYD5bbrcU6CUXKWskoR951ecoKhjo/DmKdt2bemQs5cZpDTrn2iq9QQHlgHL866is/k31a3ZdZ3/xYHkiKLTnI82tF3nCpJqEKf2dVY7cPgDVNal8Y4WmKM9+CNwW5QwrMGmgnVXPh5fgZsicFXBHlHMBA7Px2RD0Xn5g1eFocyHPBJlzBm6Y7o0lobdNRCfL0HO1VaV6vWtBgWnKORguNkaag9GQwbFjGnqJYHZ5bCjQa3nHHlrfE30bkDOKYh7K+R4NIM8q5YSh0dWEpWMYeNLHHlJdjwt2As8Z//mZYd+oCkZhwNXzgPXa2QBICKwE6d7CkE74gLjbAAw0ONkD+c0NKYF3yayrdRhw/8YewrNWQE7gWTLtYA1GWp+x/9yjesgKfEbm+dMwUq9vluVPZ1mBEz7Kio8YiFOh4DFQhWnd1QpICzxJ96LQ8x5Sntj5twBKae1i8vHpLDHwUi6NAr0t4k7XwT3otO5wQ2LgIR9lrUJPOSHNioIK3B3sP/EHIC0wn9GHXsMbEk08hMr+YPLVdUNiYF6jJ2AgRpobmNFdxyRztEJu4Ii6w4bKXu3tw5xWB5Pq2SAkB76jnC3ojJNmGSYNSj2D9DVAcmDvImVMEcVQLEUaD0xrkNg//dkPOYETUN1Q1uQYUUr//KKauoR5/X8ySZzNkBT4uOh+NqbsE40ApXqKaVjR7JSU1wVZgSPIifgoI4VZ/TodIdVYApa4pCT+sxnSAq8X3lSPAGtEdIp8y6TZgEXNEmZ1Xz840cBh3Ev7syt0HQhNEdEOOO8VqQ5DsKq/T3g/aoBJtyYC7+HeBmWcq1vQErgN0mzDugbB3ckxCLMmKgXmqzV5QP8aDmm3AFGo9qZ40wA7Bh1MQF0rzOKpFseLBSmDz91N+pdvl7+2xEP6Ce2/hC2tIqfMbpg3QpWtISOUPXTc4d5Jdnbrb31mYVO3SH9kwT5V9o0v03lvfrHzLSMjzCf0SQAWifdOHbCAH4D3J4vNU04KAIb82vMoP2dcZfJ750nlW4N9NvvjR25YEStdtGbUFBGtun2FShmmjI+FE3oUAtyPmA1d9bBkmP9fSxTwq6j2WrwAbpOyVvmE5hPepvouZl0rrPlR+ny0kImwEUaGckZE35Fnzk8Z/l0+of3rENNq4z4WFvnVDmcZWeGvCeQEblJp5FwQ0akX+T7mfpA0WxD1m+QFrKfQvasUv7aInUeTKBQZI1oq+sOw/s3cIvFl/KweFilTmUFa2YFqjTJ845mpzH0hWgkYFjVuPgRx9c/kLmC97a21iGLY1p6l8q8jbxUUO/ZTnsMhyNBqbQGLCxN3hxzv9CYMzBLn34MAe8vY6Ya4dTJ/TEz6SfMJkridpluGBkhwSdqXwbsoTzkiLh6FJA1m24geyBChnGGUwfNyngTk6GGm9LlgRwKwF1iZoSIHWwpkcPUxM57AlvjiyMaOF5pjU4H1eXlhF/eEmfAO9nzOjo3n0xzuDVUOzPPqxVYDEPeOVeRogT3zao3yLBsGXj4z+kTc6yHVYowKLM6mIarFwSppg01LpBk1CDz0g2hRV67n+E/NDyWvqZD/+x4EtbEKPrhg0ylpvhgEXskmuEGByxNSzQQA5Y6KDY/uKhDg+sDKewm7RnjFSesDRynLt4o8a0Ftr95E1rafdA5v1wQyv2RltcM2dT76F7zQBQ7FDTq/Va0h5B/N7sXJwI/v0TnY1M7KqBuAbSt0b8SoSp+TRh1jZZRUR0lo0l/IWGx6ewg2DNSx0jpRmu3AwcnJBR9pfFFkhFa0v/+KfMpqkEoZnli9hFWdZQa4H/Z5dIH1+P1N+DPleNIokp6gMr7Aov7SQ/wGlYkHpn1gy69WpCgM7MQkBsYbVoKjHpWJBx67S86oxfk2CUPezTHS859Oz27twKp6h40VLBB4OFBI2TtRhzqMko49VOjwPBVARZZW8QAElAmMQpN+yorfoDQljb1T4hYvArBtgBnqhRmigZPayB2FUVIiRvs7WDujnNEQRPQyI4MwSSTwtzhl+LOjvLTtLXdOvb5Eaim71FchZpAZcEKAycDJ7/e16uPxuNoRDcHARa6m3YWw65mKpyDKyfQaIaByYD68vokI8IW0bnJSZ9Off8EVCkFYI9PpckFApcB8eH0z67zVMMEzBwlcXQKPwZylwKl4Nm6Y/2tz4ruQoIMVa4CA8oG14fVPR3S/Zvlj3IifOP8OxDXoHs8gwETgWaLgRtrgm58JGBmmPLOQ4JHA5yuc+cCJ4YsQ8nw0HfhgU4EE3UV9UhMEmAgMBQWmTQaeukhCiqY68VOWpcCwF3gMsvRK2YRrKHDBVuxogj01FLjJIePuroYCo13KjK6hwI1MU9cMu2oocHOdjEaphgLDKfCexNVQ4Damegz7aijwY60zhIAaCowuKZtSDQVWN6anEGElsHIZXZiJJaoV+KmUJWwy8HFqc2LeTxmrVQnMF7HDDREVAx+uTX5cOiDNWbRagd0OlvEeQqw9tcQ3Lqu3hvFe0ndo+sDe9e1z0hmbWFOAKgbu4d9lieKBl75tHl1NkY5v/2sIQFUDP2EZLZDCQ+XENo/BWbjxgEwt2ZoFcaG9m80TKil4uwzOUmCCVA7hzmF7euZ0fpHKmFq58ULHdGAvZHIKvwqvUXnjk3PQsRI4BJk6xc9Z41Ta4d06jPHAniEjcVIlIQc/a72CkBsqYeyo3Pdk38mkNGR6Jf7GonwmA779TyGUM0MmJSAHf3FxQcwq6XxeOEYF12RSBDK5GHsOQYEgFQhOL6OyfbNr+BJSPWdOiBolbur6xgszzsxW6XVI5WRvISrio5z5izRMujIbOAyp3rIOCBsh4m/dJg2bDOxLQKoOGTeW3+hfK2FYsVg+8AnxXzmWqo29hjBlfOp6D9aMlX/tnr/fyVMKJHst5ZUllIZVPnXZz8HIKAVXPoUgXyN7gWoIUNbBQgCGlIiC/8QL9juqIZRdoFshPLTfWQuq4mhkYR1V0MLq8UupZ834pTSzJvxSmpgLvxQXc+OX4v6nvPv+aiII4gC+uVRJIaBIU+y9P7t+x0JQL2CEADYIgiBIsSH2Xv5xHyk3uRhM2bshPj6/5bfsu7ndm22z8Rq84UJ6w3VaG25Y2nAfHmFsKGHh5CFtv4BJ3k7h9HCIiPrf3BvCetmlQpC0SDnLfLRfVkjthaQxsrzoHYK8vSoKSZ+p2Pi0CWFRFYek92T3KAFZcXUAkp6SXX8asg4oA5LmyOb6JIQZagckzdqauwRxO5RsutRL7C3k+XhBXMYKsWnIC/KWBxnDxHohbw9vapHxmth1yNvK25ZkjBO7CnktvDFNxlViydsQZ/DWQxl9VGQI4jy8uVSEScXmIS3M24dlPKBi9yBtC28Ql/GELEmiYUhr5yMAMhbJMkq0DGmH+JCHjBGyvOSNo2L8Hj7GI+M9Wd5xJRMxm/mglpA5ssxwqXQxW/konpC3ZElPEL2ErBgfthRyjSyD40SjkNXKx2mFcMXhPlwnSg5C0mZVEIUQ3hW8nE2NFyEpqgoMyEj083QlMuK9lmG79EDCFFmGs0PUYwhq8ipLCCKGyPIdC0SUSkBOSLEYRPwky1OkpTPEmP1qGgnTZPkJM5lttxC+mkYypmfJ8gR4QaIJU0gV64SEYbIM5i6VfwExnaUXiAngY3sTyN8Sl4aQTV5l0wYBKT6DCSAjOhvfpuya4b77xcMwME+SI3GzKhGE65bI8r3ws8+EiKAqFYfr5snyHoUHPgMR8dqvatWXKSn+/ltqhYmvapUdin+R5SGQL3byFRJCismlTI8oyxp+V0hsYDJUGT1w2fOSWsq3aNUtuK9HMbmvrXTp4v9MPjN2X2cdl+LrG7GX6iwsvCRfwW3bNcoeaMiQZQFZKVo1B7e1aBS20DBc0kkX7k0fh8sCHo3SJRpGKYeHol4+5u+m/RrFaTTcTvK6EnJ+CCybcnEa6bd4iSzvkPOEskbhqhaNAlM6bv3VZyHRR1mLcE3ZAlMys3ncZ/GCwzcOcdfENIrEaeBVBw5hq9camIJrdmuUAdTyiiw3UTBC5PJQ7DuiUehRhz0ZzuGliOUEXBLVKOWp5y1ZXiGPx+YxuCPs0SjWqudG2S2HK5TzCe44qFGOV8/9JBX8Avvh7q68LRoFlzXNk+UH2BRPY7rA1yVZUtvuJlmuwMLba5Mf4Lx2yaLpdokJW+bAZnmsclzQK1kW327SPiXNFtw70OM3VNU64LB79hlaZqYobwUO61A1iMBZPCi9SMBmhfKSQ3BURNWiOwAnpcnyBXZjPJUJJwW6VU2a/XCKPaLHYGf+poIROMffrJj8a7xMBSkTJe5w/23CMR2Kyb/Gi2tHNG/tcXROPqJq1xqAU1bIsoS/POLH/wDOCLQqJv0a2+42HUcp/urUzyFqfIFdWzKeti85lDIn7Kmyvriq0z7os91P3PcQZcySs0G9T9WtDQ74TJYVlHOl39EDiW2qft4I9N2oeAD+GrGn0BTxKg2eHuiaIaqUEU0SG1iClh6P0tIdhKZvRBVz3k/E7k5BQ7BbaeraBi2fiSrPajxJEnuWQN22dSlth5ug4fZVDtYPWNNNcuToeNNh5QDDh/rdq+5sZbqfSH809hnKEUYT6vVqgBdYTPzDFyrSP4J6NBnKIYe3oU7XyLKAf3nQR7pFpbcdVo7pCqIu87Zvjoqxz54voVbBLuWg7h7U4QpnDR8H8W/mKBWbeILa9HQrR3kiqFniGRWk0qhkMknFUouoRcSjHOZtQ63mqCA5hsp6yWbgJ6rX5lW69HOnJR5qMqjC7WWy6X+Pau1Troj7UYOpq1TjqsJCkuwyqIo/rlzSHEDVTJ65GU6gOl+oxOOHqCzQrFzTGkG1bvK/NlGlwVEqsTyESiKtyk0dflQlwym9iap9eE4lBqYrhHOHKkM+rD8na2kv+5mkUsMPxMPZrjuCisYGKG/FBKslMlhqGmuJdCsJHf6q25tBra7R3559EA9nOyOIf5kptHdgHjUb/Eh/G5gt010HDSXG2+7Dmhb6CrG4gDqkJ6iM1Nxt2PjavUpS15aK7X3zCnWZ7KNyXjw1wbZ0KWkHwyhnPh/Pye8m6jTWT2XdzUwhJ3xQrQNP1Ld2wjDxE/X7QWvofzkJwBf1qPVxZDfsEnco59sV6JijNT3C7iNq/cS2A2zwE2X1vUtATy+tZTSm1pW3ZRv3r+P5YTMNbStkk3r8JfMuM9t7+uQltd68+wPIGknRqufTcEDiJbHHMyZWBfZ7VSPwtGwHzN78n3sARyQeW+PRCLK2t3hUw+i8kEt/v47AKeanfP93H6t6OlUjOXo8G83vTDjHzEb1NROAL2SoRnLqBK06eQaOSrwl+pIAgvFW1VByj/fiZaWa2zbBSYvz2NTWrBpL7vGeP6qyvJ0hB9u8KdTZGP1y6eM9d1QxTyzUBAc0hWIN1C1bjhGdPaZKeI3oZmjZHDUa7tnmneDm2rTGtm72ow7+zVtjDdZLVc1zqH1LGDUIb2k/1IhxXBOP0bJ1T9CHf/IF92xtMf77thbbYRyIR/eGdu0MB5o2+fx+36amQHjnrtDeaPyAsUNJ+QNBtw1r+mzMOwAAAABJRU5ErkJggg=="},function(t,e,n){var o=n(9),r="[object Error]",i=Object.prototype.toString;t.exports=function(t){return!!o(t)&&(i.call(t)==r||"string"==typeof t.message&&"string"==typeof t.name)}},function(t,e){t.exports=/<%=([\s\S]+?)%>/g},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),n.d(e,"CommentEvents",function(){return O});var o=n(2),r=n.n(o),i=n(217),s=n.n(i),a=n(1),c=(n.n(a),n(373)),u=n.n(c),l=n(1014),h=n(1018),m=n(724),d=n(722),f=n(725),p=n(1037),_=n(1038),v=n.n(_),g=n(1039),y=n(1041),C=this&&this.__extends||function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),w=this&&this.__assign||function(){return(w=Object.assign||function(t){for(var e,n=1,o=arguments.length;n<o;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)},b=this&&this.__awaiter||function(t,e,n,o){return new(n||(n=Promise))(function(r,i){function s(t){try{c(o.next(t))}catch(t){i(t)}}function a(t){try{c(o.throw(t))}catch(t){i(t)}}function c(t){t.done?r(t.value):new n(function(e){e(t.value)}).then(s,a)}c((o=o.apply(t,e||[])).next())})},x=this&&this.__generator||function(t,e){var n,o,r,i,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,o=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(r=(r=s.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){s=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){s.label=i[1];break}if(6===i[0]&&s.label<r[1]){s.label=r[1],r=i;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(i);break}r[2]&&s.ops.pop(),s.trys.pop();continue}i=e.call(t,s)}catch(t){i=[6,t],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}},S=a.sheets.Core,O=d.a,R="Comment",E=a.sheets,L=E.sheet,M=E.selection,A=E.changeset,k=E.track,j=E.root,P=E.path,I=E.Plugin,T=P.setByPath,D=M.getCurSelection,N=L.getActivePictures,z=a.sheets.utils.showAlert,H=A.findRawTableOpById,V=A.processCellsDataAttributes,B=a.sheets.Events,F=function(t){function e(n){var o=t.call(this,{name:R,Constructor:e,config:n,localeOption:{localeResources:g.a,s18n:r.a}})||this;o.commentSelected=!1,o.getMenuConfig=function(){return Object(y.a)({startComment:o.startComment.bind(o)})};var i=n.editor;return o.options=n,o.init(),o.startComment=o.startComment.bind(o),o.setCellComment=o.setCellComment.bind(o),i.isRendered&&o.initRenderComment(),o.install(),o}return C(e,t),e.prototype.init=function(){v()(S);var t=this.options.editor.spread,e=t.getSheets().map(function(t){return t.gcSheet});S.Spread.Sheets.Comments.install(t.gcSpread,e),this.initModel(),this.initList(),this.initEvents()},e.prototype.initModel=function(){return this.commentModel=new l.a(u()(this.options,["guid","editor","queryCommentOptions","deleteCommentOptions","closeCommentOptions","createCommentOptions","offlined","usePollingInsteadOfSocket","headers"])),this.options.editor.commentProcessor=this.commentModel,this.commentModel.query(),this.commentModel},e.prototype.initList=function(){if(!this.commentModel)throw new Error("[Comment]: initModel first");return this.commentList=new h.a(w({},u()(this.options,["guid","editor","currentUser","defaultAnonymousUser","currentFileId","container","mentionOptions","headers"]),{checkOffline:this.commentModel.checkOffline,createComment:this.commentModel.create,closeComments:this.commentModel.close,deleteComment:this.commentModel.delete,cancelComment:this.commentModel.cancel})),this.start=this.commentList.startComment.bind(this.commentList),this.toggle=this.commentList.toggleComment.bind(this.commentList),this.updateCellCommentList=this.commentList.updateCurrentCellCommentList.bind(this.commentList),this.updatePosition=this.commentList.updateContainerPos.bind(this.commentList),this.commentModel.on(O.Start,this.start),this.commentModel.on(O.Toggle,this.toggle),this.commentModel.on(O.Update,this.updateCellCommentList),this.commentModel.on(O.LayoutChange,this.updatePosition),this.commentList},e.prototype.destroy=function(){var t=this.options.editor;this.query&&t.off(B.Rendered,this.query),this.commentModel&&(this.start&&this.commentModel.off(O.Start,this.start),this.toggle&&this.commentModel.off(O.Toggle,this.toggle),this.updateCellCommentList&&this.commentModel.off(O.Update,this.updateCellCommentList),this.updatePosition&&this.commentModel.off(O.LayoutChange,this.updatePosition),this.commentModel.destroy())},e.prototype.destory=function(){this.destroy()},e.prototype.startComment=function(){var t=this.options.editor.spread.getActiveSheet().gcSheet;if(N(t).length)return z({title:r()("不能对图片进行评论"),type:"error"});var e=D(t),n=e.row,o=e.col,i=this.commentModel.start({sheet:t,row:n,col:o});"error"===i.type&&z({title:i.message||r()("开始评论失败，请稍后重试"),type:"error"}),k(2,"2055")},e.prototype.test=function(){p.a.test(this.commentModel)},e.prototype.initEvents=function(){this.options.editor.on(B.AfterSheetRendered,this.setCellComment.bind(this)),this.options.editor.on(B.AfterChangeApplied,this.setCellComment.bind(this)),this.options.editor.on(B.AfterCellsChanged,this.setCellComment.bind(this))},e.prototype.initRenderComment=function(){return b(this,void 0,Promise,function(){var t,e,n,o=this;return x(this,function(r){switch(r.label){case 0:return t=this.options.editor,e=t.disableRenderOptimization?t.spread.sheets:[t.spread.getActiveSheet()],[4,t.getContent()];case 1:return n=r.sent(),e.forEach(function(e){var r=H(n,e.id),i=V(t.fileType,r);o.setCellComment({cellsData:i,sheet:e.gcSheet})}),[2]}})})},e.prototype.setCellComment=function(t){var e=this;if(t){var n=t.sheet,o=t.cellsData;n.gcSheet&&(n=n.gcSheet),n&&n.options&&n.options.commentFeature&&o&&(n.suspendPaint(),s()(o,function(t){Object(m.c)(n,t,e.options.editor,"initRender")}),n.resumePaint())}},e.Utils=f,e}(I);e.default=F,T(j,"shimo.sdk.sheet.plugins.Comment",F)},function(t,e,n){"use strict";n.d(e,"a",function(){return k});var o,r=n(2),i=n.n(r),s=n(210),a=(n.n(s),n(148)),c=n.n(a),u=n(1),l=(n.n(u),n(722)),h=n(723),m=n(208),d=(n.n(m),n(724)),f=n(725),p=n(1017),_=this&&this.__extends||function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),v=this&&this.__makeTemplateObject||function(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t},g=this&&this.__assign||function(){return(g=Object.assign||function(t){for(var e,n=1,o=arguments.length;n<o;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)},y=u.sheets.Core,C=y.Spread.Sheets,w=y.Spread.Sheets.Events,b=w.CellClick,x=w.CellDoubleClick,S=w.TopRowChanged,O=w.LeftColumnChanged,R=w.LayoutChanged,E=u.sheets,L=E.Events,M=E.track,A=u.sheets.ajax.ajax,k=function(t){function e(e){var n=t.call(this)||this;return n.options=e,n.isLoading=!1,n.comments=[],n.offlined=!!e.offlined,n.gcSpread=n.options.editor.spread.gcSpread,n.checkOffline=n.checkOffline.bind(n),n.create=n.create.bind(n),n.close=n.close.bind(n),n.delete=n.delete.bind(n),n.cancel=n.cancel.bind(n),n.updateCommentsByPush=n.updateCommentsByPush.bind(n),n.layoutChanged=n.layoutChanged.bind(n),n.toggle=n.toggle.bind(n),n.cellBySelectionGuid=f.cellBySelectionGuid,n.requestService=g({},p,e.requestService),n.bindEvents(),n.bindLoopQuery(),n}return _(e,t),Object.defineProperty(e.prototype,"allComments",{get:function(){return this.comments},set:function(t){this.comments=t,h.a.update(t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"loading",{get:function(){return this.isLoading},enumerable:!0,configurable:!0}),e.prototype.query=function(){var t=this,e=this.options,n=e.guid,o=e.editor,r=e.queryCommentOptions,i=e.headers,s=void 0===i?{}:i;return this.isLoading=!0,this.requestService.queryComments({guid:n,options:r,headers:s}).then(function(e){"[object Array]"===Object.prototype.toString.call(e)&&(t.allComments=e),t.isLoading=!1,o.spread&&t.renderSpread({spread:o.spread.gcSpread});var n=window.location.hash.substring(1)||"";return n.split("-").length>2&&(n=n.substring(0,n.lastIndexOf("-"))),/^comment-[a-zA-Z0-9]{16}$/.test(n)&&t.locateComment(n),e}).catch(function(e){throw t.isLoading=!1,e})},e.prototype.start=function(t){var e=t.sheet,n=t.row,o=t.col;e.gcSheet&&(e=e.gcSheet),e=e;var r=this.checkOffline("start");if("success"!==r.type)return r;M(2,"0047");var i=e.comments.get(n,o);return(!i||i.renderBorder&&!i.renderBorder())&&(i=this.addSheetComment({sheet:e,row:n,col:o,isRender:!0})),this.currentCellComment=i,this.emit(l.a.Start,{cell:{row:n,col:o},commentList:this.allComments,cellComment:i}),r},e.prototype.create=function(t){var e=this,n=t.comment,o=t.row,r=t.col,i=t.user,s=this.checkOffline("create");if("success"!==s.type)return Promise.reject(s);var a=this.options.editor.spread.gcSpread.getActiveSheet(),c=a.comments.get(o,r);if(c&&c.renderBorder||(c=this.addSheetComment({sheet:a,row:o,col:r,isRender:!0})),this.currentCellComment=c,!n.selection_guid||!n.selectionGuid){var u=c.guid()[0];n.selection_guid=u,n.selectionGuid=u}var h=this.allComments.filter(function(t){return t.selection_guid===n.selection_guid});if(this.currentCellComment&&!h.length){var m=this.options.editor.spread.getActiveSheet(),f={row:o,col:r,guid:this.currentCellComment.guid()[0]};this.options.editor.calcOperator({operator:[Object(d.a)(m.gcSheet,f,this.options.editor,"create")],label:"comment",isDisableRecords:!0})}var p=g({},n,{User:i});this.allComments=this.allComments.concat(p);var _=this.options,v=_.guid,y=_.createCommentOptions,C=_.headers,w=void 0===C?{}:C;return this.requestService.createComment({guid:v,comment:n,options:y,headers:w}).then(function(t){return p.created_at=t.created_at,e.emit(l.a.Update,e.allComments),t}).catch(function(t){throw e.allComments=e.allComments.filter(function(t){return t.comment_guid!==n.comment_guid}),e.emit(l.a.Update,e.allComments),t})},e.prototype.delete=function(t){var e=this,n=this.checkOffline("create");if("success"!==n.type)return Promise.reject(n);for(var o=this.options.deleteCommentOptions,r=this.allComments.length,i=null,s=0;s<r;++s)if(this.allComments[s].comment_guid===t){i=this.allComments[s],this.allComments=this.allComments.slice(0,s).concat(this.allComments.slice(s+1));break}return i?this.requestService.deleteComment({commentId:t,options:o,headers:this.options.headers||{}}).then(function(t){return e.emit(l.a.Update,e.allComments),M(2,"0071"),t}).catch(function(t){throw e.allComments=e.allComments.concat(i),e.emit(l.a.Update,e.allComments),t}):Promise.resolve()},e.prototype.close=function(t){var e=this,n=t.sheet,o=t.row,r=t.col,i=t.options,s=this.checkOffline("create");if("success"!==s.type)return Promise.reject(s);var a=n.gcSheet.comments.get(o,r),u=c()({},this.options.closeCommentOptions),h=i||u;return this.allComments=this.allComments.filter(function(t){return-1===a.guid().indexOf(t.selection_guid)}),this.cancel({sheet:n,row:a._rowIndex,col:a._colIndex}),this.requestService.closeComment({guid:this.options.guid,selectionGuid:a.guid()[0],options:h,headers:this.options.headers||{}}).then(function(){e.emit(l.a.Update,e.allComments),M(2,"0070")})},e.prototype.cancel=function(t){var e=t.sheet,n=t.row,o=t.col,r=e.gcSheet,i=r.comments.get(n,o);if(i&&this.allComments&&!this.allComments.filter(function(t){return-1!==i.guid().indexOf(t.selection_guid)}).length){var s={row:n,col:o,guid:""};this.options.editor.calcOperator({operator:[Object(d.a)(r,s,this.options.editor,"cancel")],label:"comment",isDisableRecords:!0}),this.removeSheetComment({sheet:e.gcSheet,row:n,col:o})}},e.prototype.commentsByRowAndCol=function(t){var e=t.sheet,n=t.row,o=t.col;e.gcSheet&&(e=e.gcSheet);var r=(e=e).comments.get(n,o);if(r)return this.commentById(r.guid())},e.prototype.updateCommentsByPush=function(t){var e=t.db_event,n=t.data;switch(e){case"create":var o=this.options.editor.spread.gcSpread;this.allComments.filter(function(t){return t.comment_guid===n.comment_guid}).length||(this.allComments=this.allComments.concat(n),this.renderSheet({sheet:o.getActiveSheet(),comment:n}),this.emit(l.a.Update,this.allComments));break;case"update":this.allComments=this.allComments.filter(function(t){return t.comment_guid!==n.comment_guid}),this.emit(l.a.Update,this.allComments);break;case"closeComments":this.allComments=this.allComments.filter(function(t){return t.selection_guid!==n.selection_guid}),this.emit(l.a.Update,this.allComments)}},e.prototype.commentById=function(t){return this.allComments.filter(function(e){return-1!==t.indexOf(e.selection_guid)})},e.prototype.destory=function(){this.destroy()},e.prototype.destroy=function(){this.options.editor.off(L.Offlined,this.updateOffline),this.interval&&clearInterval(this.interval)},e.prototype.checkOffline=function(t){var e={start:i()("开始"),create:i()("新增"),delete:i()("删除"),close:i()("关闭")};return this.offlined?{message:i()(o||(o=v(["离线状态无法","评论"],["离线状态无法","评论"])),e[t]||""),type:"error"}:{type:"success"}},e.prototype.genCommentId=function(){return Object(s.genGuid)()},e.prototype.bindEvents=function(){var t=this.options.editor;t.on(L.Offlined,this.updateOffline.bind(this)),t.on(L.AfterHoveredCellChanged,this.toggle),this.gcSpread.bind(S,this.layoutChanged),this.gcSpread.bind(O,this.layoutChanged),this.gcSpread.bind(R,this.layoutChanged),this.gcSpread.bind(b,this.toggle),this.gcSpread.bind(x,this.toggle)},e.prototype.updateOffline=function(t){this.offlined&&!t&&this.query(),this.offlined=t},e.prototype.locateComment=function(t){var e=this.options.editor.spread.gcSpread,n=e&&e.getActiveSheet()||{},o=n.comments&&n.comments.all()||[];if(o.length){for(var r=o.length,i=0;i<r;++i){var s=o[i];if(-1!==s.guid().indexOf(t)){var a=s._rowIndex,c=s._colIndex;n.setActiveCell(a,c),n.showCell(a,c,C.VerticalPosition.center,C.HorizontalPosition.center),this.emit(l.a.Toggle,{commentList:this.allComments,comment:s,type:"click"});break}}Object(d.b)()}},e.prototype.addSheetComment=function(t){var e=t.sheet,n=t.row,o=t.col,r=t.guid,i=t.isRender;e.gcSheet&&(e=e.gcSheet),e=e;var s=r||"comment-"+this.genCommentId(),a=e.comments.add(n,o,"",[s],i);return this.options.editor.emit(u.sheets.Events.ActiveCellAttrsChanged),a},e.prototype.shouldRenderBorder=function(t){var e=this.allComments;return!(!t||!e.length)&&e.some(function(e){return-1!==t.indexOf(e.selection_guid)})},e.prototype.removeSheetComment=function(t){var e=t.sheet,n=t.row,o=t.col;e.gcSheet&&(e=e.gcSheet),(e=e).comments.remove(n,o)},e.prototype.renderSpread=function(t){var e=this;t.spread.sheets.forEach(function(t){return e.renderSheet({sheet:t})})},e.prototype.renderSheet=function(t){var e=this,n=t.sheet,o=t.comment;n.gcSheet&&(n=n.gcSheet);var r=(n=n).comments.all();if(r.length)if(o){var i=r.filter(function(t){return-1!==t.guid().indexOf(o.selection_guid)}),s=i&&i[0];s&&s.renderBorder&&!s.renderBorder()&&(s.renderBorder(!0),n.repaint())}else{var a=[];r.forEach(function(t){t.renderBorder&&!t.renderBorder()&&e.shouldRenderBorder(t.guid())&&a.push(t)}),a.length&&(n.suspendPaint(),a.forEach(function(t){return t.renderBorder(!0)}),n.resumePaint())}},e.prototype.bindLoopQuery=function(){var t=this,e=this.options,n=e.usePollingInsteadOfSocket,o=e.queryCommentOptions,r=e.editor,i=e.headers;n&&n.interval&&(this.interval=setInterval(function(){A(null,g({},o,{headers:i})).then(function(e){e.length===t.allComments.length&&JSON.stringify(e)===JSON.stringify(t.allComments)||(t.allComments=e,t.renderSpread({spread:r.spread.gcSpread}),t.emit(l.a.Update,t.allComments))})},n.interval))},e.prototype.layoutChanged=function(){this.emit(l.a.LayoutChange,this.allComments)},e.prototype.toggle=function(t,e){var n=this.options.editor.spread.gcSpread.getActiveSheet(),o=t.cell,r=t.type,i="";if(i="CellClick"===r?"click":"CellDoubleClick"===r?"hide":"hover",!o){if(!e)return;o=e}if(null==o.row||null==o.col||this.options.editor.permissions.query.canReadRange({sheetId:n.guid(),range:{row:o.row,col:o.col,rowCount:1,colCount:1}})){var s=n&&n.comments.get(o.row,o.col);this.emit(l.a.Toggle,{comment:s,commentList:this.allComments,type:i})}},e}(m.EventEmitter)},function(t,e,n){var o=n(97),r=n(49),i=n(1016),s=n(3),a=n(149);t.exports=function(t,e,n){var c=s(t)?o:i;return n&&a(t,e,n)&&(e=void 0),c(t,r(e,3))}},function(t,e,n){var o=n(98);t.exports=function(t,e){var n;return o(t,function(t,o,r){return!(n=e(t,o,r))}),!!n}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.queryComments=function(t){var e=t.guid,n=t.options,o=t.headers;return s(r({url:"/lizard-api/files/"+e+"/comments"},n,{headers:o}))},e.deleteComment=function(t){var e=t.commentId,n=t.options,o=t.headers,i=n&&n.url||"/lizard-api/comments",a=-1!==i.indexOf("{comment-id}")?i.replace("{comment-id}",e):i+"/"+e;return s(r({method:"DELETE"},n,{url:a,headers:o}))},e.closeComment=function(t){var e=t.guid,n=t.selectionGuid,o=t.options,i=t.headers,a=o&&o.url||"/lizard-api/files/"+e+"/comments/close";return s(r({method:"DELETE"},o,{url:a+="/"+n,headers:i}))},e.createComment=function(t){var e=t.guid,n=t.comment,o=t.options,i=t.headers;return s(r({url:"/lizard-api/comments?target_type=file&guid="+e,method:"POST",params:n},o,{headers:i}))};var o=n(1),r=(n.n(o),this&&this.__assign||function(){return(r=Object.assign||function(t){for(var e,n=1,o=arguments.length;n<o;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)}),i=o.sheets.ajax.ajax;function s(t){return i(null,t)}},function(t,e,n){"use strict";n.d(e,"a",function(){return h});var o=n(7),r=n.n(o),i=n(1),s=(n.n(i),n(0)),a=n.n(s),c=n(1019),u=this&&this.__assign||function(){return(u=Object.assign||function(t){for(var e,n=1,o=arguments.length;n<o;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)},l=i.sheets.CellAppendant,h=function(){function t(t){this.options=t,this.getCommentRef=this.getCommentRef.bind(this),t.container&&this.render(t.container)}return t.prototype.startComment=function(t){this.commentRef&&this.commentRef.startComment(t)},t.prototype.toggleComment=function(t){this.commentRef&&this.commentRef.toggleComment(t)},t.prototype.updateCurrentCellCommentList=function(t){this.commentRef&&this.commentRef.updateCurrentCellCommentList(t)},t.prototype.show=function(t){this.commentRef&&this.commentRef.show(t)},t.prototype.hide=function(){this.commentRef&&this.commentRef.hide()},t.prototype.updateContainerPos=function(){this.commentRef&&this.commentRef.updateLayoutChange()},t.prototype.getCommentRef=function(t){t&&(this.commentRef=t.refs.widget)},t.prototype.render=function(t){var e=this.options.editor;e.permissions.query.canCommentFile()&&r.a.render(a.a.createElement(l,{ref:this.getCommentRef,editor:e,position:["right","top"],widget:c.a,props:u({},this.options,{container:t})}),t)},t}()},function(t,e,n){"use strict";(function(t){var o=n(2),r=n.n(o),i=n(0),s=n.n(i),a=n(210),c=(n.n(a),n(1)),u=(n.n(c),n(1020)),l=n(1021),h=n(726),m=n.n(h),d=this&&this.__extends||function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),f=this&&this.__assign||function(){return(f=Object.assign||function(t){for(var e,n=1,o=arguments.length;n<o;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)},p=c.sheets.Core,_=c.sheets,v=_.perf,g=_.Events,y=_.track,C=c.sheets.utils,w=C.showAlert,b=C.confirm,x=v.suspendFloatingObjects,S=p.Spread.Sheets,O=function(e){function n(t){var n=e.call(this,t)||this;n.hideForSheetScrolled=function(){!n.state.isActive&&n.hide()},n.hide=function(){if(n.state.isShow){var t=n.props.editor.spread.getActiveSheet();if(n.state.cellComment){var e=n.state.cellComment,o=e._rowIndex,r=e._colIndex;n.props.cancelComment&&n.props.cancelComment({sheet:t,row:o,col:r})}n.setState({isShow:!1,isActive:!1,cellComment:null})}},n.state={commentList:[],isShow:!1,isActive:!1,inputVal:"",cellComment:null},n.mouseOnComment=!1,n.addComment=n.addComment.bind(n),n.cancelComment=n.cancelComment.bind(n),n.deleteComment=n.deleteComment.bind(n),n.closeComments=n.closeComments.bind(n),n.onClick=n.onClick.bind(n),n.onMouseOver=n.onMouseOver.bind(n),n.onMouseOut=n.onMouseOut.bind(n),n.onInput=n.onInput.bind(n),n.toggleComment=n.toggleComment.bind(n),n.startComment=n.startComment.bind(n),n.onKeyDown=n.onKeyDown.bind(n),n.onInput=n.onInput.bind(n);var o=n.props.editor;return o.on(g.TopRowChanged,n.hideForSheetScrolled),o.on(g.LeftColumnChanged,n.hideForSheetScrolled),n}return d(n,e),n.prototype.componentDidMount=function(){this.lastShowFooter=!1,t(this.refs.body).on("mousewheel DOMMouseScroll",function(t){var e=t.currentTarget;if(e.scrollHeight!==e.offsetHeight){var n=t.originalEvent||t,o=(n.wheelDelta||-n.detail)>0?"up":"down";("up"===o&&0===e.scrollTop||"down"===o&&e.scrollTop===e.scrollHeight-e.offsetHeight)&&t.preventDefault()}})},n.prototype.componentDidUpdate=function(){this.props.hitTest&&this.props.hitTest({useOffset:!0})},n.prototype.componentWillUnmount=function(){var t=this.props.editor;t.off(g.TopRowChanged,this.hideForSheetScrolled),t.off(g.LeftColumnChanged,this.hideForSheetScrolled)},n.prototype.initMention=function(){var t=this,e=this.props,n=e.mentionOptions,o=e.currentFileId,r=e.headers,i=void 0===r?{}:r;n&&o&&setTimeout(function(){t.mentionPop=new l.a({container:t.refs.mentionContainer,currentUserId:t.props.currentUser.id,currentFileId:o,mentionOptions:n,headers:i}),t.mentionPop.mentionable(t.refs.input)})},n.prototype.toggleComment=function(t){var e=t.comment,n=t.commentList,o=t.type;if(!(!this.props.editor.permissions.query.canCommentFile()||this.state.inputVal&&this.state.inputVal.replace("<br>","")||(this.state.isActive||this.mouseOnComment)&&"hover"===o)){var r=this.state.cellComment,i=e&&r&&e===r,s=e&&e.renderBorder&&!e.renderBorder();if("hide"===o||!e||s||this.state.isActive&&i)return this.hide();this.show({commentList:n,cellComment:e,isActive:"click"===o})}},n.prototype.show=function(t){var e=t.commentList,n=t.cellComment,o=t.isActive;this.state.cellComment&&this.state.cellComment!==n&&this.hide(),this.mouseOnComment=!1,this.setState({commentList:R(e,n.guid()),cellComment:n,isShow:!0,isActive:o}),this.props.updatePosition&&this.props.updatePosition({row:n._rowIndex,col:n._colIndex})},n.prototype.startComment=function(t){var e=t.cell,n=t.cellComment,o=t.commentList;this.state.cellComment&&this.state.cellComment!==n&&this.hide();var r=this.props.checkOffline&&this.props.checkOffline("start");if(r&&"success"!==r.type)return w({title:r.message,type:"error"});var i=this.props.editor.spread.gcSpread.getActiveSheet(),s=e.row,a=e.col;i.showCell(s,a,S.VerticalPosition.center,S.HorizontalPosition.center),this.show({commentList:o,cellComment:n,isActive:!0}),this._focusInput()},n.prototype.addComment=function(t){var e=this,n=this.props.checkOffline&&this.props.checkOffline("create");if(n&&"success"!==n.type)return w({title:n.message,type:"error"});t.stopPropagation();var o="",i=this.refs.input;o=i.getElementsByTagName("a").length?i.innerHTML.replace(/(\s|&nbsp;)+$/g,"").replace(/<\/?((?!a)(\!\-\-)*([a-z]+)).*?>/gi,""):i.innerText.replace(/(\s|&nbsp;)+$/g,"").replace(/(\s|<br>)+$/g,"");var s=this.props.editor.spread.gcSpread.getActiveSheet(),c=Object(a.genGuid)(),u=(new Date).toISOString(),l=this.state.cellComment.guid()[0],h={selection_guid:l,selectionGuid:l,comment_guid:c,commentGuid:c,content:o,created_at:u,createdAt:u,selection_title:s.guid()||"",selectionTitle:s.guid()||"",user_id:this.props.currentUser.id,userId:this.props.currentUser.id};this.setState({commentList:this.state.commentList.concat(f({},h,{User:this.props.currentUser}))}),this._clearInput(),this._focusInput(),setTimeout(function(){e.refs.body.scrollTop=e.refs.body.scrollHeight}),function(t){var e=t.match(/mention/gi),n=t.match(/mention-user/gi);e&&e.map(function(){y(2,"2058")}),n&&n.map(function(){y(2,"2059")}),y(2,"2057")}(o),this.props.createComment&&this.props.createComment({comment:h,user:this.props.currentUser,row:this.state.cellComment._rowIndex,col:this.state.cellComment._colIndex}).catch(function(t){w({title:t.message||r()("新增评论失败，请稍后重试"),type:"error"})})},n.prototype.closeComments=function(){var t=this,e=this.props.checkOffline&&this.props.checkOffline("close");if(e&&"success"!==e.type)return w({title:e.message,type:"error"});b({title:r()("结束讨论"),description:r()("结束讨论后该讨论将被彻底删除，确定结束吗？"),confirmFun:function(){var e=t.props.editor.spread,n=e&&e.getActiveSheet()||{};t._clearInput(),t.setState({commentList:[],inputVal:""}),t.props.closeComments&&t.props.closeComments({sheet:n,row:t.state.cellComment._rowIndex,col:t.state.cellComment._colIndex}),t.hide()}})},n.prototype.deleteComment=function(t){var e=this.props.checkOffline&&this.props.checkOffline("delete");if(e&&"success"!==e.type)return w({title:e.message,type:"error"});this.setState({commentList:this.state.commentList.filter(function(e){return e.comment_guid!==t})}),this.props.deleteComment&&this.props.deleteComment(t).catch(function(t){w({title:t.message||r()("删除评论失败，请稍后重试"),type:"error"})})},n.prototype.cancelComment=function(t){this._clearInput(),t.stopPropagation(),!this.state.commentList.length&&this.hide()},n.prototype.updateCurrentCellCommentList=function(t){var e=this.state.cellComment;e&&this.setState({commentList:R(t,e.guid())})},n.prototype.updateLayoutChange=function(){var t=this.state.cellComment;if(t){var e=this.props.editor.spread.getActiveSheet(),n=t._rowIndex,o=t._colIndex,r=e&&e.gcSheet.comments.get(n,o),i=!!r&&r===t;(i||this.state.isShow)&&(this.setState({isShow:i}),i&&this.props.updatePosition&&this.props.updatePosition({row:n,col:o}))}},n.prototype.onInput=function(t){this.setState({inputVal:t});var e=this.state.cellComment;e&&e.isEditing(!!t),this.props.hitTest&&this.props.hitTest({useOffset:!0})},n.prototype.onClick=function(){this.state.isActive||(this.setState({isActive:!0}),this._focusInput())},n.prototype.onMouseOver=function(){this.mouseOnComment=!0},n.prototype.onMouseOut=function(){this.mouseOnComment=!1},n.prototype.hasContent=function(t){return!(!t||!t.replace(/<\/?[^>]*>/gim,"").replace(/&nbsp;|\s/g,"").length)},n.prototype.onKeyDown=function(t){t.shiftKey||13!==t.keyCode||this.mentionPop&&this.mentionPop.inMention||!this.hasContent(t.target.innerHTML)||(this.addComment(t),t.preventDefault())},n.prototype.addPasteListener=function(e){var n=t(e);n.on("paste",function(){var e=function(e){return t.trim(e.replace(/<\/?((?!a)(\w+))\s*[\w\W]*?>/g,""))};return setTimeout(function(){var t=n.html();return t=function(t){return t.replace(/(<[\w\W]*?)(style)([\w\W]*?>)/g,function(t,e,n,o){return e+"style_replace"+o})}(t),t=e(e(t)),n.html(t)},0)})},n.prototype._clearInput=function(){this.refs.input.innerHTML="",this.onInput("")},n.prototype._focusInput=function(){var t=this,e=this.props.editor.spread.gcSpread,n=e.getActiveSheet();x(function(){e.focus(!1)},n)(),setTimeout(function(){t.refs.input&&t.refs.input.focus(),t.props.hitTest&&t.props.hitTest({useOffset:!0})})},n.prototype.render=function(){var t=this,e=this.state,n=e.isActive,o=e.isShow,i=e.commentList,a=e.inputVal,c=!i.length,h=!(a&&a.replace("<br>","")),d=this.hasContent(a),f=n||c,p=n&&!c,_=n?"active":"";return f&&!this.lastShowFooter&&l.a&&this.initMention(),this.addPasteListener(this.refs.input),this.lastShowFooter=f,s.a.createElement("div",{className:"doc-comment-container",style:{display:o?"block":"none"},ref:"container",onClick:this.onClick,onMouseEnter:this.onMouseOver,onMouseLeave:this.onMouseOut},s.a.createElement("div",{ref:"box",className:"doc-comment-box "+_},p&&s.a.createElement("div",{className:"doc-comment-header",ref:"header"},s.a.createElement("a",{onClick:this.closeComments,className:"doc-comment-close"},s.a.createElement("span",{className:"doc-comment-close-icon"}),r()("结束讨论"))),s.a.createElement("div",{className:"doc-comment-body",ref:"body"},i.map(function(e){return s.a.createElement(u.a,{user:t.props.currentUser,defaultAnonymousUser:t.props.defaultAnonymousUser,deleteComment:t.deleteComment,comment:e,key:e.comment_guid})})),f&&!c&&s.a.createElement("div",{className:"doc-footer-divide"}),f&&s.a.createElement("div",{className:"doc-comment-footer",ref:"footer"},s.a.createElement("img",{className:"doc-comment-avatar",src:this.props.currentUser.avatar||m.a}),h&&s.a.createElement("div",{className:"doc-comment-input-placeholder"},r()("按enter发送，shift+enter换行")),s.a.createElement("div",{contentEditable:!0,onKeyDown:this.onKeyDown,onInput:function(e){return t.onInput(e.target.innerHTML)},ref:"input",className:"doc-comment-input"}),s.a.createElement("div",{className:"mention-pop",ref:"mentionContainer"}),d&&s.a.createElement("div",{className:"doc-comment-btn-box"},s.a.createElement("a",{onClick:this.cancelComment,className:"doc-comment-btn doc-comment-cancel btn"},r()("取消")),s.a.createElement("a",{onClick:this.addComment,className:"doc-comment-btn doc-comment-send btn btn-ok"},r()("确定"))))))},n}(i.Component);function R(t,e){return t.filter(function(t){return-1!==e.indexOf(t.selection_guid)}).sort(function(t,e){return t.created_at<e.created_at?-1:t.created_at>e.created_at?1:0})}e.a=O}).call(e,n(84))},function(t,e,n){"use strict";var o=n(2),r=n.n(o),i=n(0),s=n.n(i),a=n(430),c=(n.n(a),n(1)),u=(n.n(c),n(726)),l=n.n(u),h=this&&this.__extends||function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),m=c.sheets.utils.confirm,d=function(t){function e(e){var n=t.call(this,e)||this;return n.deleteComment=n._deleteComment.bind(n),n}return h(e,t),e.prototype._deleteComment=function(){var t=this;m({title:r()("删除评论"),description:r()("确认要永久删除该评论吗？"),confirmFun:function(){t.props.deleteComment(t.props.comment.comment_guid)}})},e.prototype.render=function(){var t=this.props.comment,e=this.props.user,n=t.content,o=t.created_at,i=t.User||this.props.defaultAnonymousUser,c=i.avatar,u=i.name,h=i.id,m="";return e.id===h&&(m="current-user"),s.a.createElement("div",{className:"doc-comment-item "+m},s.a.createElement("img",{className:"doc-comment-avatar",src:c||l.a}),s.a.createElement("span",{className:"doc-comment-online"}),s.a.createElement("div",{className:"doc-comment-text"},s.a.createElement("span",{className:"doc-comment-time"},Object(a.format)(o)),s.a.createElement("span",{className:"doc-comment-delete",onClick:this.deleteComment},r()("删除")),s.a.createElement("span",{className:"doc-comment-name"},u),s.a.createElement("br",null),s.a.createElement("span",{className:"doc-comment-content ",dangerouslySetInnerHTML:{__html:n.replace(/\n/g,"<br>")}})))},e}(i.Component);e.a=d},function(t,e,n){"use strict";(function(t){var o=n(2),r=n.n(o),i=n(1022),s=n.n(i),a=n(301),c=n.n(a),u=n(1032),l=n.n(u),h=n(1033),m=n(1034),d=n(1035),f=n(1036),p=(n.n(f),function(){function e(e){var n=this,o=e.container,i=e.currentUserId,a=e.currentFileId;this.options=e,this.currentTarget=null,this.currentCursorPosition=0,this.$view=t(o),this.ele=o,this.$view.html(s()(h.a)({})),this.inMention=!1,this.maxSearch=6,this.halfMaxSearch=.5*this.maxSearch,this.$resultListView=this.$view.children(".result-list"),this.$placeholder=this.$view.find(".placeholder"),this.docResultList=[],this.userResultList=[],this.placeholderText=r()("在此@同伴或者文档"),this.$placeholder.text(this.placeholderText),this.$arrowUp=this.$view.find(".arrow-up"),this.$arrowDown=this.$view.find(".arrow-down"),this.currentUserId=i,this.fileId=a,t("body").append('<div id="mention-pop-shadow" contenteditable="true"></div>'),this.$shadow=t("#mention-pop-shadow"),t(document).on("mousedown",function(t){t.target&&0===n.$view.has(t.target).length&&n.cancel()}),this.initEvents()}return e.prototype.initEvents=function(){var e,n=this,o=this,r={mouseEnterResult:function(e){var o=t(e.target);o.hasClass("active")||(n.$resultListView.find("li").removeClass("active"),o.addClass("active"))},clickResult:function(t){return o.create(),t.stopPropagation()},stopPropagation:function(t){return t.stopPropagation()}},i={"mouseenter .mention-result":"mouseEnterResult","click .mention-result":"clickResult","click .placeholder":"stopPropagation","click .down":"stopPropagation"},s=function(t){var i,s=e.split(" "),a=s.shift();s.length&&(i=s.join(" ")),i&&"body"!==i&&"#innerdocbody"!==i&&o.$view.off(a,i),o.$view.on(a,i,function(e){if(r[t])return r[t].call(o,e,n);console.warn("cannot find dom event ",t)})};for(e in i){s(i[e])}},e.prototype.mentionable=function(e){var n=this,o=this,r=t(e);r.off("click"),r.off("keyup");r.on("click keyup",c()(function(t){if(-1===[f.keyCodes.UP,f.keyCodes.DOWN,f.keyCodes.ENTER].indexOf(t.keyCode)){o.currentTarget=r;var e=window.getSelection().getRangeAt(0),i=e.endOffset,s=e.endContainer;o.currentCursorPosition=e.endOffset,o.currentNodeIndex=o.getCurrentNodeIndex(s);var a=s.parentNode;if(s.parentNode&&"DIV"===s.parentNode.nodeName&&a&&"true"===a.getAttribute("contenteditable")&&"#text"===s.nodeName){var c=void 0,u=s.nodeValue&&s.nodeValue.slice(0,i).split(/\s+/),l=u&&u[u.length-1];l&&l.indexOf("@")>-1?(c=l.slice(l.lastIndexOf("@")+1),n.search(c)):o.cancel()}}},500)),r.on("keydown",function(t){o.inMention&&(-1!==[f.keyCodes.UP,f.keyCodes.DOWN].indexOf(t.keyCode)&&(o.select(t.keyCode===f.keyCodes.UP?"up":"down"),t.preventDefault()),t.keyCode===f.keyCodes.ENTER&&(o.create(),t.preventDefault()))})},e.prototype.cancel=function(){this.inMention&&(this.hide(),this.inMention=!1)},e.prototype.show=function(){this.position(),this.$view.addClass("active"),this.inMention=!0},e.prototype.hide=function(){this.$view.removeClass("active"),this.$resultListView.empty(),this.$placeholder.html(this.placeholderText).show(),this.inMention=!1},e.prototype.select=function(t){var e=this.$resultListView.find("li");if("init"===t)e.removeClass("active").first().addClass("active");else{var n=this.$resultListView.find("li.active");if(n.length>0){var o=n.attr("data-index");"down"===t&&o<e.length-1&&n.removeClass("active").next("li").addClass("active"),"up"===t&&o>0&&n.removeClass("active").prev("li").addClass("active")}}},e.prototype.create=function(){var e=this,n=this.$resultListView.find("li.active");if(0!==n.length){var o={type:n.attr("data-type"),name:n.attr("data-name"),guid:"",id:""};"doc"===o.type&&(o.guid=n.attr("data-guid")),"user"===o.type&&(o.id=n.attr("data-id")),this.currentTarget&&this.currentTarget[0].focus();var r=this.currentTarget[0].childNodes[this.currentNodeIndex];this.moveCursor(r,this.currentCursorPosition);var i=r.parentNode,s=r.nextSibling,a=r.nodeValue,c=a.lastIndexOf("@"),u=this.currentCursorPosition,l=a&&a.slice(0,c),h=a&&a.slice(u),m=document.createTextNode(l+" "),d=document.createTextNode(" "+h),f=document.createElement("a"),p=t(f);if("doc"===o.type&&(p.attr("data-file-id",o.id),p.attr("href","/"+o.guid)),"user"===o.type)p.attr("href","javascript:void(0);"),this.isOnline(o.id)&&p.addClass("online"),p.attr("data-user-id",o.id),p.attr("contenteditable","false");p.addClass("mention-"+o.type),f.innerText=f.textContent=o.name,i.insertBefore(m,s),i.insertBefore(f,s),i.insertBefore(d,s),i.removeChild(r);var _=d;this.moveCursor(_,1),null===s&&i.insertBefore(document.createElement("br"),s),setTimeout(function(){e.cancel()},100)}},e.prototype.position=function(){var e,n=this;if(this.currentTarget){this.$shadow.html(this.currentTarget.html()),["fontSize","width","height","lineHeight","padding","border","outline"].forEach(function(t){return n.$shadow.css(t,n.currentTarget.css(t))});var o=this.$shadow[0].childNodes[this.currentNodeIndex];if(o){var r=o.nextSibling,i=o.nodeValue,s=o.parentNode,a=this.currentCursorPosition,c=i&&i.slice(0,a).lastIndexOf("@"),u=i&&c&&i.slice(0,c),l=i&&c&&i.slice(c),h=u&&document.createTextNode(u),m=l&&document.createTextNode(l),d=document.createElement("span");d.innerText="1",h&&s.insertBefore(h,r),s.insertBefore(d,r),m&&s.insertBefore(m,r),s.removeChild(o);var f=t(d).offset(),p=t(".doc-comment-input").offset();f&&p&&(f.top+=p.top+5e3,f.left+=p.left+5e3,p.left-=10);var _=this.$view.css("maxHeight"),v=_?+/\d+/.exec(_)[0]:0,g=this.$view.height()||0,y=this.$view.width()||0,C=p.left,w=f.left-p.left;w+20>y&&(C+=w-y+20,w-=w-y+20),t(window).height()-p.top<v?(e=(f&&f.top||0)-g-25,this.$arrowUp.hide(),this.$arrowDown.show().find("span").css("left",w)):(e=f.top+25,this.$arrowDown.hide(),this.$arrowUp.show().find("span").css("left",w)),this.$view.css({left:C,top:e-50})}}},e.prototype.search=function(t){var e=this;if(!(this.currentUserId<0)){if(this.mentionStr=t,t){this.docResultList=[],this.userResultList=[],this.render("result");var n=this.options,o=n.mentionOptions,r=n.headers,i=void 0===r?{}:r;return function(t){return Object(d.a)(o,i,t,"file,recent_contact,team_member,collaborator",0,6,e.fileId).then(function(n){if(t===e.mentionStr){e.docResultList=(n.file.results||[]).map(function(t){return t.source});var o=n.recent_contact.results||[],r=n.team_member.results||[],i=n.collaborator.results;e.userResultList=l()(l()(o,r,"id"),i,"id");var s=e.userResultList.splice(e.halfMaxSearch);return e.docResultList.length>e.halfMaxSearch?e.docResultList.splice(e.maxSearch-e.userResultList.length):e.docResultList.length<e.halfMaxSearch&&s.length>0&&(s.splice(e.halfMaxSearch-e.docResultList.length),e.userResultList=e.userResultList.concat(s)),e.render("result"),e.select("init")}})}(t)}return this.userResultList=[],this.docResultList=[],this.render("placeholder")}},e.prototype.render=function(e){if(!(this.currentUserId<0))return this.$resultListView.empty(),"placeholder"===e&&(this.$placeholder.show(),this.$resultListView.hide(),this.show()),"result"===e?(this.$placeholder.hide(),this.userResultList.length||this.docResultList.length?(this.$resultListView.append(s()(m.a)({list:this.userResultList})).append(s()(m.a)({list:this.docResultList})).show(),this.$resultListView.find("li").each(function(e,n){t(n).attr("data-index",e)}),this.show()):this.hide()):void 0},e.prototype.moveCursor=function(t,e,n){n=n||this.currentTarget[0];var o=document.createRange();o.selectNodeContents(n),o.setStart(t,e),o.collapse(!0);var r=window.getSelection();r.removeAllRanges(),r.addRange(o)},e.prototype.getCurrentNodeIndex=function(t,e){var n=-1;e=e||this.currentTarget[0];for(var o=0;o<e.childNodes.length;o++){e.childNodes[o]===t&&(n=o)}return n},e.prototype.isOnline=function(t){return t===String(this.currentUserId)},e}());e.a=p}).call(e,n(84))},function(t,e,n){var o=n(1023),r=n(1024),i=n(1025),s=n(432),a=n(1026),c=n(727),u=n(149),l=n(10),h=n(728),m=n(1027),d=n(144),f=/\b__p \+= '';/g,p=/\b(__p \+=) '' \+/g,_=/(__e\(.*?\)|\b__t\)) \+\n'';/g,v=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,g=/($^)/,y=/['\n\r\u2028\u2029\\]/g;t.exports=function(t,e,n){var C=m.imports._.templateSettings||m;n&&u(t,e,n)&&(e=void 0),t=d(t),e=r({},e,C,o);var w,b,x=r({},e.imports,C.imports,o),S=l(x),O=s(x,S),R=0,E=e.interpolate||g,L="__p += '",M=RegExp((e.escape||g).source+"|"+E.source+"|"+(E===h?v:g).source+"|"+(e.evaluate||g).source+"|$","g"),A="sourceURL"in e?"//# sourceURL="+e.sourceURL+"\n":"";t.replace(M,function(e,n,o,r,i,s){return o||(o=r),L+=t.slice(R,s).replace(y,a),n&&(w=!0,L+="' +\n__e("+n+") +\n'"),i&&(b=!0,L+="';\n"+i+";\n__p += '"),o&&(L+="' +\n((__t = ("+o+")) == null ? '' : __t) +\n'"),R=s+e.length,e}),L+="';\n";var k=e.variable;k||(L="with (obj) {\n"+L+"\n}\n"),L=(b?L.replace(f,""):L).replace(p,"$1").replace(_,"$1;"),L="function("+(k||"obj")+") {\n"+(k?"":"obj || (obj = {});\n")+"var __t, __p = ''"+(w?", __e = _.escape":"")+(b?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+L+"return __p\n}";var j=i(function(){return Function(S,A+"return "+L).apply(void 0,O)});if(j.source=L,c(j))throw j;return j}},function(t,e,n){var o=n(29),r=Object.prototype,i=r.hasOwnProperty;t.exports=function(t,e,n,s){return void 0===t||o(t,r[n])&&!i.call(s,n)?e:t}},function(t,e,n){var o=n(63),r=n(167),i=n(270),s=r(function(t,e,n,r){o(e,i(e),t,r)});t.exports=s},function(t,e,n){var o=n(133),r=n(727),i=n(71)(function(t,e){try{return o(t,void 0,e)}catch(t){return r(t)?t:new Error(t)}});t.exports=i},function(t,e){var n={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"};t.exports=function(t){return"\\"+n[t]}},function(t,e,n){var o=n(1028),r={escape:n(1030),evaluate:n(1031),interpolate:n(728),variable:"",imports:{_:{escape:o}}};t.exports=r},function(t,e,n){var o=n(1029),r=n(144),i=/[&<>"'`]/g,s=RegExp(i.source);t.exports=function(t){return(t=r(t))&&s.test(t)?t.replace(i,o):t}},function(t,e){var n={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","`":"&#96;"};t.exports=function(t){return n[t]}},function(t,e){t.exports=/<%-([\s\S]+?)%>/g},function(t,e){t.exports=/<%([\s\S]+?)%>/g},function(t,e,n){var o=n(229),r=n(49),i=n(561),s=n(61),a=n(330),c=n(71)(function(t){var e=a(t);return s(e)&&(e=void 0),i(o(t,1,s,!0),r(e))});t.exports=c},function(t,e,n){"use strict";e.a='<div class="arrow-up">\n<span class="top"></span>\n<span class="down"></span>\n</div>\n<div class="arrow-down">\n<span class="top"></span>\n<span class="down"></span>\n</div>\n<ul>\n<li class="placeholder">@朋友或者文档</li>\n</ul>\n<ul class="result-list">\n</ul>'},function(t,e,n){"use strict";e.a='<% for (var index = 0, l = list.length; index < l; index++) { %>\n    <% var data = list[index] %>\n    <li class="mention-result" data-guid="<%= data.guid %>" data-name="<%= data.name %>" data-id="<%= data.id %>" data-type="<% data.guid ? print(\'doc\') : print(\'user\') %>">\n        <% if (!data.guid){ %>\n            <img class="avatar" src="<%= data.avatar %>"><%= data.name %>\n        <% } else { %>\n    <% if (data.type === \'folder\') {%>\n        <span class="file-sprite file-folder-icon mention-icon"></span>\n    <% } else if (data.type === \'document\' || data.type === \'newdoc\') { %>\n        <span class="file-sprite file-doc-icon mention-icon"></span>\n    <% } else if (data.type === \'sheet\' || data.type === \'spreadsheet\') { %>\n        <span class="file-sprite file-spreadsheet-icon mention-icon"></span>\n    <% } else if (data.type === \'slide\') { %>\n        <span class="file-sprite file-slide-icon mention-icon"></span>\n    <% } %>\n            <%= data.name %>\n        <% } %>\n    </li>\n<% } %>'},function(t,e,n){"use strict";e.a=function(t,e,n,o,i,c,u,l){void 0===o&&(o="file,recent_contact,team_member,collaborator");return function(t,e,n){return a(null,s({},t,{params:r.a.stringify(n),method:"post",headers:e}))}(t,e,{keyword:n,type:o,page:i,pageSize:c,fileId:u,teamId:l})};var o=n(525),r=n.n(o),i=n(1),s=(n.n(i),this&&this.__assign||function(){return(s=Object.assign||function(t){for(var e,n=1,o=arguments.length;n<o;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)}),a=i.sheets.ajax.ajax},function(t,e,n){Object.defineProperty(e,"__esModule",{value:!0}),e.regs=e.emailList=e.emailReg=e.notifications=e.keyCodes=e.KEY_CODES=e.FILE_ZH_TYPE_MAP=e.FILE_TYPE_URL_MAP=e.FILE_TYPE_MAP=void 0;var o=function(t){return t&&t.__esModule?t:{default:t}}(n(2));e.FILE_TYPE_MAP={0:"doc","-2":"docs","-1":"spreadsheet","-3":"sheet","-4":"sheet",1:"folder","-5":"slide"},e.FILE_TYPE_URL_MAP={0:"doc","-2":"docs","-1":"spreadsheet","-3":"sheet","-4":"sheets",1:"folder","-5":"slides"},e.FILE_ZH_TYPE_MAP={0:(0,o.default)("文档"),"-2":(0,o.default)("文档"),"-1":(0,o.default)("表格"),"-3":(0,o.default)("表格"),"-4":(0,o.default)("表格"),1:(0,o.default)("文件夹"),"-5":(0,o.default)("幻灯片")};var r=e.KEY_CODES={BACKSPACE:8,TAB:9,ENTER:13,ESC:27,CAPS_LOCK:20,LEFT:37,RIGHT:39,UP:38,DOWN:40,AT:50};e.keyCodes=r,e.notifications=[{name:(0,o.default)("企业版半价促销"),order:0,enable:!0,withCookie:!1,recordTag:"shimo_anniversary",text:(0,o.default)("石墨文档三周年，点击立享企业版限量优惠"),targetLink:"https://shimo.im/doc/VimyO5cXFRkTBhfZ",openNewTab:!0,startDate:"2017/05/11 00:00:00",endDate:"2017/05/31 00:01:00",targetUser:{isEnterpriseOfficial:!1}},{name:"ipad_bar",order:1,enable:!0,withCookie:!1,customize:"ipad-bar",recordTag:"ipad_bar",text:(0,o.default)("大家期待已久的 iPad 适配版终于上线了！"),startDate:"2017/11/07 00:00:00",endDate:"2017/11/29 00:00:00"}],e.emailReg=/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,e.emailList={"mapgis.com":"mail.mapgis.com","foxmail.com":"mail.foxmail.com","qq.com":"mail.qq.com","vip.qq.com":"mail.qq.com","gmail.com":"mail.google.com","163.com":"mail.163.com","126.com":"mail.126.com","yeah.net":"mail.yeah.net","tom.com":"mail.tom.com","188.com":"mail.188.com","sina.com":"mail.sina.com","sohu.com":"mail.sohu.com","yahoo.cn":"mail.yahoo.com","yahoo.com.cn":"mail.yahoo.com","hotmail.com":"mail.hotmail.com","live.com":"mail.live.com"},e.regs={url:/(http|https):\/\/[\w\-_]+(\.[\w\-_]+)+([\w\-.,@?^=%&amp;:/~+#]*[\w\-@?^=%&amp;/~+#])?/i,email:/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,guid:/^[0-9A-Za-z]{16}$/}},function(t,e,n){"use strict";n.d(e,"a",function(){return s});var o=n(2),r=n.n(o),i=0,s={test:function(t,e){!function(t,e,n){t.forEach(function(t){setTimeout(function(){t(e)},i+=n)})}([this.start.bind(this),this.cancel.bind(this),this.start.bind(this),this.create.bind(this),this.create.bind(this),this.delete.bind(this),this.close.bind(this)],t||window.CommentModel,e||1e3)},start:function(t){t.start({sheet:t.options.editor.spread.getActiveSheet().gcSheet,row:0,col:0})},cancel:function(t){t.cancel({sheet:t.options.editor.spread.getActiveSheet(),row:0,col:0})},create:function(t){var e=""+new Date;t.create({comment:{comment_guid:e,commentGuid:e,content:r()("这是一条评论")+e,created_at:(new Date).toISOString(),createdAt:(new Date).toISOString(),selection_title:t.options.editor.spread.getActiveSheet().gcSheet.guid()||"",selectionTitle:t.options.editor.spread.getActiveSheet().gcSheet.guid()||"",user_id:window.cow.currentUser.id,userId:window.cow.currentUser.id},row:0,col:0,user:{id:0,name:r()("路人"),avatar:"https://assets.smcdn.cn/static/unmd5/default-avatar-luren.2.png",isVerified:!0}})},delete:function(t){var e=t.commentsByRowAndCol({sheet:t.options.editor.spread.getActiveSheet(),row:0,col:0});e&&t.delete(e[0].comment_guid)},close:function(t){t.close({sheet:t.options.editor.spread.getActiveSheet(),row:0,col:0})}}},function(t,e){t.exports=function(e){e.Spread.Sheets.Comments=t.exports=function(t){var e={};function n(o){if(e[o])return e[o].exports;var r=e[o]={i:o,l:!1,exports:{}};return t[o].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=t,n.c=e,n.d=function(t,e,o){n.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:o})},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=3)}([function(t,n,o){"use strict";n.a=e.Spread.Sheets},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),n.d(e,"CommentState",function(){return et}),n.d(e,"DisplayMode",function(){return nt}),n.d(e,"Padding",function(){return ot}),n.d(e,"Comment",function(){return rt}),n.d(e,"_CommentView",function(){return it});var o,r=n(0),i=n(5),s=n(2),a=r.a._getFeatureManager,c=r.a.HookNames,u=r.a._FocusHelper,l=r.a._DPIHelper,h=r.a._defineFeature,m=r.a.Commands,d=r.a.Worksheet,f=null,p=Math.max,_=Math.min,v=Math.floor,g=Math.atan2,y=Math.abs,C=r.a.GC$,w=C.extend,b=i.a._ArrayHelper,x=r.a.Point,S=r.a.Rect,O=r.a.Range,R=r.a.Events,E=parseFloat,L=i.a._StringHelper,M=document,A="left",k="top",j="right",P="bottom",I="width",T="height",D="sm-sheet-spread-",N=898;function z(t,e){return new x(t,e)}function H(t,e,n,o){return new S(t,e,n,o)}function V(t){return t.height}function B(t){return t.width}w(d.prototype,{_paintComment:function(t){var e=this._commentRender();if(!this._hoverCell)for(var n,o=this._getSheetLayout(),r=0;r<=2;r++)for(var i=0;i<=2;i++)if((n=o._viewportRect(r,i))&&0!==B(n)&&0!==V(n)&&(!t||n.intersectRect(t))){var s=this.comments;e&&s&&e._renderComment(s)}}}),r.a.CellRange.prototype.comment=function(t){var e=this.sheet,n=this.row,o=this.col;return 0===arguments.length?e.comments.get(n,o):(t instanceof G&&e.comments._addInternal(n,o,t),this)};var F=function(t,e){var n=t._getCanvasOffset(),o=t.hitTest(e.pageX-n.left,e.pageY-n.top);o&&function(t,e){var n=-1,o=-1;e&&e.rowViewportIndex>=0&&e.colViewportIndex>=0&&(n=e.row,o=e.col);if(t.parent){if(n<0||o<0)return;var r=t.comments.get(n,o);t.comments&&t.comments._hoverShow(r)}}(t,o)},W={init:function(){var t=this;t.comments=new $(t),t._commentRender=function(){var e=t.parent;if(e)return e._commentRenderCache||(e._commentRenderCache=new tt(e._getContainerDiv())),e._commentRenderCache._sheet=t,t.parent._commentRenderCache}},dispose:function(){var t=this.comments;t&&t.all().forEach(function(e){t._hide(e)});!function(t){t.unbind("mousedown.comment").unbind("mousewheel.comment").unbind("mousemove.comment")}(C(this._getCanvas()))},setHost:function(t){if(t){var e=this,n=".comment";e.bind(R.TopRowChanged+n,function(){e.comments._updateCommentsLayoutWhenSheetScroll()}),e.bind(R.LeftColumnChanged+n,function(){e.comments._updateCommentsLayoutWhenSheetScroll()}),function(t,e){var n=e.comments;t.bind("mousedown.comment",function(){n._clearActiveComment()}).bind("mousewheel.comment",function(t){F(e,t)}).bind("mousemove.comment",function(t){F(e,t)})}(t,e)}},onLayoutChanged:function(t){var e=this.comments,n=t.changeType,o=t.row,r=t.rowCount,i=t.col,s=t.colCount;"addRows"===n?e._onRowsAdded(o,r):"deletingRows"===n?e._onRowsRemoved(o,r):"addColumns"===n?e._onColumnsAdded(i,s):"deletingColumns"===n?e._onColumnsRemoved(i,s):3===t.sheetArea&&("clear"===n?4==(4&t.type)&&e.clear(new O(o,i,r,s)):"addSpan"===n?U.call(this,!0,o,i,r,s):"removeSpan"===n&&U.call(this,!1,o,i))},paint:function(t){this.comments._isEmpty()||this._paintComment(t.clipRect)},afterCellPainted:function(t){t.isPrinting||3!==t.sheetArea||function(t,e,n){var o=this._commentRender();o&&o._renderCommentCellAdorner(t,e,n)}.call(this,t.ctx,t.sheetArea,t.cell)},toJson:function(t){var e=this.comments;t.comments=e.toJSON()},fromJson:function(t,e){if(t){var n=e?t.commentManager:t.comments;n&&this.comments.fromJSON(n,e)}},lastNonNullRowAndCol:function(){var t=0,e=0,n=this.comments;if(n){var o=n._commentViewList;if(o&&o.length>0)for(var r=0,i=o.length;r<i;r++){var s=o[r];s&&s._comment&&(s._endRow>t&&(t=s._endRow),s._endColumn>e&&(e=s._endColumn))}}return{lastNonNullRow:t,lastNonNullCol:e}},clearSelection:function(){var t=this.comments;t&&t._clearActiveComment()},processKeyDown:function(t){var e=this.comments&&this.comments._getActiveComment();e&&this._eventHandler._allowEnterEditing(t.e)&&(e.commentState(2),t.r=!0)}};function U(t,e,n,o,r){var i,s=this.comments;if(t&&s)for(var a=s.all(),c=0;c<a.length;c++){var u=(i=a[c])._rowIndex,l=i._colIndex;u===e&&l===n||u>=e&&u<e+o&&l>=n&&l<n+r&&s.remove(u,l)}if(i=s.get(e,n)){var h=s._getCommentView(i);h&&h._updateAbsoluteLocationAndLayout()}}function Y(t,e){return t&&t.getRowHeight(e)}function q(t,e){return t&&t.getColumnWidth(e)}function X(t,e){return t&&t.getViewportLeftColumn(e)}function Z(t,e){return t&&t.getViewportTopRow(e)}d._registerFeature("comments",W);var Q=((o={})[c.Workbook.init]=function(){m._initCommentDefaultCommands(this.commandManager())},o);a("Workbook").register("comments",Q);var K=function(){function t(t,e,n,o){arguments.length<=1?this[k]=this[j]=this[P]=this[A]=t||0:(this[k]=t,this[j]=e,this[P]=n,this[A]=o)}return t.prototype={constructor:t,clone:function(){return new t(this[k],this[j],this[P],this[A])},toString:function(){var t=this,e="";return[k,j,P,A].forEach(function(n){e+=t[n]+"px "}),e.trim()}},t}(),G=function(){function t(t,e,n){this._rowIndex=-1,this._colIndex=-1,this.text(t||""),this.guid(e||""),this.renderBorder(n||!1),this.zIndex(N)}var e=[],n={text:!0,guid:!0,renderBorder:!0,zIndex:!0};function o(t,o,r){return e.push(t),Object(s.a)(t,o,function(t){var e=t;return function(){var t=this._sheet;t&&(t._layoutSuspended<=0&&t._paintComment(),!n[e]&&t._trigger(R.CommentChanged,{sheet:t,sheetName:t?t._name:"",comment:this,propertyName:e}))}}(t),r)}var r={clone:function(){var n=this,o=new t;return e.forEach(function(t){var e=n[t]();n[t].isDefault(e)||o[t](e&&e.clone?e.clone():e)}),o._sheet=n._sheet,o._rowIndex=n._rowIndex,o._colIndex=n._colIndex,o},toJSON:function(){var t=this,n={rowIndex:t._rowIndex,colIndex:t._colIndex};return e.forEach(function(e){var o=t[e]();t[e].isDefault(o)||(n[e]=o&&o.clone?o.clone():o)}),n},fromJSON:function(t){if(t){var n=this;e.forEach(function(e){var o=t[e];void 0!==o&&("location"===e?n.location(new x(o.x,o.y),!1):"padding"===e?n.padding(new K(o.top,o.right,o.bottom,o.left),!1):n[e](o,!1))}),void 0!==t.rowIndex&&(n._rowIndex=t.rowIndex),void 0!==t.colIndex&&(n._colIndex=t.colIndex)}}};return[["text",""],["guid",[]],["isEditing",!1],["renderBorder",""],["location",z(9,-18)],[I,160,function(t){return t>0}],[T,100,function(t){return t>0}],["fontFamily","Arial"],["fontStyle","normal"],["fontSize","9pt",function(t){return/^\d+pt$/.test(t)&&parseInt(t)>0}],["fontWeight","normal"],["textDecoration",0],["foreColor","black"],["locked",!0],["lockText",!0],["horizontalAlign",0],["autoSize",!1],["dynamicSize",!0,function(t){return"boolean"==typeof t&&this.dynamicMove()}],["dynamicMove",!0,function(t){return t||this.dynamicSize(!1),!0}],["backColor","#FFFFE1"],["opacity",1,function(t){return t>=0&&t<=1}],["borderWidth",1,function(t){return t>=1}],["borderStyle","solid"],["borderColor","black"],["padding"],["showShadow",!1],["displayMode",2],["commentState",3],["zIndex",-1],["ignoreDefaultLocation",!1]].forEach(function(t){r[t[0]]=o(t[0],t[1],t[2])}),w(t.prototype,r),t}(),J=function(){function t(t,e){var n=t&&t._sheet;this._rowViewportIndex=1,this._columnViewportIndex=1,this._comment=t,this._updateCommentViewportIndex(),this._zoomFactor=n._zoomFactor,this._commentManager=e,this._editor=e._editorDom,this._init();var o=this._getAdjustedCommentRect(this._getAbsoluteLocation(),t.width(),t.height());this._absoluteLocation=z(o.x,o.y),this._updateStartCoordinate(),this._updateEndCoordinate()}function e(t,e,n,o,r){var i=H(e,n,o,o);i.cursor=r,t.push(i)}function n(t,e,n,o){C(t._floatBlockCanvas).css(e,n),C(t._hostContainer).css(e,o)}return h("CommentView",t),t.prototype={constructor:t,_init:function(){var e=this._comment._sheet;this._floatBlockCanvasClassName=D+"floatBlockCanvas",this._hostContainerClassName=D+"host-container",this._hostClassName=D+"host",this._lineCanvasClassName=D+"lineCanvas",this._floatBlockCanvasContainer=document.createElement("div"),C(this._floatBlockCanvasContainer).addClass(D+"floatBlockCanvas-container").css(["position","overflow","box-sizing"],["absolute","hidden","content-box"]),this._floatBlockCanvas=document.createElement("canvas"),l._adjustDPIAndAddToCacheForSheet(this._floatBlockCanvas,e),C(this._floatBlockCanvas).addClass(this._floatBlockCanvasClassName).css([A,k,"position"],[0,0,"absolute"]),this._hostContainer=document.createElement("div"),C(this._hostContainer).addClass(this._hostContainerClassName).css(["position","box-sizing","overflow"],["absolute","content-box","hidden"]),this._host=document.createElement("div"),C(this._host).addClass(this._hostClassName+" sm-sheet-no-select").css([A,k,I,T,"position","word-wrap","word-break","white-space","overflow","box-sizing","unselectable","line-height"],[0,0,"100%","100%","absolute","break-word","normal","pre-wrap","hidden","content-box","on","normal"]),C(this._hostContainer).append(this._host),C(this._floatBlockCanvasContainer).append(this._floatBlockCanvas).append(this._hostContainer),this._lineCanvasContainer=document.createElement("div"),C(this._lineCanvasContainer).addClass(D+"lineCanvas-container").css(["position","overflow","pointer-events"],["absolute","hidden","none"]),this._lineCanvas=document.createElement("canvas"),l._adjustDPIAndAddToCacheForSheet(this._lineCanvas,e),C(this._lineCanvas).addClass(this._lineCanvasClassName).css([A,j,"position"],[0,0,"absolute"]),C(this._lineCanvasContainer).append(this._lineCanvas),this._resizeHitRects=[],this._hostMargin=7,this._isMoving=!1,this._isResizing=!1,t._callFeatureHandler(this,"init",[this._floatBlockCanvas,this._host])},_open:function(){var t=this._comment._sheet;this._commentLayoutPanel||t&&(this._commentLayoutPanel=t._commentRender()._commentLayoutPanel),this._commentLayoutPanel&&(this._commentLayoutPanel.appendChild(this._lineCanvasContainer),this._attachLineCanvasEventHandler(),this._commentLayoutPanel.appendChild(this._floatBlockCanvasContainer),this._attachEventHandler(this._floatBlockCanvas,".floatBlockCanvas"),this._attachEventHandler(this._hostContainer,".hostContainer"),this._isEditing()?this._attachEditorEventHandler():this._attachHostEventHandler(),this._absoluteLocation=this._getAbsoluteLocation(),this._updateLayout())},_close:function(){this._floatBlockCanvasContainer&&this._lineCanvasContainer&&this._commentLayoutPanel&&(this._detachEventHandler(this._floatBlockCanvas,".floatBlockCanvas"),this._detachEventHandler(this._hostContainer,".hostContainer"),this._detachHostEventHandler(),this._detachLineCanvasEventHandler(),this._detachEditorEventHandler(),C(this._floatBlockCanvasContainer).remove(),C(this._lineCanvasContainer).remove())},_getActualWidth:function(){return this._comment.width()*this._zoomFactor},_getActualHeight:function(){return this._comment.height()*this._zoomFactor},_getAbsoluteLocation:function(){var t=this._comment;return t!==this._commentManager._hoverShowComment||3!==t.commentState()||t.ignoreDefaultLocation()?this._convertToAbsoluteLocation(t.location()):t._hoverLocation=this._convertToAbsoluteLocation(z(9,-18))},_convertToAbsoluteLocation:function(t){var e=this._comment,n=e&&e._sheet,o=this._zoomFactor,r=z(0,0);if(n){var i=this._getCellRect(n,e._rowIndex,e._colIndex,this._rowViewportIndex,this._columnViewportIndex);if(i.x!==f&&void 0!==i.x&&i.y!==f&&void 0!==i.y&&B(i)&&V(i)){var s=n._getSheetLayout();r.x=i.x+B(i)+t.x*o-s._rowHeaderWidth,r.y=i.y+t.y*o-s._colHeaderHeight}}return r},_getCellRect:function(t,e,n,o,r){var i,a,c=H(0,0,0,0),u=t._getSheetLayout(),l=Z(t,o),h=X(t,r),m=this._zoomFactor;i=Object(s.b)(t,h,n,!1),a=Object(s.b)(t,l,e,!0),c.y=e>=l?a:-a,c.x=n>=h?i:-i;var d=t.getSpan(e,n);void 0!==d&&d!==f?(c.height=Object(s.b)(t,e,e+d.rowCount,!0),c.width=Object(s.b)(t,n,n+d.colCount,!1)):(c.height=Y(t,e)*m,c.width=q(t,n)*m),c.x+=u._rowHeaderWidth,c.y+=u._colHeaderHeight;var p=u._frozenWidth,_=u._frozenHeight;return 1===o?c.y+=_:2===o&&(c.y+=_+u._viewportHeight),1===r?c.x+=p:2===r&&(c.x+=p+u._viewportWidth),c},_convertToRelativeLocation:function(t){var e=this._comment,n=e&&e._sheet,o=this._zoomFactor,r=z(0,0);if(n){var i=this._getCellRect(n,e._rowIndex,e._colIndex,this._rowViewportIndex,this._columnViewportIndex);if(i.x!==f&&void 0!==i.x&&i.y!==f&&void 0!==i.y&&B(i)&&V(i)){var s=n._getSheetLayout();r.x=(t.x-(i.x+B(i)-s._rowHeaderWidth))/o,r.y=(t.y-(i.y-s._colHeaderHeight))/o}}return r},_updateLayoutWhenLocationChanged:function(){this._absoluteLocation=this._getAbsoluteLocation(),this._updateStartCoordinate(),this._updateEndCoordinate(),this._updateLayout()},_updateLayoutWhenWidthHeightChanged:function(){this._absoluteLocation=this._getAbsoluteLocation(),this._updateEndCoordinate()},_updateLayoutWhenRowColumnChanged:function(){var t=this._comment;if(t.dynamicMove())t.dynamicSize()?this._updateSizeAndLocationByCoordinate():(this._updateLocationByCoordinate(),this._updateEndCoordinate());else{this._updateStartCoordinate(),this._updateEndCoordinate();var e=this._convertToRelativeLocation(this._absoluteLocation===t._hoverLocation?this._getAbsoluteLocation():this._absoluteLocation);t.location(e)}},_updateAbsoluteLocationAndLayout:function(){this._absoluteLocation=this._getAbsoluteLocation(),this._updateLayout()},_updateLocationByCoordinate:function(){var t=this._comment,e=this._getLocationByCoordinate();this._absoluteLocation=e,t.location(this._convertToRelativeLocation(e),!1),this._updateLayout()},_getLocationByCoordinate:function(){for(var t=this._comment,e=t&&t._sheet,n=this._zoomFactor,o=X(e,this._columnViewportIndex),r=Z(e,this._rowViewportIndex),i=0,a=0;a<this._columnViewportIndex;a++)i+=e.getViewportWidth(a);var c=Object(s.b)(e,o,this._startColumn,!1);o<this._startColumn?i+=c:i-=c;var u=q(e,this._startColumn);u<this._startColumnOffset&&(this._startColumnOffset=u),i+=this._startColumnOffset*n;for(var l=0,h=0;h<this._columnViewportIndex;h++)l+=e.getViewportHeight(h);var m=Object(s.b)(e,r,this._startRow,!0);r<this._startRow?l+=m:l-=m;var d=Y(e,this._startRow);return d<this._startRowOffset&&(this._startRowOffset=d),z(i,l+=this._startRowOffset*n)},_updateSizeByCoordinate:function(){var t=this._comment,e=t&&t._sheet,n=Object(s.b)(e,this._startColumn,this._endColumn,!1),o=q(e,this._startColumn);o<this._startColumnOffset&&(this._startColumnOffset=o);var r=q(e,this._endColumn);r<this._endColumnOffset&&(this._endColumnOffset=r),n=n-this._startColumnOffset+this._endColumnOffset;var i=Object(s.b)(e,this._startRow,this._endRow,!0),a=Y(e,this._startRow);a<this._startRowOffset&&(this._startRowOffset=a);var c=Y(e,this._endRow);c<this._endRowOffset&&(this._endRowOffset=c),i=i-this._startRowOffset+this._endRowOffset,t.width(n),t.height(i)},_updateSizeAndLocationByCoordinate:function(){this._updateSizeByCoordinate(),this._updateLocationByCoordinate()},_updateStartCoordinate:function(){var t=this._comment,e=t&&t._sheet,n=this._zoomFactor;if(this._absoluteLocation){var o,r,i=X(e,this._columnViewportIndex),s=Z(e,this._rowViewportIndex);0===this._columnViewportIndex?o=this._absoluteLocation.x:1===this._columnViewportIndex?o=this._absoluteLocation.x-e.getViewportWidth(0):2===this._columnViewportIndex&&(o=this._absoluteLocation.x-(e.getViewportWidth(0)+e.getViewportWidth(1))),0===this._rowViewportIndex?r=this._absoluteLocation.y:1===this._rowViewportIndex?r=this._absoluteLocation.y-e.getViewportHeight(0):2===this._rowViewportIndex&&(r=this._absoluteLocation.y-(e.getViewportHeight(0)+e.getViewportHeight(1)));for(var a=z(o,r),c=0,u=0,l=i;l<e.getColumnCount();l++){var h=q(e,l)*n;if(!(c+h<a.x)){this._startColumn=l,this._startColumnOffset=(a.x-c)/n;break}c+=h}for(var m=s;m<e.getRowCount();m++){var d=Y(e,m)*n;if(!(u+d<a.y)){this._startRow=m,this._startRowOffset=(a.y-u)/n;break}u+=d}}},_updateEndCoordinate:function(){var t=this._comment,e=t&&t._sheet,n=this._zoomFactor;if(this._absoluteLocation){var o,r,i=X(e,this._columnViewportIndex),s=Z(e,this._rowViewportIndex);0===this._columnViewportIndex?o=this._absoluteLocation.x+this._getActualWidth():1===this._columnViewportIndex?o=this._absoluteLocation.x+this._getActualWidth()-e.getViewportWidth(0):2===this._columnViewportIndex&&(o=this._absoluteLocation.x+this._getActualWidth()-(e.getViewportWidth(0)+e.getViewportWidth(1))),0===this._rowViewportIndex?r=this._absoluteLocation.y+this._getActualHeight():1===this._rowViewportIndex?r=this._absoluteLocation.y+this._getActualHeight()-e.getViewportHeight(0):2===this._rowViewportIndex&&(r=this._absoluteLocation.y+this._getActualHeight()-(e.getViewportHeight(0)+e.getViewportHeight(1)));for(var a=z(o,r),c=0,u=0,l=i;l<e.getColumnCount();l++){var h=q(e,l)*n;if(!(c+h<a.x)){this._endColumn=l,this._endColumnOffset=(a.x-c)/n;break}c+=h}for(var m=s;m<e.getRowCount();m++){var d=Y(e,m)*n;if(!(u+d<a.y)){this._endRow=m,this._endRowOffset=(a.y-u)/n;break}u+=d}}},_onRowsAdded:function(t,e){var n=this._comment;t<=this._startRow?n.dynamicMove()&&(this._startRow+=e,this._endRow+=e):t>this._startRow&&t<=this._endRow&&n.dynamicSize()&&(this._endRow+=e),this._updateSizeAndLocationByCoordinate()},_onColumnsAdded:function(t,e){var n=this._comment;t<=this._startColumn?n.dynamicMove()&&(this._startColumn+=e,this._endColumn+=e):t>this._startColumn&&t<=this._endColumn&&n.dynamicSize()&&(this._endColumn+=e),this._updateSizeAndLocationByCoordinate()},_onRowsRemoved:function(t,e){var n=this._comment,o=t+e-1;t<this._startRow?o<this._startRow?n.dynamicMove()&&(this._startRow-=e,this._endRow-=e):o<this._endRow&&n.dynamicMove()&&(n.dynamicSize()?this._endRow-=e:this._endRow-=this._startRow-t+1,this._startRow=t,this._startRowOffset=0):t<=this._endRow&&(o<this._endRow?n.dynamicSize()&&(this._endRow-=e):n.dynamicSize()&&(this._endRow=t,this._endRowOffset=0)),this._updateSizeAndLocationByCoordinate()},_onColumnsRemoved:function(t,e){var n=this._comment,o=t+e-1;t<this._startColumn?o<this._startColumn?n.dynamicMove()&&(this._startColumn-=e,this._endColumn-=e):o<this._endColumn&&n.dynamicMove()&&(n.dynamicSize()?this._endColumn-=e:this._endColumn-=this._startColumn-t+1,this._startColumn=t,this._startColumnOffset=0):t<=this._endColumn&&(o<this._endColumn?n.dynamicSize()&&(this._endColumn-=e):n.dynamicSize()&&(this._endColumn=t,this._endColumnOffset=0)),this._updateSizeAndLocationByCoordinate()},_updateLayout:function(){var t=this._comment,e=t._sheet;this._isOpened()&&(this._zoomFactor!==e._zoomFactor?(this._zoomFactor=e._zoomFactor,this._absoluteLocation=this._getLocationByCoordinate()):(this._zoomFactor=e._zoomFactor,this._absoluteLocation!==t._hoverLocation||1!==t.displayMode()&&2!==t.commentState()||(this._absoluteLocation=this._getAbsoluteLocation())),this._updateCommentViewportIndex(),this._updateIndicatorSize(),this._formatComment(),this._updateLineContainerLayout(),this._updateAdornerLayout(),s.e.chrome&&this._offsetCommentLayoutInChrome())},_updateIndicatorSize:function(){var t=this._comment._sheet,e=t.parent&&t.parent.options.useTouchLayout;this._hostMargin=e?11:7},_updateCommentViewportIndex:function(){var t=this._comment,e=t._sheet;this._rowViewportIndex=e._getRowViewportIndex(t._rowIndex),this._columnViewportIndex=e._getColumnViewportIndex(t._colIndex)},_formatComment:function(){var t=2===this._comment.commentState()?this._editor:this._host;this._formatCommentState(),this._formatCommentStyle(t),this._formatCommentText(t),this._formatCommentRect(t),this._formatCommentProtection()},_formatCommentText:function(t){var e=this._comment;t===this._host&&(t.innerHTML=L._escapeHtml(e.text()))},_formatCommentRect:function(t){var e=this._comment,o=2===e.commentState()||1===e.displayMode()?this._getAbsoluteLocation():this._absoluteLocation,r=this._zoomFactor;if(o){var i;i=this._isResizing?this._getAdjustedCommentRect(o,e.width(),e.height()):this._getAdjustedCommentRect(o),this._adjustCommentRect(i);var s=B(i)*r,a=V(i)*r,c=i.x,u=i.y,h=c+s,m=u+a,d=this._hostMargin,f=this._getViewportRect(this._rowViewportIndex,this._columnViewportIndex);c<f.x?(n(this,A,c-f.x,c+d-f.x),s+=c-f.x,c=f.x):(n(this,A,0,d),h>f.x+B(f)&&(s+=f.x+B(f)-1-h)),s=_(B(f)-1,s),u<f.y?(n(this,k,u-f.y,u+d-f.y),a+=u-f.y,u=f.y):(n(this,k,0,d),m>f.y+V(f)&&(a+=f.y+V(f)-1-m)),a=_(V(f)-1,a),C(this._floatBlockCanvasContainer).css({left:c,top:u,width:s,height:a});var v=s,g=a;l._setSize(this._floatBlockCanvas,v,g);var y=p(0,v-2*(d+e.borderWidth())),w=p(0,g-2*(d+e.borderWidth()));C(this._hostContainer).css({width:y,height:w});var b=y,x=w,S=e.padding();S&&(b-=Math.ceil(E(S.left)+E(S.right)),x-=Math.ceil(E(S.top)+E(S.bottom))),C(t).css({width:p(0,b),height:p(0,x)})}},_adjustCommentRect:function(t){var e=this._comment,n=this._absoluteLocation;if(t.x!==n.x||t.y!==n.y||B(t)!==e.width()||V(t)!==e.height()){var o=this._convertToRelativeLocation(z(t.x,t.y)),r=B(t),i=V(t),s=e.location();o.x===s.x&&o.y===s.y||e.location(o,!1),r!==e.width()&&e.width(r,!1),i!==e.height()&&e.height(i,!1),e.dynamicMove()&&(this._absoluteLocation=z(t.x,t.y))}},_formatCommentProtection:function(){this._comment;this._attachEventHandler(this._floatBlockCanvas,".floatBlockCanvas"),this._attachEventHandler(this._hostContainer,".hostContainer"),this._attachLineCanvasEventHandler(),this._attachHostEventHandler(),this._attachEditorEventHandler()},_formatCommentState:function(){var t=this._comment,e=this._commentManager,n=t&&t._sheet;switch(t.commentState()){case 1:e._setActiveComment(t),this._isEditing()&&this._detachEditor(),n.getSelections().length>0&&n._saveAndClearSheetSelections(),u._setActiveElement(n);break;case 2:e._setActiveComment(t),this._isEditing()||this._attachEditor(),n.getSelections().length>0&&n._saveAndClearSheetSelections(),u._setActiveElement(f);break;case 3:t===e._getActiveComment()&&(e._clearActiveComment(),0===n.getSelections().length&&n._loadAndSetSheetSelections())}},_formatCommentStyle:function(t){var e=this._comment,n=C(t);n.css("font-family",e.fontFamily()).css("font-style",e.fontStyle()).css("font-size",parseInt(e.fontSize())*this._zoomFactor+"pt").css("font-weight",e.fontWeight()),n.css("text-decoration",r.a._StyleHelper._composeTextDecoration(e.textDecoration()));n.css("text-align",{0:"left",1:"center",2:"right",3:"general"}[e.horizontalAlign()]),e.padding()?n.css("padding",e.padding().toString()):n.css("padding","0px"),n.css("background-color",function(t,e,n){if(!n)return t;var o=i.a._ColorHelper,r=o._fromString(t);return r.a=e,o._toString(r)}(e.backColor(),e.opacity(),t===this._host)).css("color",e.foreColor()),C(this._hostContainer).css("border-width",e.borderWidth()).css("border-style",e.borderStyle()).css("border-color",e.borderColor());var o=this._commentManager._getCommentActualZIndex(e);C(this._lineCanvasContainer).css("z-index",o),C(this._floatBlockCanvasContainer).css("z-index",o)},_offsetCommentLayoutInChrome:function(){var t=this._comment._sheet,e=C(this._hostContainer);if(t&&e){var n=t._getCanvasOffset(),o=n.left-Math.floor(n.left)>=.5?.5:0,r=n.top-Math.floor(n.top)>=.5?.5:0;e.css(A,E(e.css(A))+o),e.css(k,E(e.css(k))+r)}},_updateLineContainerLayout:function(){var t=this._comment,e=t._sheet,n=this._getCellRect(e,t._rowIndex,t._colIndex,this._rowViewportIndex,this._columnViewportIndex),o=e._getSheetLayout(),r=z(n.x+B(n)-o._rowHeaderWidth,n.y-o._colHeaderHeight),i=f,s=C(this._floatBlockCanvasContainer).position(),a=C(this._hostContainer).position(),c=C(this._hostContainer);s&&a&&(i=s.left+a.left>r.x?z(s.left+a.left,s.top+a.top):s.top+a.top+c.height()<r.y?z(s.left+a.left+c.width(),s.top+a.top+c.height()):z(s.left+a.left+c.width(),s.top+a.top));var u=this._hostMargin,h=y(r.x-i.x)+2*u,m=y(r.y-i.y)+2*u,d=_(r.x,i.x)-u,p=_(r.y,i.y)-u,v=d+h,g=p+m,w=this._getViewportRect(this._rowViewportIndex,this._columnViewportIndex);d<w.x&&(h-=w.x-d,d=w.x),v>w.x+B(w)&&(h-=v-(w.x+B(w))),h=_(B(w),h),p<w.y&&(m-=w.y-p,p=w.y),g>w.y+V(w)&&(m-=g-(w.y+V(w))),m=_(V(w),m),C(this._lineCanvasContainer).css(A,d).css(k,p).css(I,h).css(T,m),l._setSize(this._lineCanvas,h,m),r.x=r.x-d,r.y=r.y-p,i.x=i.x-d,i.y=i.y-p,this._drawLine(r,i)},_drawLine:function(t,e){this._lineCtx||(this._lineCtx=this._lineCanvas.getContext("2d"));var n=this._lineCtx,o=this._comment.borderColor();n.strokeStyle=o,n.clearRect(0,0,l._getLogicWidth(this._lineCanvas),l._getLogicHeight(this._lineCanvas)),n.beginPath(),n.moveTo(t.x,t.y),n.lineTo(e.x,e.y),n.stroke(),n.save(),Object(s.d)(n,t.x,t.y),n.fillStyle=o,n.beginPath();var r=g(e.y-t.y,e.x-t.x);n.rotate(r),n.moveTo(0,0),n.lineTo(7,-4),n.lineTo(7,4),n.lineTo(0,0),n.fill(),Object(s.d)(n,-t.x,-t.y),n.closePath(),n.restore()},_updateAdornerLayout:function(){this._adornerDrawState=this._comment.commentState(),this._adornerCtx||(this._adornerCtx=this._floatBlockCanvas.getContext("2d"));var t=this._adornerCtx,e=l._getLogicWidth(this._floatBlockCanvas),n=l._getLogicHeight(this._floatBlockCanvas),o=C(this._hostContainer).outerWidth(),r=C(this._hostContainer).outerHeight(),i=this._hostMargin;if(t.clearRect(0,0,e,n),this._comment.showShadow()){this._drawStateAdorner(t,e,n);var s=2*(i+2);t.clearRect(i,i,e-s,n-s),this._drawShadowAdorner(t,i,o,r)}this._drawResizeIndicators(t,i,e,n,o,r),t.restore()},_drawShadowAdorner:function(t,e,n,o){t.fillRect(e+2,o+e,n,2),t.fillRect(n+e,e+2,2,o)},_drawStateAdorner:function(t,e,n){var o,r;switch(this._adornerDrawState){case 1:for(t.beginPath(),r=0;r<n;r++)for(o=r%2==0?1:3;o<e;)t.moveTo(o,r),t.lineTo(o+1,r+1),o+=4;t.stroke(),t.closePath();break;case 2:t.beginPath(),o=0,r=0;for(;o<e+n;)t.moveTo(o+4,0),t.lineTo(0,r+4),o+=4,r+=4;t.stroke(),t.closePath()}},_drawResizeIndicators:function(t,n,o,r,i,a){var c=this,u=c._resizeHitRects;1!==c._adornerDrawState&&2!==c._adornerDrawState||(u.splice(0,u.length),e(u,0,0,n,"nw-resize"),e(u,o-n,0,n,"ne-resize"),e(u,0,r-n,n,"sw-resize"),e(u,o-n,r-n,n,"se-resize"),a>=3*n?(e(u,0,v(r/2-n/2),n,"w-resize"),e(u,o-n,v(r/2-n/2),n,"e-resize")):(u.push(f),u.push(f)),i>=3*n?(e(u,v(o/2-n/2),0,n,"n-resize"),e(u,v(o/2-n/2),r-n,n,"s-resize")):(u.push(f),u.push(f)),t.restore(),t.fillStyle="white",t.strokeStyle="#939393",t.linewidth=1,Object(s.d)(t,.5,.5),C.each(u,function(){if(c){var e=this.x,n=this.y,o=B(this),r=V(this);t.beginPath(),t.fillRect(e,n,o-1,r-1),t.strokeRect(e,n,o-1,r-1),t.stroke(),t.closePath()}}),Object(s.d)(t,-.5,-.5))},_drawMoveResizeContainer:function(){var t=this,e=t._getViewportRect(t._rowViewportIndex,t._columnViewportIndex);t._moveResizeContainerDom?C(t._moveResizeContainerDom).remove():t._moveResizeContainerDom=document.createElement("div");var n=C(t._moveResizeContainerDom),o=C(t._hostContainer);n.addClass("sm-sheet-spread-moveResizeContainer").css(["position",A,k,I,T,"border"],["absolute",t._absoluteLocation.x+t._hostMargin-e.x,t._absoluteLocation.y+t._hostMargin-e.y,o.outerWidth()-2,o.outerHeight()-2,"gray solid thin"]),t._moveResizePanelDom?C(t._moveResizePanelDom).remove():t._moveResizePanelDom=document.createElement("div");var r=C(t._moveResizePanelDom);r.bind("mousemove",function(e){t._doMouseMove(e)}).bind("mouseup",function(e){t._doMouseUp(e)}).css(["position","overflow",k,A,I,T,"background","z-index"],["absolute","hidden",e.y,e.x,B(e),V(e),"rgba(255,255,255,0.01)",901]),r.append(t._moveResizeContainerDom),t._commentLayoutPanel&&t._commentLayoutPanel.appendChild(t._moveResizePanelDom)},_doMoveResizeContainer:function(t){var e=this._hostMargin,n=this._zoomFactor,o=this._commentManager._mouseCapture;if(o._capture){var r=this._getViewportScrollOffset(),i=t.pageX/n-o.x+r.x,s=t.pageY/n-o.y+r.y;if(0===i&&0===s)return;var a,c=this._getViewportRect(this._rowViewportIndex,this._columnViewportIndex),u=C(this._moveResizeContainerDom);if(o._resizeDirct<0){var l=o._cachedRect.x+i,h=o._cachedRect.y+s;a=this._convertToAbsoluteLocation(z(l,h)),u.css([A,k],[a.x+e-c.x,a.y+e-c.y])}else{var m=this._getResizeRect(i,s,o._resizeDirct);a=this._convertToAbsoluteLocation(z(m.x,m.y)),u.css([A,k,I,T],[a.x+e-c.x,a.y+e-c.y,B(m)*n-2*e-2,V(m)*n-2*e-2])}}},_attachEditor:function(){var t=this._comment;if(!this._isEditing()){var e=this._commentManager._editorDom;C(this._host).remove(),this._detachHostEventHandler(),C(e).remove(),C(this._hostContainer).append(e),this._setDomStyle(e),this._formatCommentRect(e),C(e).focus(),e.selectionStart=e.value.length,this._attachEditorEventHandler(),2!==t.commentState()&&t.commentState(2)}},_detachEditor:function(){var e=this._comment,n=e._sheet;if(this._isEditing()){var o=this._commentManager._editorDom;C(o).remove(),this._detachEditorEventHandler(),C(this._hostContainer).append(this._host),this._setDomStyle(this._host),this._attachHostEventHandler(),t._callFeatureHandler(this,"detachEditor",this._host),2===e.commentState()&&e.commentState(3),C(o).val()!==e.text()&&n._commandManager().execute({cmd:"changeComment",sheetName:n.name(),comment:e,oldValue:e.text(),newValue:C(o).val(),propertyName:"text"})}},_getViewportHeight:function(t){var e=this._comment._sheet,n=-1;return 0===t||2===t?n=e.getViewportHeight(t):1===t&&(n=Object(s.b)(e,e.getViewportBottomRow(0)+1,Z(e,2)+1,!0)),n},_getViewportWidth:function(t){var e=this._comment._sheet,n=-1;return 0===t||2===t?n=e.getViewportWidth(t):1===t&&(n=Object(s.b)(e,e.getViewportRightColumn(0)+1,X(e,2)+1,!1)),n},_getViewportRect:function(t,e){var n=this._comment._sheet._getSheetLayout(),o=n._viewportRect(t,e);return 0===t&&0===e||0===t&&2===e||2===t&&0===e||2===t&&2===e?o=H(0,0,n._frozenWidth+n._viewportWidth+n._frozenTrailingWidth,n._frozenHeight+n._viewportHeight+n._frozenTrailingHeight):0===t&&1===e||2===t&&1===e?o=H(n._frozenWidth,0,n._viewportWidth,n._frozenHeight+n._viewportHeight+n._frozenTrailingHeight):1===t&&0===e||1===t&&2===e?o=H(0,n._frozenHeight,n._frozenWidth+n._viewportWidth+n._frozenTrailingWidth,n._viewportHeight):1===t&&1===e&&(o=H(n._frozenWidth,n._frozenHeight,n._viewportWidth,n._viewportHeight)),o},_setDomStyle:function(t){var e=this._comment,n=C(t);t!==this._editor&&t!==this._host||(t===this._editor?t.value=e.text():t.innerHTML=L._escapeHtml(e.text()),n.css(["font-family","font-style","font-size","font-weight","color","background-color","text-align","text-decoration"],[e.fontFamily(),e.fontStyle(),e.fontSize(),e.fontWeight(),e.foreColor(),e.backColor(),e.horizontalAlign(),e.textDecoration()]),e.padding()?n.css("padding",e.padding().toString()):n.css("padding","0px"))},_isOpened:function(){return this._floatBlockCanvasContainer&&this._floatBlockCanvasContainer.parentNode},_isEditing:function(){return this._isOpened()&&this._comment===this._commentManager._getActiveComment()&&C(this._hostContainer).find("textArea").length>0},_getCommentRect:function(){var t=this._comment._sheet,e=f;if(this._isOpened()){var n=t._getSheetLayout();e=H(this._absoluteLocation.x+n._headerX+n._rowHeaderWidth,this._absoluteLocation.y+n._headerY+n._colHeaderHeight,this._getActualWidth(),this._getActualHeight())}return e},_getCommentEditorRect:function(){var t=this._comment,e=this._zoomFactor;if(this._isOpened()){var n=this._getCommentRect();if(n){var o=(this._hostMargin+t.borderWidth())*e,r=o;return H(n.x+o,n.y+r,B(n)-2*o,V(n)-2*r)}}return f},_setCursorState:function(t){this._comment;var e=t.target,n=this._commentManager._mouseCapture,o=e.style,r="default";if(n._capture)e.className!==this._hostClassName&&e.className!==this._floatBlockCanvasClassName&&e.className!==this._lineCanvasClassName&&e.className!==D+"floatPanel"||(r=n._resizeDirct>=0?"crosshair":"move");else if(e.className===this._hostClassName)r="text";else if(e.className===this._floatBlockCanvasClassName||e.className===this._hostContainerClassName){var i=this._getResizeDirection(t);r=i>=0&&i<this._resizeHitRects.length?this._resizeHitRects[i].cursor:"move"}o.cursor=r},_doMouseDownToEdit:function(e){var n=this._comment,o=n&&n._sheet;if(o.endEdit()){o._unSelectAllFloatingObjects&&o._unSelectAllFloatingObjects();var r={e:e,r:f};if(t._callFeatureHandler(this,"preProcessMouseDownEdit",r),!r.r)return this._commentManager._setActiveComment(n),n.commentState(2),this._doMouseUp(e),Object(s.f)(e)}},_doMouseDownToDragOrResize:function(e){var n=this._comment,o=n&&n._sheet,r=this._zoomFactor,i=this._commentManager,s=i._mouseCapture;if(o.endEdit()){o._unSelectAllFloatingObjects&&o._unSelectAllFloatingObjects();var a={e:e,r:f};if(t._callFeatureHandler(this,"preProcessMouseDownDragResize",a),!a.r){s.x=e.pageX/r,s.y=e.pageY/r,s._cachedRect=H(n.location().x,n.location().y,n.width(),n.height()),s._resizeDirct=this._getResizeDirection(e),this._handleDocumentMouseMove(),s._capture=!0,this._setCursorState(e),i._setActiveComment(n),n.commentState(1),this._moveInfo={},this._moveInfo._startTopRow=Z(o,this._rowViewportIndex),this._moveInfo._startLeftColumn=X(o,this._columnViewportIndex),this._drawMoveResizeContainer(),s._resizeDirct<0?this._isMoving=!0:this._isResizing=!0;var c=o._eventHandler,u=o._getCanvasOffset(),l=z(e.pageX-u.left,e.pageY-u.top),h=o.hitTest(l.x,l.y);c._startHitInfo={_scrollRowViewportIndex:h.rowViewportIndex,_scrollColViewportIndex:h.colViewportIndex,_hitTestType:h.hitTestType},c._mousePosition=l,c._startScroll(),c._isCommentWorking=!0,e.stopPropagation()}}},_getAdjustedCommentRect:function(t,e,n){var o,r,i=this._comment,a=i&&i._sheet,c=this._hostMargin,u=this._zoomFactor,l=this._columnViewportIndex,h=this._rowViewportIndex,m=this._getViewportRect(h,l);1===arguments.length?(o=this._getActualWidth(),r=this._getActualHeight()):3===arguments.length&&(o=e*u,r=n*u);var d,f,p,_,v=t.x,g=t.y,C=a._getSheetLayout(),w=this._getCellRect(a,0,0,h,l),b=t.x+(0-(w.x-C._rowHeaderWidth))+o-c,x=t.y+(0-(w.y-C._colHeaderHeight))+r-c;if(0===l)d=0-c,p=B(C)-C._rowHeaderWidth;else if(1===l){var S=Object(s.b)(a,a.getViewportRightColumn(0)+1,X(a,1),!1);d=m.x-c-S,p=this._getViewportWidth(2)}else 2===l&&(d=0-c,p=0);if(v<d&&(this._isResizing?o-=d-v:b+=d-v,v=d),1!==l&&2!==l||(p+=Object(s.b)(a,0,a.getColumnCount(),!1,b)),b>p)if(this._isResizing)o-=b-p;else if(this._isMoving)v-=b-p;else{var O=this._commentManager._hoverShowComment&&!i.ignoreDefaultLocation()?9:i.location().x,R=2*y(O)+q(a,i._colIndex)+i.width(),E=v-R;if(E>d)v=E;else if(v<p)o-=b-p;else{E=v-R,b-R>d?E<d?(o-=d-E,v=d):v=E:(E=v-(b-p))<d?(o-=d-E,v=d):v=E}}if(0===h)f=0-c,_=V(C)-C._colHeaderHeight;else if(1===h){var L=Object(s.b)(a,a.getViewportBottomRow(0)+1,Z(a,1),!0);f=m.y-c-L,_=this._getViewportHeight(2)}else 2===h&&(f=0-c,_=0);if(g<f&&(this._isResizing?r-=f-g:x+=f-g,g=f),1!==h&&2!==h||(_+=Object(s.b)(a,0,a.getRowCount(),!0,x)),x>_)if(this._isResizing)r-=x-_;else if(this._isMoving)g-=x-_;else if(x>_){var M=g-(x-_);M<f?(r-=f-M,g=f):g=M}return H(v,g,o/u,r/u)},_getViewportScrollOffset:function(){var t=this._comment._sheet,e=this._moveInfo,n=e._startTopRow,o=e._startLeftColumn,r=Z(t,this._rowViewportIndex),i=X(t,this._columnViewportIndex),a=Object(s.b)(t,n,r,!0),c=Object(s.b)(t,o,i,!1);return z(o<i?c:-c,n<r?a:-a)},_doMoveResizeComment:function(t){var e=this._comment,n=e&&e._sheet,o=this._zoomFactor,r=this._commentManager._mouseCapture,i=m.ChangeComment;if(r._capture){var s,a,c,u=this._getViewportScrollOffset(),l=t.pageX/o-r.x+u.x,h=t.pageY/o-r.y+u.y;if(0===l&&0===h)return;if(r._resizeDirct<0){var d=r._cachedRect.x+l,f=r._cachedRect.y+h;s=this._convertToAbsoluteLocation(z(d,f)),a=this._getAdjustedCommentRect(s),(c=this._convertToRelativeLocation(z(a.x,a.y))).x===e.location().x&&c.x===e.location().y||n._commandManager().execute({cmd:"changeComment",sheetName:n.name(),comment:e,oldValue:e.location().clone(),newValue:c,propertyName:"location"})}else{e.autoSize(!1);var p=this._getResizeRect(l,h,r._resizeDirct);s=this._convertToAbsoluteLocation(z(p.x,p.y)),a=this._getAdjustedCommentRect(s,B(p),V(p));var _=[];(c=this._convertToRelativeLocation(z(a.x,a.y))).x===e.location().x&&c.y===e.location().y||_.push(new i(n,{cmd:"changeComment",sheetName:n.name(),comment:e,oldValue:e.location().clone(),newValue:c,propertyName:"location"})),B(a)!==e.width()&&_.push(new i(n,{cmd:"changeComment",sheetName:n.name(),comment:e,oldValue:e.width(),newValue:a.width,propertyName:I})),V(a)!==e.height()&&_.push(new i(n,{cmd:"changeComment",sheetName:n.name(),comment:e,oldValue:e.height(),newValue:a.height,propertyName:T})),_.length>0&&n._commandManager().execute({cmd:"changeCommentTransaction",sheetName:n.name(),commands:_})}}},_doMouseMove:function(e){var n=this._comment._sheet;if(this._setCursorState(e),!(n.getSelections()&&n.getSelections().length>0)){var o={e:e,r:f};if(t._callFeatureHandler(this,"preProcessMouseMove",o),!o.r){var r=this._commentManager,i=e.target,a=n._eventHandler,c=n._getCanvasOffset(),u=z(e.pageX-c.left,e.pageY-c.top);return i&&r._mouseCapture._capture&&(this._moveResizeContainerDom&&this._doMoveResizeContainer(e),1===this._rowViewportIndex&&(a._mousePosition.y=u.y),1===this._columnViewportIndex&&(a._mousePosition.x=u.x),a._continueScroll()),Object(s.f)(e)}}},_doMouseUp:function(e){var n=this._comment._sheet;if(!(n.getSelections()&&n.getSelections().length>0)){var o={e:e,r:f};if(t._callFeatureHandler(this,"preProcessMouseUp",o),!o.r){var r=e.target,i=this._commentManager,a=n._eventHandler;return a._isCommentWorking=!1,a._stopScroll(),r&&(this._doMoveResizeComment(e),this._moveResizePanelDom&&(C(this._moveResizePanelDom).remove(),this._moveResizePanelDom=null,this._isMoving=!1,this._isResizing=!1),this._unhandleDocumentMouseMove(),i._mouseCapture._capture=!1,this._setCursorState(e)),Object(s.f)(e)}}},_getResizeDirection:function(t){var e=this._resizeHitRects;if(e.length>0&&(1===this._adornerDrawState||2===this._adornerDrawState))for(var n=C(t.target),o=t.pageX-n.offset().left,r=t.pageY-n.offset().top,i=0;i<e.length;i++){var s=e[i];if(s&&s.contains(o,r))return i}return-1},_getResizeRect:function(t,e,n){var o=-1,r=-1;switch(n){case 0:o=0,r=0;break;case 1:o=2,r=0;break;case 2:o=0,r=2;break;case 3:o=2,r=2;break;case 4:o=0,r=1;break;case 5:o=2,r=1;break;case 6:o=1,r=0;break;case 7:o=1,r=2}var i=this._getHorizontalInfo(t,o),s=this._getVerticalInfo(e,r);return H(i.x,s.y,i.w,s.h)},_getHorizontalInfo:function(t,e){var n=2*this._hostMargin,o=this._commentManager._mouseCapture,r=B(o._cachedRect)-n;0===e?r-=t:2===e&&(r+=t);var i=o._cachedRect.x;r>=0?0===e&&(i+=t):0===e?i+=B(o._cachedRect)-n:2===e&&(i+=r);var s=B(o._cachedRect);return 1!==e&&(s=y(r)+n),{x:i,w:s}},_getVerticalInfo:function(t,e){var n=2*this._hostMargin,o=this._commentManager._mouseCapture,r=V(o._cachedRect)-n;0===e?r-=t:2===e&&(r+=t);var i=o._cachedRect.y;r>=0?0===e&&(i+=t):0===e?i=V(o._cachedRect)-n:2===e&&(i+=r);var s=V(o._cachedRect);return 1!==e&&(s=y(r)+n),{y:i,h:s}},_attachMouseWheelEvent:function(t){var e=this._comment._sheet;if(t){var n=void 0;switch(t){case this._floatBlockCanvas:n=".floatBlockCanvas";break;case this._hostContainer:n=".hostContainer";break;case this._lineCanvasContainer:n=".lineCanvasContainer";break;case this._host:n=".host";break;case this._editor:n=".editor"}if(n){C(t).unbind("mousewheel"+n).unbind("DOMMouseScroll"+n);var o=function(t){e._mouseWheelDelegate(t),Object(s.f)(t)};C(t).bind("mousewheel"+n,o).bind("DOMMouseScroll"+n,o)}}},_attachEventHandler:function(t,e){var n=this,o=n._comment,r=o&&o&&o._sheet;n._detachEventHandler(t,e);var i=function(t){r&&r._mouseWheelDelegate(t)};C(t).bind("mousedown"+e,function(t){n._doMouseDownToDragOrResize(t)}).bind("mousemove"+e,function(t){n._doMouseMove(t)}).bind("mouseup"+e,function(t){n._doMouseUp(t)}).bind("mousewheel"+e,i).bind("DOMMouseScroll"+e,i)},_detachEventHandler:function(t,e){C(t).unbind(e)},_attachLineCanvasEventHandler:function(){var t=this,e=t._comment,n=e&&e._sheet,o=t._commentManager;if(t._detachLineCanvasEventHandler(),n){var r=n._getCanvasOffset(),i=function(t){n._mouseWheelDelegate(t)};C(t._lineCanvas).bind("mousedown.lineCanvas",function(e){var i=n.comments.hitTest(e.pageX-r.left,e.pageY-r.top);if(i){var s=i.comment,a=o._getCommentView(s);"comment_editor"===i.area?a._doMouseDownToEdit(e):"comment_indicator"===i.area&&a._doMouseDownToDragOrResize(e),C(a._floatBlockCanvasContainer).css("z-index",parseInt(C(t._lineCanvasContainer).css("z-index")+1))}else n._mouseDownDelegate(e)}).bind("mousemove.lineCanvas",function(e){var i=n.comments.hitTest(e.pageX-r.left,e.pageY-r.top),s=t._lineCanvas.style;if(i){var a=i.comment;o._getCommentView(a)._doMouseMove(e),"comment_editor"===i.area?s.cursor="text":"comment_indicator"===i.area&&(s.cursor="move")}else{n._mouseMoveDelegate(e),t._commentManager._hoverShow(f);var c=n._getCanvas();c&&(s.cursor=c.style.cursor)}}).bind("mouseup.lineCanvas",function(t){var e=n.comments.hitTest(t.pageX-r.left,t.pageY-r.top);if(e){var i=e.comment;o._getCommentView(i)._doMouseUp(t)}else n._mouseUpDelegate(t)}).bind("dblclick.lineCanvas",function(t){n._dblClickDelegate(t)}).bind("mousewheel.lineCanvas",i).bind("DOMMouseScroll.lineCanvas",i)}},_detachLineCanvasEventHandler:function(){C(this._lineCanvas).unbind(".lineCanvas")},_attachHostEventHandler:function(){var t=this,e=t._comment,n=e&&e._sheet;if(2!==e.commentState()&&t._host){t._detachHostEventHandler();var o=function(t){n&&n._mouseWheelDelegate(t)};C(t._host).bind("mousedown.host",function(e){t._doMouseDownToEdit(e)}).bind("mousemove.host",function(e){t._doMouseMove(e)}).bind("mouseup.host",function(e){t._doMouseUp(e)}).bind("mousewheel.host",o).bind("DOMMouseScroll.host",o)}},_detachHostEventHandler:function(){2!==this._comment.commentState()&&this._host&&C(this._host).unbind(".host")},_attachEditorEventHandler:function(){var t=this,e=t._comment,n=e&&e._sheet,o=t._editor;if(2===e.commentState()&&o){this._detachEditorEventHandler();var r=function(t){n&&n._mouseWheelDelegate(t)};C(o).bind("mousedown.editor",function(t){t.stopPropagation()}).bind("mousemove.editor",function(t){t.stopPropagation()}).bind("mouseup.editor",function(t){t.stopPropagation()}).bind("mousewheel.editor",r).bind("DOMMouseScroll.editor",r).bind("input.editor",function(){e.autoSize()&&t._doAutosize()}).bind("keydown.editor",function(t){27!==t.keyCode&&9!==t.keyCode||(e.commentState(1),Object(s.f)(t),u._setActiveElement(n))})}},_doAutosize:function(){var t,e,n=this._comment,o=n&&n._sheet;2===n.commentState()?e=(t=this._editor).value.split("\n"):(t=this._host,e=L._unescapeHtml(t.innerHTML).split("\n"));var r,i,a=C(t).height(),c=C(t).width(),u=0,l=t.style,h="";l.font?(u=Object(s.c)(l.font),h+=l.font):(n.fontStyle()&&(h+=" "+n.fontStyle()),n.fontWeight()&&(h+=" "+n.fontWeight()),n.fontSize()&&(h+=" "+n.fontSize()),n.fontFamily()&&(h+=" "+n.fontFamily()),u=Object(s.c)(h));var m=u;if(e&&e.length>0){r=p(e.length*u,m);for(var d=0,f=0;f<e.length;f++){var _=o._getStringWidth(e[f],h);d<_&&(d=_)}i=p(d,5)}else r=m,i=5;C(t).css(T,r).css(I,i),2===n.commentState()&&n.text(t.value),this._isAutosizing=!0;var v=r-a;0!==v&&n.height(n.height()+v);var g=i-c;0!==g&&n.width(n.width()+g),this._isAutosizing=!1},_detachEditorEventHandler:function(){var t=this._comment,e=this._editor;2===t.commentState()&&e&&C(e).unbind(".editor")},_handleDocumentMouseMove:function(){var t=this,e=t._commentManager._mouseCapture;e._capture||(C(M).bind("mousemove.commentDocument",function(e){t._doMouseMove(e)}).bind("mouseup.commentDocument",function(e){t._doMouseUp(e)}),e._capture=!0)},_unhandleDocumentMouseMove:function(){var t=this._commentManager._mouseCapture;t._capture&&(t._capture=!1,C(M).unbind(".commentDocument"))}},t}(),$=function(){function t(t){this._sheet=t,this._mouseCapture={_capture:!1,x:0,y:0,_cachedRect:f,_resizeDirct:-1},this._editorDom=f,this._hoverShowComment=f,this._activeComment=f,this._commentList=[],this._commentViewList=[],this._allComments=[],this._createEditDom(),this._bindEventsOnSheet()}return t.prototype={constructor:t,add:function(t,e,n,o,r){var i=this._sheet,s=i.getSpan(t,e);if(s&&(s.row!==t||s.col!==e))return f;var a=this.get(t,e),c="string"==typeof n?new G(n,o,r):n;return this._addInternal(t,e,c,!0),i._raiseCellChanged("comment",t,e,3,a,c),c},_addInternal:function(t,e,n,o){var r=this._sheet,i=this._commentList;(this._removeInternal(t,e),n)&&(n._rowIndex=t,n._colIndex=e,n._sheet=r,o||i.forEach(function(t){t.zIndex(t.zIndex()-1)}),i.push(n),r._getModel().setValueForKey(t,e,"comment",n),r._invalidate())},get:function(t,e){return this._sheet._getModel().getValueForKey(t,e,"comment")||null},remove:function(t,e){var n=this._removeInternal(t,e),o=this._sheet;n&&(o._raiseCellChanged("comment",t,e,3,n,void 0),o._invalidate())},_removeInternal:function(t,e){var n=this._sheet,o=this.get(t,e);o&&(this._hide(o),b._remove(this._commentList,o),b._remove(this._commentViewList,this._getCommentView(o)),n._getModel().setValueForKey(t,e,"comment",void 0));return o},clear:function(t){var e=this._sheet,n=this._commentList;e.suspendPaint();for(var o=n.length-1;o>=0;o--){var r=n[o],i=r._rowIndex,s=r._colIndex;(!t||i>=t.row&&i<t.row+t.rowCount&&s>=t.col&&s<t.col+t.colCount)&&this.remove(i,s)}e.resumePaint()},all:function(){return this._commentList.concat()},getOuterContainer:function(t){var e=this._getCommentView(t);return e?e._floatBlockCanvasContainer:f},_createEditDom:function(){var t=document.createElement("textArea");C(t).addClass("sm-comment-editor").css(A,0).css(k,0).css("position","absolute").css("margin",0).css("padding",0).css("word-wrap","break-word").css("word-break","normal").css("overflow","hidden").css("resize","none").css("outline","none").css("border","0px").css("box-sizing","content-box").css("line-height","normal").attr("autocomplete","off").attr("smAttr","smEditingInput"),this._editorDom=t},_bindEventsOnSheet:function(){var t=this,e=t._sheet;e&&(e._bind(R.ColumnChanged,function(e,n){var o=n.propertyName;o!==I&&"isVisible"!==o||t._updateCommentsLayoutWhenRowColumnChanged()}),e._bind(R.RowChanged,function(e,n){var o=n.propertyName;o!==T&&"isVisible"!==o||t._updateCommentsLayoutWhenRowColumnChanged()}),e._bind(R.ColumnWidthChanged,function(){t._updateCommentsLayoutWhenRowColumnChanged()}),e._bind(R.RowHeightChanged,function(){t._updateCommentsLayoutWhenRowColumnChanged()}),e._bind(R.CommentChanged,function(e,n){if(n){var o=n.propertyName,r=n.comment,i=t._getCommentView(r);if(i){"location"===o?i._updateLayoutWhenLocationChanged():o===I||o===T?i._updateLayoutWhenWidthHeightChanged():["autoSize","text","fontFamily","fontStyle","fontSize","fontWeight","padding"].indexOf(o)>=0&&r.autoSize()&&!i._isAutosizing&&i._doAutosize()}}}))},_getCommentView:function(t){var e=this._commentViewList;if(t)for(var n=0;n<e.length;n++){var o=e[n];if(o._comment===t)return o}return f},_isEmpty:function(){return 0===this._commentList.length},_getTopCommentZIndex:function(){var t=this._commentList;if(t.length>0){for(var e=t[0].zIndex(),n=1;n<t.length;n++){var o=t[n];e<o.zIndex()&&(e=o.zIndex())}return e}return 0},_onRowsAdded:function(t,e){for(var n=this._commentList,o=this._commentViewList,r=0;r<n.length;r++){var i=n[r];t<=i._rowIndex&&(i._rowIndex+=e)}for(var s=0;s<o.length;s++){var a=o[s];a._isOpened()&&a._onRowsAdded(t,e)}},_onColumnsAdded:function(t,e){for(var n=this._commentList,o=this._commentViewList,r=0;r<n.length;r++){var i=n[r];t<=i._colIndex&&(i._colIndex+=e)}for(var s=0;s<o.length;s++){var a=o[s];a._isOpened()&&a._onColumnsAdded(t,e)}},_onRowsRemoved:function(t,e){var n,o,r=this._commentList,i=this._commentViewList;for(n=r.length-1;n>=0;n--){var s=(o=r[n])._rowIndex,a=o._colIndex;s>=t&&s<t+e&&this.remove(s,a)}for(n=0;n<r.length;n++)t<(o=r[n])._rowIndex&&(o._rowIndex-=e);for(n=0;n<i.length;n++){var c=i[n];c._isOpened()&&c._onRowsRemoved(t,e)}},_onColumnsRemoved:function(t,e){var n,o,r=this._commentList,i=this._commentViewList;for(n=r.length-1;n>=0;n--){var s=(o=r[n])._rowIndex,a=o._colIndex;a>=t&&a<t+e&&this.remove(s,a)}for(n=0;n<r.length;n++)t<(o=r[n])._colIndex&&(o._colIndex-=e);for(n=0;n<i.length;n++){var c=i[n];c._isOpened()&&c._onColumnsRemoved(t,e)}},_getActiveComment:function(){return this._activeComment},_setActiveComment:function(t){t&&t!==this._activeComment&&(this._clearActiveComment(),this._activeComment=t)},_clearActiveComment:function(){var t=this._activeComment;if(t){var e=this._getCommentView(t);!e||e._isMoving||e._isResizing||(e._isEditing()&&e._detachEditor(),t.commentState(3),this._activeComment=f)}},_show:function(){},_hoverShow:function(t){var e=this,n=e._activeComment;if(n)if(1===n.displayMode()){if(2===n.commentState())return}else if(2===n.commentState()||1===n.commentState())return;t!==e._hoverShowComment&&(e._hoverShowComment&&e._hide(e._hoverShowComment),t&&2===t.displayMode()?e._mouseCapture._capture||t._timeout||(e._hoverShowComment=t,t._timeout=setTimeout(function(){e._show(t)},200)):e._hoverShowComment=f)},_hide:function(t){var e=this._getCommentView(t);e&&e._isOpened()&&(e._close(),t===this._activeComment&&this._sheet._loadAndSetSheetSelections()),clearTimeout(t._timeout),delete t._timeout},_showCommentLayoutPanel:function(){C(this._sheet._commentRender()._commentLayoutPanel).show()},_hideCommentLayoutPanel:function(){C(this._sheet._commentRender()._commentLayoutPanel).hide()},_isHitComment:function(t,e,n){var o=this._getCommentView(t);if(o){var r=o._getCommentRect();if(r)return r.contains(e,n)}return!1},_isHitCommentEditor:function(t,e,n){var o=this._getCommentView(t);if(o){var r=o._getCommentEditorRect();if(r)return r.contains(e,n)}return!1},hitTest:function(t,e){for(var n=f,o=0;o<this._commentList.length;o++){var r=this._commentList[o];0,this._isHitComment(r,t,e)&&(n?r.zIndex()>n.zIndex()&&(n=r):n=r)}return n?{x:t,y:e,comment:n,area:this._isHitCommentEditor(n,t,e)?"comment_editor":"comment_indicator"}:f},_getCommentActualZIndex:function(t){var e=this._getTopCommentZIndex();return t===this._hoverShowComment?e+2:t===this._activeComment?e+1:t.zIndex()},_updateCommentsLayoutWhenRowColumnChanged:function(){this._commentViewList.forEach(function(t){t._updateLayoutWhenRowColumnChanged()})},_updateCommentsLayoutWhenSheetScroll:function(){this._commentViewList.forEach(function(t){t._updateAbsoluteLocationAndLayout()})},fromJSON:function(t,e){if(t&&0!==t.length)for(var n=0;n<t.length;n++){var o=t[n],r=new G;r.fromJSON(o,e),3!==r.commentState()&&(this._activeComment=r),this._sheet.comments._addInternal(r._rowIndex,r._colIndex,r,!0)}},toJSON:function(){var t=this._commentList;if(t&&0!==t.length){for(var e={sheetComments:[],commentList:this._allComments},n=0;n<t.length;n++)e.sheetComments.push(t[n].toJSON());if(0!==e.sheetComments.length)return e}}},t}(),tt=function(){function t(t){this._sheet=f,this._showWhenTouchMoveOrScroll=!0,this._commentLayoutPanel=this._createCommentLayoutPanel(),t.appendChild(this._commentLayoutPanel)}return t.prototype={constructor:t,_createCommentLayoutPanel:function(){var t=document.createElement("div");return C(t).addClass("sm-comment-layoutPanel sm-sheet-no-select").css(["position",A,k,T,I,"overflow","z-index","unselectable"],["absolute",0,0,0,0,"visible",701,"on"]),t},_renderCommentFloatPanel:function(t){if(!t.comments._isEmpty()){var e=t._getSheetLayout();if(C(this._commentLayoutPanel).css(A,e.x+e._rowHeaderWidth).css(k,e.y+e._colHeaderHeight),this._sheet!==t){var n;if(this._sheet&&(n=this._sheet.comments)){var o=n._getActiveComment();o&&2===o.commentState()&&o.commentState(1)}this._sheet=t}}},_renderCommentCellAdorner:function(t,e,n){var o=n.row,r=n.col,i=n.x,s=n.y,a=B(n),c=V(n);if(3===e&&this._sheet&&this._sheet.options.commentFeature&&this._sheet.isRangeReadable(o,r,1,1)){var u=this._sheet.comments.get(o,r),l=this._sheet.options.commentColor||"red";if(u&&u.renderBorder()){var h=this._sheet.options.commentAngleSize||8;t&&a>0&&c>0&&(t.save(),t.rect(i,s,a,c),t.clip(),t.fillStyle=l,t.beginPath(),t.moveTo(i+a-h,s),t.lineTo(i+a,s),t.lineTo(i+a,s+h),t.lineTo(i+a-h,s),t.fill(),t.restore(),t.save(),t.lineWidth=2,t.strokeStyle=l,t.strokeRect(i,s,a-1,c-1),t.restore())}else{var m=this._sheet.comments.get(o,r-1),d=this._sheet.comments.get(o,r+1),f=this._sheet.comments.get(o-1,r),p=this._sheet.comments.get(o+1,r),_=this._sheet.comments.get(o,r);[[m,i,s,i,s+c-1],[d,i+a-1,s,i+a-1,s+c-1],[f,i,s,i+a-1,s],[p,i,s+c-1,i+a-1,s+c-1]].forEach(function(e){var n=e[0],o=e[1],r=e[2],i=e[3],s=e[4];n&&n.renderBorder()&&_&&(t.save(),t.beginPath(),t.lineWidth=2,t.strokeStyle=l,t.moveTo(o,r),t.lineTo(i,s),t.stroke(),t.restore())})}}},_renderComment:function(t){if(this._showWhenTouchMoveOrScroll){t._showCommentLayoutPanel();for(var e=this._sheet,n=t.all(),o=0;o<n.length;o++){var r=n[o],i=t._getCommentView(r);this._canShowComment(t,r)?(1===r.displayMode()&&r===t._hoverShowComment&&(t._hoverShowComment=f),i&&i._isOpened()?i._updateLayout():t._show(r)):i&&i._isOpened()&&t._hide(r)}var s=t._getActiveComment();if(s){var a=t._getCommentView(s);a&&a._isOpened()&&e.getSelections().length>0&&e._selectionModel.clear()}}else t._hideCommentLayoutPanel()},_canShowComment:function(t,e){var n=t._sheet;if(n&&q(n,e._colIndex)&&Y(n,e._rowIndex))switch(e.displayMode()){case 1:return!0;case 2:if(3!==e.commentState())return t&&e!==t._hoverShowComment&&(t._hoverShowComment=e),!0;if(e===t._hoverShowComment)return!0}return!1}},t}(),et={active:1,edit:2,normal:3},nt={alwaysShown:1,hoverShown:2},ot=K,rt=G,it=J},function(t,e,n){"use strict";function o(t){console.log("Exception from GC =>"),console.warn(t)}e.h=o,e.f=function(t){t.preventDefault?(t.preventDefault(),t.stopPropagation()):(t.cancelBubble=!1,t.returnValue=!1);return!1},n.d(e,"e",function(){return r}),e.a=function(t,e,n,o){var r=t,i=e;function s(t,e){this.hasOwnProperty("_ps")||(this._ps={});var s=this._ps;if(0===arguments.length)return void 0!==s[r]?s[r]:i;if(!1===e||!o||o.call(this,t)){var a=void 0!==s[r]?s[r]:i;a!==t&&(s[r]=t,!1!==e&&n&&n.call(this,t,a))}return this}return s.isDefault=function(t){return t===i},s},e.b=function(t,e,n,o,r){for(var i=Math.min(e,n),s=Math.max(e,n),a=0,c=i;c<s&&(a+=o?t._getZoomRowHeight(c,3):t._getZoomColumnWidth(c,3),!(r&&a>r));c++);return a},e.c=function(t,e){var n=i._fontHeightCache;if(!e)if(n){var o=n[t];if(o)return o}else n=i._fontHeightCache={};var r=function(){if(!i._editingSpan){var t=document.createElement("span"),e=t.style;e.visibility="hidden",e.top="-10000px",e.left="-10000px",e.position="absolute",t.setAttribute("gcUIElement","gcStringWidthSpan"),document.body.insertBefore(t,null),i._editingSpan=t}return i._editingSpan}();r.style.font=t,r.innerHTML="H";var s=r.offsetHeight;e||(n[t]=s);return s},e.d=function(t,e,n){var o=function(t){var e=t._matrix||{scaleX:1,scaleY:1,translateX:0,translateY:0,skewX:0,skewY:0,orgTranslateX:0,orgTranslateY:0};return t._matrix=e,e}(t);o.orgTranslateX+=e,o.orgTranslateY+=n,o.translateX=o.orgTranslateX*o.scaleX,o.translateY=o.orgTranslateY*o.scaleY,t.setTransform(o.scaleX,o.skewX,o.skewY,o.scaleY,o.translateX,o.translateY)},e.g=function(t,e){for(var n=0;n<t.length;n++)if(t[n].name===e)return t[n]};var r=function(){var t=navigator.userAgent,e=function(t){t=t.toLowerCase();var e=/(chrome)[ \/]([\w.]+)/.exec(t)||/(webkit)[ \/]([\w.]+)/.exec(t)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(t)||/(msie) ([\w.]+)/.exec(t)||t.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(t)||[];return{browser:e[1]||"",version:e[2]||"0"}}(t),n={};e.browser&&(n[e.browser]=!0,n.version=e.version),n.chrome?n.webkit=!0:n.webkit&&(n.safari=!0),t.indexOf("PhantomJS")>=0&&(n.safari=!1,n.chrome=!0);var r=t.toLowerCase();r.indexOf("compatible")<0&&null!==/(trident)(?:.*? rv ([\w.]+)|)/.exec(r)&&(n.mozilla=void 0,n.msie=!0);var i=/Edge\/\d+/.exec(t);return null!==i&&i.length>0&&(n.webkit=void 0,n.chrome=void 0,n.msie=!0,n.edge=!0,n.version=i[0].substr(i[0].indexOf("/")+1)),n.msie&&function(){var t=null,e=!1;try{new ActiveXObject("")}catch(e){o(e),t=e.name}try{e=!!new ActiveXObject("htmlfile")}catch(t){o(t),e=!1}return!(e="ReferenceError"===t||!1!==e)}()&&(n.metroMode=!0),t.indexOf("QQBrowser")>-1&&(n.QQBrowser=!0),n}();var i={}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.install=function(t,e){var n=o.a._getFeatureManager("Workbook")._features,r=o.a._getFeatureManager("Worksheet")._features,i=Object(s.g)(n,"comments"),a=Object(s.g)(r,"comments"),c=t.getActiveSheet(),l=u(t._vp);i.init.call(t),e.map(function(t){a.init.call(t)}),a.setHost.call(c,l),h("Comment")};var o=n(0),r=(n(4),n(6),n(1));n.d(e,"CommentState",function(){return r.CommentState}),n.d(e,"DisplayMode",function(){return r.DisplayMode}),n.d(e,"Padding",function(){return r.Padding}),n.d(e,"Comment",function(){return r.Comment}),n.d(e,"_CommentView",function(){return r._CommentView});var i,s=n(2),a=o.a._getFeatureManager,c=o.a.HookNames,u=o.a.GC$,l=a("Worksheet"),h=o.a.activateFeatures;l.register("comments",((i={})[c.Worksheet.swapNode]=function(t){var e=t.from,n=t.to,o=e.node&&e.node.comment,r=n.node&&n.node.comment;(o||r)&&(r&&(r._rowIndex=e.row,r._colIndex=e.col),o&&(o._rowIndex=n.row,o._colIndex=e.col))},i))},function(t,e,n){"use strict";var o,r=n(0),i=n(1),s=r.a.Commands,a=r.a.Point,c=s._prepareCommands,u=r.a.GC$,l=r.a.Events,h=s.ActionBase,m="changeComment",d=s._executeCommand;function f(t,e,n){var o=t.comments._getActiveComment();if(o){var r=o.location();return t._commandManager().execute({cmd:m,sheetName:t.name(),comment:o,oldValue:r.clone(),newValue:new a(r.x+e,r.y+n),propertyName:"location"})}return!1}var p=c(((o={}).deleteCommentByKey={canUndo:!1,execute:function(t,e){var n=s._getWorksheet(t,e),o=n.comments._getActiveComment();return!!o&&n._commandManager().execute({cmd:"deleteComment",sheetName:n.name(),comment:o})},registerArgs:[46,!1,!1,!1,!1]},o.deactivateComment={canUndo:!1,execute:function(t,e){var n=s._getWorksheet(t,e),o=n.comments;return!!o._getActiveComment()&&(o._clearActiveComment(),n._loadAndSetSheetSelections(),n.repaint(),!0)},registerArgs:[27,!1,!1,!1,!1]},o.moveCommentUp={canUndo:!1,execute:function(t,e){return f(s._getWorksheet(t,e),0,-1)},registerArgs:[38,!1,!1,!1,!1]},o.moveCommentDown={canUndo:!1,execute:function(t,e){return f(s._getWorksheet(t,e),0,1)},registerArgs:[40,!1,!1,!1,!1]},o.moveCommentLeft={canUndo:!1,execute:function(t,e){return f(s._getWorksheet(t,e),-1,0)},registerArgs:[37,!1,!1,!1,!1]},o.moveCommentRight={canUndo:!1,execute:function(t,e){return f(s._getWorksheet(t,e),1,0)},registerArgs:[39,!1,!1,!1,!1]},o.deleteComment={canUndo:!0,execute:function(t,e,n){return d(t,v,e,n)}},o[m]={canUndo:!0,execute:function(t,e,n){return d(t,g,e,n)}},o.changeCommentTransaction={canUndo:!0,execute:function(t,e,n){return d(t,C,e,n)}},o)),_=function(t){function e(){t.call(this)}u.inherit(e,t);var n={init:function(t,e){this._sheet=t,this._command=e},canUndo:function(){return!!this._command._savedComment},saveState:function(){this._command._savedComment=this._command.comment},clearState:function(){this._command._savedComment=void 0}};return u.extend(e.prototype,n),e}(h),v=function(t){function e(e,n){t.call(this),this.init(e,n)}u.inherit(e,t);var n={execute:function(){if(this.canExecute()){this.saveState();var t=this._sheet;this._beforeAction(t,!0);var e=this._command.comment,n=t.comments,o={sheet:t,sheetName:t.name(),comment:e,cancel:!1};return t._trigger(l.CommentRemoving,o),o&&!0===o.cancel?this.clearState():(t.comments.remove(e._rowIndex,e._colIndex),n._activeComment=null,t._loadAndSetSheetSelections(),t._trigger(l.CommentRemoved,{sheet:t,sheetName:t.name(),comment:e})),this._afterAction(t,!0),!0}return!1},undo:function(){var t=this._command._savedComment;if(this.canUndo()){var e=this._sheet;return this._beforeAction(e,!0),e.comments._addInternal(t._rowIndex,t._colIndex,t),e._saveAndClearSheetSelections(),this._afterAction(e,!0),!0}return!1}};return u.extend(e.prototype,n),e}(_),g=function(t){function e(e,n){t.call(this),this.init(e,n)}u.inherit(e,t);return u.extend(e.prototype,{execute:function(){var t=this._command,e=t.comment;if(this.canExecute()&&e){this.saveState();var n=this._sheet;return this._beforeAction(n,!0),e[t.propertyName](t.newValue),this._afterAction(n,!0),!0}return!1},undo:function(){var t=this._command;if(this.canUndo()){var e=this._sheet;return this._beforeAction(e,!0),t.comment[t.propertyName](t.oldValue),this._afterAction(e,!0),!0}return!1}}),e}(_);function y(t,e){if(e?t.canUndo():t.canExecute()){var n=t._commentUndoTransaction;if(n){for(var o=0;o<n.length;o++){var r=n[o];r&&(e?r.undo():r.execute())}return!0}}return!1}s.ChangeComment=g;var C=function(t){function e(e,n){t.call(this),this._commentUndoTransaction=[],this._sheet=e,this._command=n;var o=n.commands;if(o)for(var r=0;r<o.length;r++)this.add(o[r])}u.inherit(e,t);var n={execute:function(){return y(this,!1)},undo:function(){return y(this,!0)},add:function(t){this._commentUndoTransaction.push(t)}};return u.extend(e.prototype,n),e}(h);s._initCommentDefaultCommands=function(t){p(t)};var w={CommentDeleteUndoAction:v,CommentPropertyUndoAction:g};u.extend(i,w)},function(t,n,o){"use strict";n.a=e.Spread.Common},function(t,e,n){"use strict";var o=n(0),r=n(2),i=n(1),s=o.a.Exception,a=o.a.Touch,c=s.triggerError;a&&function(){var t=o.a.GC$,e=t.extend,n=a._TouchMouseMessageFilter,s=a._TouchTargetElement;function u(t,e,o){var r=this,i=r._comment=e._comment;r._touchMouseMessageFilter=new n(r),r._touchTarget=new s(t,"Comment"+i._rowIndex+i._colIndex,r._touchMouseMessageFilter,2,200),r._touchEventProvider=o,r._touchEventHandler=new l(t,e);var a=r._touchEventHandler,c=r._touchTarget;c._canDoManipulation=function(){return 3!==r._comment.commentState()},c._canDoTap=function(){return!0},c._manipulationStarting=function(t){return a._doManipulationStarting(t)},c._manipulationStarted=function(t){return a._doManipulationStarted(t)},c._manipulationDelta=function(t){return a._doManipulationDelta(t)},c._manipulationCompleted=function(t){return a._doManipulationCompleted(t)},c._tapped=function(t){return a._doTapped(t)}}function l(t,e){this._containerElement=t,this._commentView=e,this._comment=e._comment,this._sheet=this._comment._sheet,this._touchZoomManager=new a._TouchZoomManager(this._sheet)}function h(t,e,o){var r=this,i=r._comment=e._comment;r._touchMouseMessageFilter=new n(r),r._touchTarget=new s(t,"Comment"+i._rowIndex+i._colIndex,r._touchMouseMessageFilter,2,200),r._touchEventProvider=o,r._touchEventHandler=new m(t,e);var a=r._touchEventHandler,c=r._touchTarget;c._canDoManipulation=function(){return 3!==r._comment.commentState()},c._canDoTap=function(){return!0},c._manipulationStarting=function(t){return a._doManipulationStarting(t)},c._manipulationStarted=function(t){return a._doManipulationStarted(t)},c._manipulationDelta=function(t){return a._doManipulationDelta(t)},c._manipulationCompleted=function(t){return a._doManipulationCompleted(t)},c._tapped=function(t){return a._doTapped(t)}}function m(t,e){l.call(this,t,e)}e(u.prototype,{_attach:function(){var t=this._touchEventProvider;t&&t._attachDettach(this._touchTarget,!0)},_detach:function(){var t=this._touchEventProvider;t&&t._attachDettach(this._touchTarget,!1)},_preProcessMouseDown:function(t){return this._touchMouseMessageFilter._preProcessMouseDown(t)},_preProcessMouseUp:function(t){return this._touchMouseMessageFilter._preProcessMouseUp(t)},_preProcessMouseMove:function(t){return this._touchMouseMessageFilter._preProcessMouseMove(t)}}),e(l.prototype,{_positionToPage:function(e){var n=new a._TouchPoint(e.X,e.Y),o=t(this._containerElement).offset();if(o){var r=document.body;n.X+=o.left+r.clientLeft||0,n.Y+=o.top+r.clientTop||0}return n},_doManipulationStarting:function(t){t._Mode=35},_doManipulationStarted:function(t){var e=this._positionToPage(t._Position);this._commentView._doMouseDownToDragOrResize({target:t._OriginalSource,isTouch:!0,button:0,pageX:e.X,pageY:e.Y,stopPropagation:function(){}}),this._touchZoomManager._startZoom()},_doManipulationDelta:function(e){var n=e._Cumulative._Scale,o=this._sheet,r=o.parent;if(1!==n&&r&&r.options.allowUserZoom){o._eventHandler._isCommentWorking=!1;var i=this._commentView;t(i._moveResizeContainerDom).remove(),this._touchZoomManager._continueZoom(n)}else{var s=this._positionToPage(e._Position);this._commentView._doMouseMove({target:e._OriginalSource,isTouch:!0,button:0,pageX:s.X,pageY:s.Y,stopPropagation:function(){}})}},_doManipulationCompleted:function(t){var e=t._Cumulative._Scale,n=this._sheet.parent;if(1!==e&&n&&n.options.allowuserZoom)this._touchZoomManager._endZoom(e);else{var o=this._positionToPage(t._Position);this._commentView._doMouseUp({target:t._OriginalSource,isTouch:!0,button:0,pageX:o.X,pageY:o.Y,stopPropagation:function(){}})}},_doTapped:function(){var t=this._comment,e=this._sheet;try{e.suspendPaint(),3===t.commentState()?t.commentState(1):1===t.commentState()&&t.commentState(2)}catch(t){Object(r.h)(t),c(t)}finally{e.resumePaint()}}}),e(h.prototype,{_attach:function(){var t=this._touchEventProvider;t&&t._attachDettach(this._touchTarget,!0)},_detach:function(){var t=this._touchEventProvider;t&&t._attachDettach(this._touchTarget,!1)},_preProcessMouseDown:function(t){return this._touchMouseMessageFilter._preProcessMouseDown(t)},_preProcessMouseUp:function(t){return this._touchMouseMessageFilter._preProcessMouseUp(t)},_preProcessMouseMove:function(t){return this._touchMouseMessageFilter._preProcessMouseMove(t)}}),t.inherit(m,l),m.prototype._doManipulationStarted=function(t){var e=this._positionToPage(t._Position);this._commentView._doMouseDownToEdit({target:t._OriginalSource,isTouch:!0,button:0,pageX:e.X,pageY:e.Y,stopPropagation:function(){}}),this._touchZoomManager._startZoom()},i._CommentView._registerFeature("touch",{init:function(t){var e=this._comment._sheet.parent._touchEventProvider;this._touchManager=new u(t[0],this,e),this._touchManager._attach(),this._touchContentManager=new h(t[1],this,e),this._touchContentManager._attach()},detachEditor:function(t){var e=this._comment._sheet;this._touchContentManager=new h(t,this,e.parent._touchEventProvider),this._touchContentManager._attach()},preProcessMouseDownEdit:function(t){var e=t.e,n=this._touchContentManager;n&&!e.isTouch&&n._preProcessMouseDown(e)&&(Object(r.f)(e),t.r=!0)},preProcessMouseDownDragResize:function(t){var e=t.e,n=this._touchManager;n&&!e.isTouch&&n._preProcessMouseDown(e)&&(Object(r.f)(e),t.r=!0)},preProcessMouseMove:function(t){var e=t.e,n=e.isTouch,o=this._touchManager,i=this._touchContentManager;o&&!n&&o._preProcessMouseMove(e)&&(Object(r.f)(e),t.r=!0),i&&!n&&i._preProcessMouseMove(e)&&(Object(r.f)(e),t.r=!0)},preProcessMouseUp:function(t){var e=t.e,n=e.isTouch,o=this._touchManager,i=this._touchContentManager;o&&!n&&o._preProcessMouseUp(e)&&(Object(r.f)(e),t.r=!0),i&&!n&&i._preProcessMouseUp(e)&&(Object(r.f)(e),t.r=!0)}})}()}])}},function(t,e,n){"use strict";var o=n(1040),r=n.n(o);e.a={"en-US":r.a}},function(t,e){t.exports={"开始":"Start","新增":"Add","删除":"Delete","关闭":"Close","离线状态无法%s评论":"Can't %s comment when offline","这是一条评论":"This is a comment","路人":"Passerby","不能对图片进行评论":"Can't comment on image","开始评论失败，请稍后重试":"Comment failed. Try again later.","删除评论":"Delete comment","确认要永久删除该评论吗？":"Delete the comment permanently?","新增评论失败，请稍后重试":"Adding new comment failed. Try again later","结束讨论":"Resolve discussion","结束讨论后该讨论将被彻底删除，确定结束吗？":"Resolve discussion will delete all the comments completely, resolve anyway?","删除评论失败，请稍后重试":"Deleting comment failed, Try again later","按enter发送，shift+enter换行":"Press Enter to send, Shift+Enter to wrap","取消":"Cancel","确定":"Confirm","在此@同伴或者文档":"@ a person or a document here","刚刚":"just now","%s分钟前":"%s mins ago","今天":"today","今天 %s":"today %s","昨天":"yesterday","昨天 %s":"yesterday %s","评论":"Comment","添加评论":"Add comment"}},function(t,e,n){"use strict";var o,r=n(2),i=n.n(r),s=n(0),a=n.n(s),c=n(1),u=(n.n(c),n(209)),l=n(38),h=c.sheets.shortcutKey.getTip,m=function(t){return!t.editor.spread||!t.permission.hasSelections||!t.editor.permissions.query.canCommentRange({sheetId:t.editor.spread.getActiveSheet().id,range:t.selection.selectedCell})};function d(t){return a.a.createElement(l.j,{disabled:m(t)},a.a.createElement(l.b,{icon:"comment",selected:t.selection.commentSelected,onTap:o.startComment},a.a.createElement(l.k,{option:i()("添加评论"),detail:h("comment")})))}function f(t){return a.a.createElement(l.e,{icon:"comment",text:i()("评论"),disabled:m(t),onTap:o.startComment})}function p(t){return a.a.createElement(l.i,{disabled:m(t)},a.a.createElement(l.b,{icon:"comment",selected:t.selection.commentSelected,onTap:o.startComment},a.a.createElement(l.k,{option:i()("添加评论"),detail:h("comment")})),a.a.createElement("br",null),a.a.createElement("span",null,i()("评论")))}e.a=function(t){var e;return o=t,{singleTool:d,doubleTool:p,tabList:(e={},e[u.a.insert]=f,e)}}}])});
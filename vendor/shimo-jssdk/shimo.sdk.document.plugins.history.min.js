!function(t,e){if("object"==typeof exports&&"object"==typeof module)module.exports=e(require("lodash"),require("react"),require("prop-types"),require("react-dom"),require("axios"));else if("function"==typeof define&&define.amd)define(["lodash","react","prop-types","react-dom","axios"],e);else{var i="object"==typeof exports?e(require("lodash"),require("react"),require("prop-types"),require("react-dom"),require("axios")):e(t.shimo.sdk.common._,t.shimo.sdk.common.React,t.shimo.sdk.common.PropTypes,t.shimo.sdk.common.ReactDOM,t.shimo.sdk.common.Axios);for(var n in i)("object"==typeof exports?exports:t)[n]=i[n]}}(window,function(t,e,i,n,r){return function(t){function e(e){for(var n,a,s=e[0],l=e[1],d=e[2],c=0,p=[];c<s.length;c++)a=s[c],r[a]&&p.push(r[a][0]),r[a]=0;for(n in l)Object.prototype.hasOwnProperty.call(l,n)&&(t[n]=l[n]);for(h&&h(e);p.length;)p.shift()();return o.push.apply(o,d||[]),i()}function i(){for(var t,e=0;e<o.length;e++){for(var i=o[e],n=!0,s=1;s<i.length;s++){var l=i[s];0!==r[l]&&(n=!1)}n&&(o.splice(e--,1),t=a(a.s=i[0]))}return t}var n={},r={6:0},o=[];function a(e){if(n[e])return n[e].exports;var i=n[e]={i:e,l:!1,exports:{}};return t[e].call(i.exports,i,i.exports,a),i.l=!0,i.exports}a.m=t,a.c=n,a.d=function(t,e,i){a.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},a.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},a.t=function(t,e){if(1&e&&(t=a(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(a.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)a.d(i,n,function(e){return t[e]}.bind(null,n));return i},a.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return a.d(e,"a",e),e},a.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},a.p="";var s=window.shimoWebpackJsonp=window.shimoWebpackJsonp||[],l=s.push.bind(s);s.push=e,s=s.slice();for(var d=0;d<s.length;d++)e(s[d]);var h=l;return o.push([1610,0]),i()}({10:function(t,e){t.exports=i},12:function(t,e){t.exports=n},1610:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n,r=(n=i(1611))&&n.__esModule?n:{default:n};(0,i(77).setScope)("document.plugins.History",r.default);var o=r.default;e.default=o,t.exports=e.default},1611:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"HistoryComponent",{enumerable:!0,get:function(){return c.default}}),e.default=void 0;var n=i(0),r=y(i(5));i(1612);var o=i(43),a=i(13),s=i(2),l=function(t){if(t&&t.__esModule)return t;if(null===t||"object"!=typeof t&&"function"!=typeof t)return{default:t};var e=u();if(e&&e.has(t))return e.get(t);var i={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var r in t)if(Object.prototype.hasOwnProperty.call(t,r)){var o=n?Object.getOwnPropertyDescriptor(t,r):null;o&&(o.get||o.set)?Object.defineProperty(i,r,o):i[r]=t[r]}i.default=t,e&&e.set(t,i);return i}(i(4)),d=i(12),h=i(1614),c=y(i(1615)),p=i(566);function u(){if("function"!=typeof WeakMap)return null;var t=new WeakMap;return u=function(){return t},t}function y(t){return t&&t.__esModule?t:{default:t}}var f={permission:"editable"},m=function(t){function e(e){var i=t.call(this,e)||this;return i.clearUndoRedo=function(){i.editor.history.clear()},i.hide=i.hide.bind(i),i.options=(0,s.assign)({},f,e),i.editor=e.editor,i.guid=e.guid,(0,p.setAPI)(e.service,e.guid),i}return(0,n.__extends)(e,t),Object.defineProperty(e.prototype,"isShow",{get:function(){return"block"===getComputedStyle(this.root).display},enumerable:!1,configurable:!0}),e.prototype.show=function(){this.update(),this.root&&(this.root.style.display="block")},e.prototype.hide=function(){this.root&&(this.root.style.display="none")},e.prototype.toggle=function(){this.isShow?this.hide():this.show()},e.prototype.update=function(){this.history&&this.history.getHistories()},e.prototype.destroy=function(){this.root&&(this.root.innerHTML="")},e.prototype.getComponent=function(){var t=this;return l.createElement(c.default,{editor:this.editor,guid:this.guid,height:this.options.height,permission:this.options.permission,clearUndoRedo:this.clearUndoRedo,ref:function(e){return t.history=e},preventInit:!!this.root})},e.prototype.render=function(t){var e=this.getComponent();t?this.root=t:(this.root=this.editor.addContainer("ql-sidebar-history"),e=l.createElement(a.Sidebar,{name:(0,r.default)("历史"),editor:this.editor,hide:this.hide},this.getComponent())),(0,d.render)(e,this.root)},e.version=h.version,e}(o.Plugin);e.default=m},1612:function(t,e,i){var n=i(1613);"string"==typeof n&&(n=[[t.i,n,""]]);var r={hmr:!0,transform:void 0,insertInto:void 0};i(27)(n,r);n.locals&&(t.exports=n.locals)},1613:function(t,e,i){(t.exports=i(21)(!1)).push([t.i,"@charset \"UTF-8\";\n.doc-history {\n  width: 100%;\n  height: 100%; }\n  .doc-history .history-list {\n    height: 100%;\n    list-style: none;\n    overflow: auto;\n    max-height: 100vh;\n    padding: 0 20px;\n    margin: 0; }\n  .doc-history .history-item {\n    transition: background 0.2s ease-in;\n    width: 100%;\n    border-top: 1px solid transparent;\n    border-bottom: 1px solid transparent;\n    padding: 10px 0; }\n    .doc-history .history-item.hide {\n      display: none; }\n    .doc-history .history-item .history-header {\n      position: relative; }\n    .doc-history .history-item .history-content {\n      display: inline-block;\n      font-size: 12px;\n      color: #a5a5a5;\n      line-height: 18px;\n      width: calc(100% - 90px);\n      word-break: break-word; }\n    .doc-history .history-item .history-content-author {\n      color: #a5a5a5;\n      margin-right: 5px;\n      font-weight: 700; }\n    .doc-history .history-item .history-item-time {\n      width: 90px;\n      text-align: right;\n      color: #ccc;\n      font-size: 12px;\n      line-height: 18px;\n      float: right; }\n    .doc-history .history-item .history-info {\n      color: #73a2e3;\n      cursor: pointer;\n      margin-left: 5px; }\n    .doc-history .history-item .history-change {\n      width: 100%;\n      box-sizing: border-box;\n      padding: 5px 15px;\n      background: #fff;\n      border-radius: 3px;\n      border: 1px solid #e4e4e4;\n      margin-bottom: 0;\n      position: relative;\n      display: none; }\n      .doc-history .history-item .history-change.state1 {\n        margin-top: 7px;\n        max-height: 170px;\n        overflow: hidden; }\n        .doc-history .history-item .history-change.state1::after {\n          content: '';\n          position: absolute;\n          left: 0;\n          bottom: 0;\n          width: 100%;\n          height: 50px;\n          background-image: linear-gradient(rgba(255, 255, 255, 0), #fff);\n          pointer-events: none; }\n        .doc-history .history-item .history-change.state1 .history-revert {\n          display: inline-block; }\n      .doc-history .history-item .history-change.state2 {\n        height: 7px;\n        overflow: hidden;\n        padding: 0 15px;\n        border-top-left-radius: 0;\n        border-top-right-radius: 0;\n        margin-top: -4px; }\n        .doc-history .history-item .history-change.state2 .ql-editor {\n          overflow: hidden; }\n      .doc-history .history-item .history-change:nth-child(1), .doc-history .history-item .history-change:nth-child(2), .doc-history .history-item .history-change:nth-child(3), .doc-history .history-item .history-change:nth-child(4) {\n        display: block; }\n      .doc-history .history-item .history-change:nth-child(1) {\n        z-index: 4; }\n      .doc-history .history-item .history-change:nth-child(2) {\n        z-index: 3; }\n      .doc-history .history-item .history-change:nth-child(3) {\n        z-index: 2; }\n      .doc-history .history-item .history-change:nth-child(4) {\n        z-index: 1; }\n    .doc-history .history-item .history-revert {\n      position: absolute;\n      display: none;\n      top: 5px;\n      right: 10px;\n      background: #fff;\n      cursor: pointer !important;\n      color: #73a2e3;\n      font-size: 12px; }\n      .doc-history .history-item .history-revert svg {\n        width: 12px;\n        height: 12px;\n        float: left;\n        margin-top: 3px;\n        margin-right: 3px; }\n        .doc-history .history-item .history-revert svg path {\n          fill: #73a2e3; }\n        .doc-history .history-item .history-revert svg path[fill='none'] {\n          stroke: #73a2e3; }\n      .doc-history .history-item .history-revert:hover {\n        color: #4681c1; }\n        .doc-history .history-item .history-revert:hover svg path {\n          fill: #4681c1; }\n        .doc-history .history-item .history-revert:hover svg path[fill='none'] {\n          stroke: #4681c1; }\n    .doc-history .history-item.hide .history-info,\n    .doc-history .history-item.single.short .history-info {\n      display: none; }\n    .doc-history .history-item.expand .history-change {\n      border: 1px solid #ddd;\n      box-shadow: unset;\n      background: transparent;\n      height: auto;\n      overflow: hidden;\n      margin-bottom: 7px;\n      display: block; }\n      .doc-history .history-item.expand .history-change.state1 {\n        max-height: inherit; }\n      .doc-history .history-item.expand .history-change.state2 {\n        border-radius: 4px; }\n      .doc-history .history-item.expand .history-change:last-child {\n        margin-bottom: 0; }\n    .doc-history .history-item .ql-container {\n      padding-top: 0;\n      border: none;\n      box-shadow: none;\n      background: inherit; }\n    .doc-history .history-item p,\n    .doc-history .history-item h1,\n    .doc-history .history-item h2,\n    .doc-history .history-item h3,\n    .doc-history .history-item h4,\n    .doc-history .history-item h5,\n    .doc-history .history-item h6,\n    .doc-history .history-item ol,\n    .doc-history .history-item ul,\n    .doc-history .history-item video,\n    .doc-history .history-item iframe,\n    .doc-history .history-item blockquote {\n      padding: 0; }\n    .doc-history .history-item .ql-mention,\n    .doc-history .history-item .ql-link {\n      color: #70b1e7 !important;\n      text-decoration: none !important; }\n    .doc-history .history-item .ql-blot-attachment {\n      padding: 0;\n      margin: 0; }\n      .doc-history .history-item .ql-blot-attachment .ql-attachment-wrapper {\n        margin: 0;\n        width: 100%;\n        height: 24px;\n        border: 0;\n        background: inherit; }\n        .doc-history .history-item .ql-blot-attachment .ql-attachment-wrapper .ql-attachment-title-icon,\n        .doc-history .history-item .ql-blot-attachment .ql-attachment-wrapper .ql-attachment-file-url {\n          display: none; }\n        .doc-history .history-item .ql-blot-attachment .ql-attachment-wrapper .ql-attachment-file-info {\n          width: 100%;\n          height: 24px;\n          margin: 0; }\n          .doc-history .history-item .ql-blot-attachment .ql-attachment-wrapper .ql-attachment-file-info .ql-attachment-file-name {\n            text-align: center; }\n          .doc-history .history-item .ql-blot-attachment .ql-attachment-wrapper .ql-attachment-file-info span.ql-attachment-file-size {\n            display: none; }\n        .doc-history .history-item .ql-blot-attachment .ql-attachment-wrapper:hover .ql-attachment-file-url {\n          display: none; }\n        .doc-history .history-item .ql-blot-attachment .ql-attachment-wrapper:hover .ql-attachment-file-info {\n          border-right: 0; }\n    .doc-history .history-item .ql-divide {\n      padding-left: 0;\n      padding-right: 0; }\n    .doc-history .history-item .ql-table {\n      padding: 0 0 5px 0; }\n    .doc-history .history-item .ql-syntax {\n      margin: 0; }\n    .doc-history .history-item .ql-table-scroll {\n      overflow: auto; }\n    .doc-history .history-item .ql-table-raw td {\n      width: 95px; }\n    .doc-history .history-item .ql-location {\n      padding-left: 0;\n      padding-right: 0; }\n      .doc-history .history-item .ql-location .ql-location-map {\n        height: auto; }\n      .doc-history .history-item .ql-location .ql-location-actions {\n        display: none; }\n    .doc-history .history-item .ql-editor {\n      overflow: auto;\n      padding: 12px 0;\n      min-height: initial; }\n      .doc-history .history-item .ql-editor p.ql-history-code-true {\n        background: #f7f7f7;\n        border: 1px solid rgba(208, 212, 217, 0.5);\n        padding: 4px 8px 0 8px; }\n        .doc-history .history-item .ql-editor p.ql-history-code-true + .ql-history-code-true {\n          border-top: none;\n          margin-top: -1px;\n          padding-top: 0;\n          padding-bottom: 0; }\n      .doc-history .history-item .ql-editor ol,\n      .doc-history .history-item .ql-editor ul {\n        padding-left: 0;\n        margin-left: 20px; }\n        .doc-history .history-item .ql-editor ol + p,\n        .doc-history .history-item .ql-editor ul + p {\n          padding-top: 0; }\n      .doc-history .history-item .ql-editor ol[data-list-style],\n      .doc-history .history-item .ql-editor ul[data-list-style] {\n        margin-left: 0; }\n      .doc-history .history-item .ql-editor p {\n        padding: 0; }\n      .doc-history .history-item .ql-editor > div {\n        padding: 0; }\n    .doc-history .history-item .ql-blot-gallery {\n      padding: 2px; }\n    .doc-history .history-item .ql-blot-gallery-block {\n      margin: 0; }\n    .doc-history .history-item img.gallery-image {\n      max-width: 100% !important;\n      height: auto !important; }\n    .doc-history .history-item .history-revert {\n      z-index: 100; }\n    .doc-history .history-item br {\n      display: none; }\n    .doc-history .history-item blockquote + blockquote {\n      margin-top: 0; }\n    .doc-history .history-item.expand {\n      overflow: auto; }\n      .doc-history .history-item.expand span.img-wrapper {\n        background-color: #f7f7f7 !important; }\n      .doc-history .history-item.expand blockquote > div {\n        border-left-color: #e5e5e5; }\n    .doc-history .history-item:hover .change {\n      box-shadow: 0 2px 5px #eaeaea; }\n    .doc-history .history-item .change {\n      box-shadow: 0 1px 1px #eaeaea;\n      word-break: break-all;\n      position: relative;\n      color: #666;\n      line-height: 1.5;\n      /*font-size*/\n      font-size: 11pt;\n      /* overridden by body.style */ }\n      .doc-history .history-item .change * {\n        cursor: default; }\n      .doc-history .history-item .change font {\n        color: #666; }\n      .doc-history .history-item .change .img-wrapper.cropped {\n        width: initial !important;\n        height: initial !important; }\n        .doc-history .history-item .change .img-wrapper.cropped img {\n          margin: initial !important;\n          -webkit-transform: initial !important;\n                  transform: initial !important;\n          max-width: 100% !important; }\n      .doc-history .history-item .change ol[data-list-style],\n      .doc-history .history-item .change ul[data-list-style] {\n        padding-left: 0; }\n        .doc-history .history-item .change ol[data-list-style] > li,\n        .doc-history .history-item .change ul[data-list-style] > li {\n          padding-left: 0; }\n          .doc-history .history-item .change ol[data-list-style] > li::before,\n          .doc-history .history-item .change ul[data-list-style] > li::before {\n            margin-left: 0; }\n      .doc-history .history-item .change * .ql-indent-1,\n      .doc-history .history-item .change ol[data-list-style] .ql-indent-1,\n      .doc-history .history-item .change ul[data-list-style] .ql-indent-1 {\n        padding-left: 20px !important; }\n      .doc-history .history-item .change * .ql-indent-2,\n      .doc-history .history-item .change ol[data-list-style] .ql-indent-2,\n      .doc-history .history-item .change ul[data-list-style] .ql-indent-2 {\n        padding-left: 40px !important; }\n      .doc-history .history-item .change * .ql-indent-3,\n      .doc-history .history-item .change ol[data-list-style] .ql-indent-3,\n      .doc-history .history-item .change ul[data-list-style] .ql-indent-3 {\n        padding-left: 60px !important; }\n      .doc-history .history-item .change * .ql-indent-4,\n      .doc-history .history-item .change ol[data-list-style] .ql-indent-4,\n      .doc-history .history-item .change ul[data-list-style] .ql-indent-4 {\n        padding-left: 80px !important; }\n      .doc-history .history-item .change * .ql-indent-5,\n      .doc-history .history-item .change ol[data-list-style] .ql-indent-5,\n      .doc-history .history-item .change ul[data-list-style] .ql-indent-5 {\n        padding-left: 100px !important; }\n      .doc-history .history-item .change * .ql-indent-6,\n      .doc-history .history-item .change ol[data-list-style] .ql-indent-6,\n      .doc-history .history-item .change ul[data-list-style] .ql-indent-6 {\n        padding-left: 120px !important; }\n      .doc-history .history-item .change * .ql-indent-7,\n      .doc-history .history-item .change ol[data-list-style] .ql-indent-7,\n      .doc-history .history-item .change ul[data-list-style] .ql-indent-7 {\n        padding-left: 140px !important; }\n      .doc-history .history-item .change * .ql-indent-8,\n      .doc-history .history-item .change ol[data-list-style] .ql-indent-8,\n      .doc-history .history-item .change ul[data-list-style] .ql-indent-8 {\n        padding-left: 160px !important; }\n      .doc-history .history-item .change [class*='ql-indent-'] li {\n        padding-left: 4px; }\n      .doc-history .history-item .change .ql-blot-attachment {\n        border: 1px solid rgba(208, 212, 217, 0.5);\n        padding: 4px 8px 0 8px;\n        text-align: left;\n        background-color: #f7f7f7 !important; }\n        .doc-history .history-item .change .ql-blot-attachment.ql-history-line-addition::after {\n          background: #d5edd3 !important; }\n        .doc-history .history-item .change .ql-blot-attachment::before {\n          content: '\\9644\\4EF6';\n          display: block;\n          color: #a0a2a5;\n          font-size: 12px; }\n        .doc-history .history-item .change .ql-blot-attachment::after {\n          content: attr(data-name); }\n        .doc-history .history-item .change .ql-blot-attachment[data-type='audio']::before {\n          content: '\\97F3\\9891'; }\n        .doc-history .history-item .change .ql-blot-attachment .ql-attachment-wrapper {\n          display: none; }\n      .doc-history .history-item .change a {\n        color: #666;\n        cursor: default; }\n      .doc-history .history-item .change .ql-date-mention {\n        color: #70b1e7 !important; }\n        .doc-history .history-item .change .ql-date-mention .ql-date-text {\n          display: none; }\n        .doc-history .history-item .change .ql-date-mention .ql-date-time {\n          display: inherit; }\n\n.nocolor span {\n  color: inherit !important;\n  background-color: inherit !important; }\n\n.historable .ql-editor ol li:before,\n.historable .ql-editor ul li:before {\n  pointer-events: none !important; }\n\n.historable .ql-editor .shimovideo,\n.historable .ql-editor .shimoaudio {\n  position: relative;\n  display: inline-block;\n  margin-top: 24px; }\n  .historable .ql-editor .shimovideo::before,\n  .historable .ql-editor .shimoaudio::before {\n    content: '\\89C6\\9891';\n    display: inline-block;\n    position: absolute;\n    width: 30px;\n    top: -21px;\n    left: 0;\n    color: #a0a2a5 !important;\n    visibility: visible;\n    font-size: 12px; }\n\n.historable .ql-editor .shimoaudio::before {\n  content: '\\97F3\\4E50'; }\n\n.historable .ql-editor .ql-history-line-hidden {\n  display: none; }\n\n.historable .ql-editor .ql-history-line-addition {\n  background: #d5edd3 !important; }\n\n.historable .ql-editor .ql-table.ql-history-line-addition,\n.historable .ql-editor .ql-table.ql-history-line-deletion {\n  background: inherit !important; }\n\n.historable .ql-editor .ql-history-line-deletion * {\n  text-decoration: line-through;\n  color: #f4aaaa !important; }\n\n.historable .ql-editor hr.ql-history-line-deletion {\n  border-top-color: #f4aaaa; }\n\n.historable .ql-editor .ql-blot-gallery-block.ql-history-line-addition {\n  background: inherit !important; }\n  .historable .ql-editor .ql-blot-gallery-block.ql-history-line-addition img.gallery-image {\n    border: 1px solid rgba(119, 196, 111, 0.7) !important; }\n\n.historable .ql-editor a {\n  cursor: default !important; }\n\n.historable .ql-editor a.ql-history-deletion:hover {\n  color: #f4aaaa !important; }\n\n.historable .ql-editor .ql-history-addition,\n.historable .ql-editor span.ql-history-addition {\n  background: #d5edd3 !important;\n  color: #494949 !important;\n  text-decoration: none !important; }\n  .historable .ql-editor .ql-history-addition .ql-blot-gallery,\n  .historable .ql-editor span.ql-history-addition .ql-blot-gallery {\n    padding: 0; }\n  .historable .ql-editor .ql-history-addition span.img-wrapper,\n  .historable .ql-editor span.ql-history-addition span.img-wrapper {\n    background-color: white !important; }\n  .historable .ql-editor .ql-history-addition img.gallery-image,\n  .historable .ql-editor span.ql-history-addition img.gallery-image {\n    border: 1px solid rgba(119, 196, 111, 0.7) !important;\n    box-shadow: initial !important; }\n\n.historable .ql-editor .ql-history-deletion,\n.historable .ql-editor .ql-history-line-deletion,\n.historable .ql-editor span.ql-history-deletion {\n  text-decoration: line-through !important;\n  color: #f4aaaa !important; }\n  .historable .ql-editor .ql-history-deletion font,\n  .historable .ql-editor .ql-history-line-deletion font,\n  .historable .ql-editor span.ql-history-deletion font {\n    color: #f4aaaa !important; }\n  .historable .ql-editor .ql-history-deletion .inner, .historable .ql-editor .ql-history-deletion.mention:before,\n  .historable .ql-editor .ql-history-deletion .attachment-file-name:after,\n  .historable .ql-editor .ql-history-line-deletion .inner,\n  .historable .ql-editor .ql-history-line-deletion.mention:before,\n  .historable .ql-editor .ql-history-line-deletion .attachment-file-name:after,\n  .historable .ql-editor span.ql-history-deletion .inner,\n  .historable .ql-editor span.ql-history-deletion.mention:before,\n  .historable .ql-editor span.ql-history-deletion .attachment-file-name:after {\n    color: #a5a5a5 !important; }\n  .historable .ql-editor .ql-history-deletion img,\n  .historable .ql-editor .ql-history-line-deletion img,\n  .historable .ql-editor span.ql-history-deletion img {\n    opacity: 0.3;\n    -webkit-mask-image: -webkit-linear-gradient(45deg, black 6%, transparent 6%, transparent 9%, black 9%, black 15%, transparent 15%, transparent 18%, black 18%, black 24%, transparent 24%, transparent 27%, black 27%, black 33%, transparent 33%, transparent 36%, black 36%, black 42%, transparent 42%, transparent 45%, black 45%, black 51%, transparent 51%, transparent 54%, black 54%, black 60%, transparent 60%, transparent 63%, black 63%, black 69%, transparent 69%, transparent 72%, black 72%, black 78%, transparent 78%, transparent 81%, black 81%, black 87%, transparent 87%, transparent 90%, black 90%, black 96%, transparent 96%, black); }\n    .historable .ql-editor .ql-history-deletion img:hover,\n    .historable .ql-editor .ql-history-line-deletion img:hover,\n    .historable .ql-editor span.ql-history-deletion img:hover {\n      opacity: 0.5 !important; }\n\n.historable .ql-editor .ql-table-raw {\n  width: 100%;\n  margin: 10px 0;\n  border-spacing: 0;\n  border-collapse: collapse;\n  table-layout: fixed;\n  font-size: 14px; }\n  .historable .ql-editor .ql-table-raw td {\n    border: 1px solid #ccc;\n    line-height: 1.7;\n    height: 20px;\n    vertical-align: top; }\n    .historable .ql-editor .ql-table-raw td.history-table-rowindex {\n      width: 35px;\n      background: #eee;\n      text-align: center; }\n    .historable .ql-editor .ql-table-raw td.history-table-ignore {\n      width: 30px;\n      text-align: center; }\n\n.historable .ql-editor .history-table-header {\n  background: #eee; }\n  .historable .ql-editor .history-table-header td {\n    text-align: center; }\n\n.historable .ql-editor .history-table-addition {\n  background: rgba(119, 196, 110, 0.3); }\n  .historable .ql-editor .history-table-addition .ql-history-addition {\n    background: transparent !important; }\n\n.historable .ql-editor tr.history-table-addition {\n  background: rgba(119, 196, 110, 0.3); }\n  .historable .ql-editor tr.history-table-addition * {\n    background: transparent !important; }\n\n.historable .ql-editor table.history-table-addition * {\n  background: transparent !important; }\n\n.historable .ql-editor .history-table-deletion {\n  background: rgba(244, 169, 169, 0.3); }\n  .historable .ql-editor .history-table-deletion,\n  .historable .ql-editor .history-table-deletion * {\n    text-decoration: line-through;\n    color: #f4a9a9; }\n\n.historable .ql-editor tr.history-table-deletion {\n  background: rgba(244, 169, 169, 0.3); }\n  .historable .ql-editor tr.history-table-deletion * {\n    background: transparent !important; }\n\n.historable .ql-editor table.history-table-deletion * {\n  background: transparent !important; }\n\n.historable .ql-editor .ql-hidden {\n  display: none; }\n\n.historable .ql-editor .ql-gallery-editableimage .resizebars,\n.historable .ql-editor .ql-gallery-editableimage .ql-gallery-toolbar {\n  display: none !important; }\n\n@-webkit-keyframes highlight-border {\n  0% {\n    border: 5px solid white; }\n  15% {\n    border: 5px solid #f8e1a1; }\n  35% {\n    border: 5px solid #f8e1a1; }\n  100% {\n    border: 5px solid white; } }\n\n@keyframes highlight-border {\n  0% {\n    border: 5px solid white; }\n  15% {\n    border: 5px solid #f8e1a1; }\n  35% {\n    border: 5px solid #f8e1a1; }\n  100% {\n    border: 5px solid white; } }\n\n@-webkit-keyframes highlight {\n  0% {\n    background: white; }\n  15% {\n    background: #f8e1a1; }\n  35% {\n    background: #f8e1a1; }\n  100% {\n    background: white; } }\n\n@keyframes highlight {\n  0% {\n    background: white; }\n  15% {\n    background: #f8e1a1; }\n  35% {\n    background: #f8e1a1; }\n  100% {\n    background: white; } }\n",""])},1614:function(t){t.exports={name:"@shimo/sdk-document-plugin-history",version:"1.0.40",description:"",main:"dist/index.js",typings:"dist/types",files:["dist"],scripts:{prebuild:"rimraf dist",dev:"webpack --config ./webpack.config.js --env.dev",build:"webpack --config ./webpack.config.js --env.prod",prepublish:"npm run build"},keywords:[],author:"liwanying <liwanying@shimo.im>",license:"UNLICENSED",dependencies:{"@shimo/richdoc":"3.1.9","@shimo/sdk-document-editor":"^1.0.51","@shimo/sdk-document-utils":"^1.0.23",classnames:"^2.2.5"},peerDependencies:{"@shimo/simple-i18n":"latest",lodash:"^4.17.10",react:"^16.3.2","react-dom":"^16.3.2",tslib:"1.10.0"},publishConfig:{registry:"http://registry.npm.shimo.run"}}},1615:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=i(0),r=p(i(43)),o=i(13),a=p(i(5)),s=function(t){if(t&&t.__esModule)return t;if(null===t||"object"!=typeof t&&"function"!=typeof t)return{default:t};var e=c();if(e&&e.has(t))return e.get(t);var i={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var r in t)if(Object.prototype.hasOwnProperty.call(t,r)){var o=n?Object.getOwnPropertyDescriptor(t,r):null;o&&(o.get||o.set)?Object.defineProperty(i,r,o):i[r]=t[r]}i.default=t,e&&e.set(t,i);return i}(i(4)),l=p(i(1616)),d=p(i(1617)),h=i(566);function c(){if("function"!=typeof WeakMap)return null;var t=new WeakMap;return c=function(){return t},t}function p(t){return t&&t.__esModule?t:{default:t}}var u,y,f=function(t){function e(e){var i=t.call(this,e)||this;return i.getHistories=function(t){void 0===t&&(t=0),t&&(i.state.loading||i.state.isLastPage)||(i.setState({loading:!0}),(0,h.fetchHistories)(i.props.guid,t).then(function(e){var n=e.isLastPage,r=e.histories;0===t&&(i.scroll.scrollTop=0),i.setState(function(e){var i=e.histories;return 0===t&&(i=[]),{histories:i.concat(r),isLastPage:n,loading:!1}},function(){i.scroll.clientHeight&&i.scroll.scrollHeight===i.scroll.offsetHeight&&0!==i.state.histories.length&&i.getHistories(i.state.histories.length)})}))},i.handleScroll=function(){var t=i.scroll;t.scrollTop+t.offsetHeight>t.scrollHeight-50&&i.getHistories(i.state.histories.length)},i.revert=function(t){"editable"===i.props.permission?i.setState({visible:!i.state.visible,currentItem:t}):o.toast.error((0,a.default)("没有权限还原，请联系文件所有者"))},i.handleCancel=function(){i.setState({visible:!i.state.visible})},i.handleOk=function(){i.props.editor.emitter.emit(r.default.events.TRACK_NEW_DOC_OPS,"点击历史还原"),(0,h.revertHistory)(i.props.guid,i.state.currentItem.id).then(function(){o.toast.success((0,a.default)(u||(u=(0,n.__makeTemplateObject)(["已还原到 "," 的内容"],["已还原到 "," 的内容"])),i.state.currentItem.date)),i.props.clearUndoRedo(),i.props.editor.emitter.emit(r.default.events.TRACK_NEW_DOC_OPS,"历史还原成功")}).catch(function(){o.toast.error((0,a.default)("历史还原失败")),i.props.editor.emitter.emit(r.default.events.TRACK_NEW_DOC_OPS_ERROR,"历史还原失败")}).then(function(){i.setState({visible:!i.state.visible})})},i.state={isLastPage:!1,loading:!1,visible:!1,histories:[],currentItem:{}},i}return(0,n.__extends)(e,t),e.prototype.componentDidMount=function(){this.props.preventInit||this.getHistories()},e.prototype.renderItem=function(t,e){return 1===t.history_type?s.createElement(l.default,(0,n.__assign)({},t,{key:e})):2===t.history_type?s.createElement(d.default,{key:e,item:t,editor:this.props.editor,revert:this.revert}):void 0},e.prototype.render=function(){var t,e=this,i=this.props.height;return i&&(t={height:i}),s.createElement("div",{className:"doc-history historable"},s.createElement("ul",{className:"history-list",onScroll:this.handleScroll,ref:function(t){e.scroll=t},style:t},this.state.histories.map(function(t,i){return e.renderItem(t,i)})),s.createElement(o.Modal,{title:(0,a.default)("还原文档"),okText:(0,a.default)("确定"),cancelText:(0,a.default)("取消"),onOk:this.handleOk,onCancel:this.handleCancel,visible:this.state.visible},(0,a.default)(y||(y=(0,n.__makeTemplateObject)(["确认要将文档还原到 "," 的内容吗？"],["确认要将文档还原到 "," 的内容吗？"])),this.state.currentItem.date)))},e}(s.Component);e.default=f,t.exports=e.default},1616:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n,r=i(0),o=(n=i(5))&&n.__esModule?n:{default:n},a=function(t){if(t&&t.__esModule)return t;if(null===t||"object"!=typeof t&&"function"!=typeof t)return{default:t};var e=s();if(e&&e.has(t))return e.get(t);var i={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var r in t)if(Object.prototype.hasOwnProperty.call(t,r)){var o=n?Object.getOwnPropertyDescriptor(t,r):null;o&&(o.get||o.set)?Object.defineProperty(i,r,o):i[r]=t[r]}i.default=t,e&&e.set(t,i);return i}(i(4));function s(){if("function"!=typeof WeakMap)return null;var t=new WeakMap;return s=function(){return t},t}var l,d,h,c,p,u,y=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,r.__extends)(e,t),e.prototype.actionMessage=function(t){var e=this.props,i=e.invitee,n=e.deletedUser,a=e.newOwner,s=t.action,y={create:(0,o.default)("创建了文档"),createCopy:(0,o.default)("创建了文档副本"),join:(0,o.default)("加入了文档"),open_share_link:(0,o.default)("开启了公开分享链接"),close_share_link:(0,o.default)("关闭了公开分享链接"),regenerate_share_link:(0,o.default)("重新生成了公开分享链接"),set_doc_readonly:(0,o.default)("将公开链接设置为只读"),set_doc_private:(0,o.default)("禁用了公开链接"),set_doc_editable:(0,o.default)("将公开链接设置为可写"),set_doc_enterprise_readonly:(0,o.default)("将公开链接设置为仅企业内部只读"),set_doc_enterprise_editable:(0,o.default)("将公开链接设置为仅企业内部可写"),turn_on_password:(0,o.default)("开启了访问密码"),turn_off_password:(0,o.default)("关闭了访问密码"),reset_password:(0,o.default)("更换了访问密码"),createRevision:(0,o.default)("保存了历史版本")}[s];if(y)return y;switch(s){case"create":return(0,o.default)("创建了文档");case"rename":return(0,o.default)(l||(l=(0,r.__makeTemplateObject)(["把文档 “","” 重命名为 “","”"],["把文档 “","” 重命名为 “","”"])),t.before,t.after);case"invite":return(0,o.default)(d||(d=(0,r.__makeTemplateObject)(["邀请了 ",""],["邀请了 ",""])),i);case"deleteShare":return(0,o.default)(h||(h=(0,r.__makeTemplateObject)(["对 "," 取消了共享"],["对 "," 取消了共享"])),n);case"transferOwnership":return(0,o.default)(c||(c=(0,r.__makeTemplateObject)(["把文档转让给 ",""],["把文档转让给 ",""])),a);case"renameRevision":return(0,o.default)(p||(p=(0,r.__makeTemplateObject)(["将历史版本 “","” 重命名为 “","”"],["将历史版本 “","” 重命名为 “","”"])),t.before,t.after);case"deleteRevision":return(0,o.default)(u||(u=(0,r.__makeTemplateObject)(["删除了历史版本 “","”"],["删除了历史版本 “","”"])),t.label)}},e.prototype.render=function(){var t=this.props,e=t.name,i=t.updateAt,n=t.formattedTime,r=t.content;return a.createElement("li",{className:"history-item"},a.createElement("div",{className:"history-header"},a.createElement("div",{className:"history-content"},a.createElement("span",{className:"history-content-author author"},e),a.createElement("span",null,this.actionMessage(r))),a.createElement("small",{"data-time":i,className:"history-item-time datetime"},n)))},e}(a.Component);e.default=y,t.exports=e.default},1617:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=i(0),r=y(i(9)),o=y(i(43)),a=i(13),s=y(i(5)),l=y(i(31)),d=i(2),h=function(t){if(t&&t.__esModule)return t;if(null===t||"object"!=typeof t&&"function"!=typeof t)return{default:t};var e=u();if(e&&e.has(t))return e.get(t);var i={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var r in t)if(Object.prototype.hasOwnProperty.call(t,r)){var o=n?Object.getOwnPropertyDescriptor(t,r):null;o&&(o.get||o.set)?Object.defineProperty(i,r,o):i[r]=t[r]}i.default=t,e&&e.set(t,i);return i}(i(4)),c=y(i(1618)),p=y(i(1620));function u(){if("function"!=typeof WeakMap)return null;var t=new WeakMap;return u=function(){return t},t}function y(t){return t&&t.__esModule?t:{default:t}}var f,m=function(t){function e(e){var i=t.call(this,e)||this;i.handleClick=function(t){t.preventDefault();var e,n,r=t.target;r.classList.contains("ql-editor")?e=(n=r.querySelector("[line]"))&&n.getAttribute("line"):(e=(n=r.closest("[line]"))&&n.getAttribute("line"))||(e=(n=r.querySelector("[line]"))&&n.getAttribute("line"));var o=e&&i.props.editor.root.querySelector('[line="'+e+'"]');if(o&&"\n"!==o.innerText){i.props.editor.scrollToLine(e);var l=i.props.editor.root.querySelector('[line="'+e+'"]');l&&(l.style.animation="highlight 1s",setTimeout(function(){l.style.animation=""},1e3))}else a.toast.success((0,s.default)("该部分历史内容已被删除"))},i.revert=function(){i.props.revert(i.props.item)},i.toggle=function(){i.setState({expand:!i.state.expand})},i.expand=function(){i.state.short&&1===i.state.groups.length||i.setState({expand:!0})};var n=[];return e.item.content.alines&&(n=i.buildGroups(e.item.content.alines,e.item.userId)),i.editors={},i.quills={},i.state={expand:!1,short:!1,groups:n},i}return(0,n.__extends)(e,t),e.prototype.shouldComponentUpdate=function(t,e){return!(0,d.eq)(this.state,e)||this.props.item.formattedTime!==t.item.formattedTime},e.prototype.componentDidMount=function(){var t=this;this.updateEditor(),(0,d.forIn)(this.editors,function(e){e.addEventListener("click",t.handleClick),e.addEventListener("DOMNodeInserted",function(i){var n=(0,d.get)(i,"target.classList");n&&n.contains("ql-table-raw")&&t.checkScroll(e,0,0)})})},e.prototype.componentWillReceiveProps=function(t){var e=this;if(t.item.content.alines){var i=this.buildGroups(t.item.content.alines,t.item.userId);this.setState({groups:i},function(){e.updateEditor()})}},e.prototype.buildGroups=function(t,e){var i=r.default.unpack(JSON.stringify(t));return c.default.build(i,e).group()},e.prototype.updateEditor=function(){var t=this;this.state.groups.forEach(function(e,i){var n=t.editors[i];if(!t.quills[i]){var r=new o.default({theme:"default",readOnly:!0,modules:{clipboard:{disable:!0},keyboard:{disable:!0},history:{disable:!0}}});r.render(n),t.quills[i]=r}t.quills[i].setContents(e),0===i&&t.checkScroll(n)})},e.prototype.checkScroll=function(t,e,i){var n=this;void 0===e&&(e=0),void 0===i&&(i=6);var r=t.querySelectorAll("img");(r=(0,d.filter)(r,{complete:!1})).length?e<i&&setTimeout(function(){n.checkScroll(t,e+1)},500):this.setState({short:t.scrollHeight<=170})},e.prototype.renderRevertButton=function(){return h.createElement("div",{className:"history-revert",onClick:this.revert},h.createElement(p.default,null),(0,s.default)("还原"))},e.prototype.renderDesc=function(){var t=this.props.item.content;return t.dhId?h.createElement("span",{dangerouslySetInnerHTML:{__html:(0,s.default)(f||(f=(0,n.__makeTemplateObject)(['将文档还原到<span data-time="','" class="history-content-time time"> '," </span>的内容"],['将文档还原到<span data-time="','" class="history-content-time time"> '," </span>的内容"])),t.time,t.formattedTime)}}):h.createElement("span",null,(0,s.default)("编辑了文档"))},e.prototype.render=function(){var t=this,e=this.props.item,i=this.state.groups.map(function(i,n){var r=0===n?"state1":"state2";return h.createElement("div",{key:n,className:"history-change change "+r,onClick:t.expand},t.renderRevertButton(),h.createElement("div",{className:"history-content-"+e.guid+"-"+n,ref:function(e){t.editors[n]=e}}))}),n=(0,l.default)("history-item",{single:1===this.state.groups.length,short:this.state.short,expand:this.state.expand,hide:0===this.state.groups.length});return h.createElement("li",{className:n,"data-dh-id":e.id},h.createElement("div",{className:"history-header fix"},h.createElement("div",{className:"history-content"},h.createElement("span",{className:"author history-content-author"},e.name),this.renderDesc(),h.createElement("span",{className:"history-info",onClick:this.toggle},this.state.expand?(0,s.default)("折叠"):(0,s.default)("展开"))),h.createElement("small",{className:"history-item-time datetime","data-time":e.updatedAt},e.formattedTime)),i)},e}(h.Component);e.default=m,t.exports=e.default},1618:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=i(0),r=i(9),o=s(i(2)),a=s(i(1619));function s(t){return t&&t.__esModule?t:{default:t}}var l=["divide","table","gallery-block","attachment"],d=function(){function t(){this.lines=[],this.currentLine=new a.default}return t.getGallery=function(t){if(t.data){if(t.data.gallery)return["gallery",t.data.gallery];if(t.data["gallery-block"])return["gallery-block",t.data["gallery-block"]]}},t.processImage=function(t){if(t.length<2)return t;for(var e=[],i=0;i<t.length-1;i++){var r=t[i],a=t[i+1],s=this.getGallery(r),l=this.getGallery(a);s&&l&&s[0]!==l[0]&&s[1]===l[1]&&"deletion"===r.getAttributes().history&&"addition"===a.getAttributes().history&&(e.push(r),e.push(a))}return o.default.without.apply(o.default,(0,n.__spreadArrays)([t],e))},t.processCode=function(t){return t.map(function(t){var e=t.getAttributes();return e["code-block"]?(delete e["code-block"],e["history-code-block"]=!0,t.set({attributes:e})):t})},t.processMedia=function(t){for(var e=[],i=0,n=t;i<n.length;i++){var o=n[i];if(e.push(o),o.data.externalmedia&&"object"==typeof o.data.externalmedia){var a=o.getAttributes(),s={};s.line=a.line,e.push(r.TextOperator.insert("\n",s))}}return e.map(function(t){if(t.data.externalmedia&&"object"==typeof t.data.externalmedia){var e="shimovideo";"audio"===t.data.externalmedia.type&&(e="shimoaudio");var i=t.getAttributes();return i.link=e+":"+t.data.externalmedia.originUrl,t.set({attributes:i,data:t.data.externalmedia.originUrl})}return t})},t.build=function(e,i){var n=this.processImage(e.ops);n=this.processCode(n),n=this.processMedia(n);var r=new t;return n.forEach(function(t){r.push(t,i)}),r.finish(),r.processList(),r.clean(),r},t.prototype.newLine=function(){this.lines.push(this.currentLine),this.currentLine=this.currentLine.empty?this.currentLine=new a.default(this.currentLine.index):this.currentLine=new a.default(this.currentLine.index+1)},t.prototype.push=function(t,e){var i=this;if("string"==typeof t.data)if(-1===t.data.indexOf("\n"))this.currentLine.push(t);else{var n=t.data.split(/\n+/);n.forEach(function(e,r){e&&i.currentLine.push(t.set({data:e})),r!==n.length-1&&(i.currentLine.push(t.set({data:"\n"})),i.newLine())})}else if(t.getAttributes().history||!this._isBlockElement(t)){var r="author-block",o=t.getAttributes();(o[r]&&o[r]===e||o.author===e)&&this.currentLine.push(t)}},t.prototype._isBlockElement=function(t){return t instanceof r.TableOperator||o.default.intersection(l,Object.keys(t.data)).length>0},t.prototype.finish=function(){this.currentLine.empty||this.lines.push(this.currentLine)},t.prototype.processList=function(){var t={};this.lines.forEach(function(e){if(e.isOrderedList){var i=t[e.indent]||0;e.start?i=e.start:(i+=1,e.modified&&e.setLineAttribute("list","ordered:"+i)),t[e.indent]=i}else t={}})},t.prototype.clean=function(){this.lines=this.lines.filter(function(t){return t.modified&&!t.empty})},t.prototype.endWithNewline=function(t){if(!t.length)return!1;var e=t[t.length-1];return"string"==typeof e.data&&e.data.match(/\n$/)},t.prototype.group=function(){var t=this;if(!this.lines.length)return[];var e=[],i=this.lines[0].ops;return this.lines.reduce(function(n,o){return o.index===n.index+1?(t.endWithNewline(i)||i.push(r.Operator.insert("\n")),i=i.concat(o.ops)):(e.push(i),i=o.ops),o}),e.push(i),e.map(function(t){return new r.Delta(t)})},t}();e.default=d,t.exports=e.default},1619:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n,r=i(9),o=(n=i(2))&&n.__esModule?n:{default:n};var a=["author","authorlong","history","line","line-block"],s=function(){function t(t){void 0===t&&(t=0),this.index=t,this.ops=[],this.modified=!1,this.empty=!0}return t.prototype.push=function(t){var e=t.getAttributes();if("string"!=typeof t.data)return!e.history||t instanceof r.TableOperator||(e.historyLine=e.history,t=t.set({attributes:e})),e.history&&t instanceof r.TableOperator&&(e.fromHistory=!0,t=t.set({attributes:e})),t.data["gallery-block"]&&this.ops.push(r.TextOperator.insert("\n")),e.history&&(this.modified=!0),this.empty=!1,void this.ops.push(t);var i=o.default.difference(Object.keys(e),a).length>0;if(e.history&&("\n"!==t.data||i)&&(this.modified=!0),/^ordered(:\d+)?$/.test(e.list))e.list.substr(8);t.data.replace(/\n+/g,"")&&(this.empty=!1),e.history&&"\n"===t.data&&i&&(delete e.history,e.historyLine="retain",t=t.set({attributes:e})),this.ops.push(t)},t.prototype.setLineAttribute=function(t,e){if(this.ops.length){var i=this.ops[this.ops.length-1];if("\n"===i.data){var n=i.getAttributes();n[t]=e,i=i.set({attributes:n}),this.ops.splice(this.ops.length-1,1,i)}}},t}();e.default=s,t.exports=e.default},1620:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n,r=(n=i(4))&&n.__esModule?n:{default:n};var o=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t},a=function(t){var e,i;function n(){return t.apply(this,arguments)||this}return i=t,(e=n).prototype=Object.create(i.prototype),e.prototype.constructor=e,e.__proto__=i,n.prototype.render=function(){return r.default.createElement("svg",o({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 26 24"},this.props),r.default.createElement("path",{d:"M5.6 20.6l1.3-1.5c3.9 3.9 10.2 3.9 14.1 0 3.9-3.9 3.9-10.3 0-14.2C17.1 1 10.9 1 7 4.9l-.1.1C5.2 6.6 4.2 8.8 4 11.1H2C2.5 4.5 8.3-.4 14.9.1s11.5 6.3 11 12.9c-.5 6.6-6.2 11.5-12.8 11-2.8-.2-5.5-1.4-7.5-3.4z",fill:"#73a2e3"}),r.default.createElement("path",{fill:"#73a2e3",d:"M3.5 16L7 10H0z"}),r.default.createElement("path",{d:"M16.6 14.5L14 11",fill:"none",stroke:"#73a2e3",strokeWidth:"2",strokeLinecap:"round"}),r.default.createElement("path",{d:"M12.9 6h2v5c0 .6-.4 1-1 1s-1-.4-1-1V6z",fill:"#73a2e3"}))},n}(r.default.Component);e.default=a,t.exports=e.default},2:function(e,i){e.exports=t},4:function(t,i){t.exports=e},45:function(t,e){t.exports=r},566:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.setAPI=function(t,e){s={fetch:"/lizard-api/files/"+e+"/docsidebarinfo",revert:"/lizard-api/files/"+e+"/revert",user:"/lizard-api/users"},s=(0,a.assign)(s,t)},e.fetchHistories=function(t,e){return(0,r.request)({url:s.fetch,params:{count:e}}).then(function(t){var e=t.isLastPage,i=t.histories,n=void 0===i?[]:i,o=t.users;return(0,a.assign)(l,o),function(t){return new Promise(function(e){var i=(0,a.map)(t,function(t){if(t.user_id>0)return t.user_id});t=t.filter(function(t){t.formattedTime=h(t.updated_at),t.date=h(t.updated_at);var e=JSON.parse(t.content),n=e.changeset;if(n&&1===(n=JSON.parse(n)).length&&n[0][1]&&n[0][1]["upload-placeholder-image"])return!1;switch(e.range&&e.range[0]===e.range[1]&&1===e.range[1]&&(e.action="create",t.history_type=1,t.historyType=1),e.action){case"invite":t.inviteeId=e.invitee,i.push(t.inviteeId);break;case"deleteShare":t.deletedUserId=e.deletedUser,i.push(t.deletedUserId);break;case"transferOwnership":t.newOwnerId=e.newOwner,i.push(t.newOwnerId)}return e.dhId&&(e.formattedTime=h(e.time)),t.content=e,!0});var n=(0,a.difference)(i,(0,a.keys)(l));(function(t){if(!t.length)return Promise.resolve(t);return(0,r.request)({url:s.user,params:{status:"full",ids:t}})})(n).then(function(i){i.forEach(function(t){l[t.id]=t.name,"待接受邀请"===t.name&&(l[t.id]=t.email)}),t.forEach(function(t){switch(t.name=d(t.user_id),t.content.action){case"invite":t.invitee=d(t.inviteeId);break;case"deleteShare":t.deletedUser=d(t.deletedUserId);break;case"transferOwnership":t.newOwner=d(t.newOwnerId)}}),e(t)})})}(n).then(function(t){return{isLastPage:e,histories:(0,a.reverse)(t)}})})},e.revertHistory=function(t,e){return(0,r.request)({method:"POST",url:s.revert,data:{docHistoryId:e}})};var n,r=i(13),o=(n=i(5))&&n.__esModule?n:{default:n},a=i(2);var s={},l={};function d(t){return t<0?(0,o.default)("路人"):l[t]}function h(t){var e=function(t){return t>9?t:"0"+t},i=new Date(t),n=(new Date).getFullYear();return""+(i.getFullYear()===n?"":i.getFullYear()+"/")+e(i.getMonth()+1)+"/"+e(i.getDate())+" "+e(i.getHours())+":"+e(i.getMinutes())}}})});